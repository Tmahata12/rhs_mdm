<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RHS MDM Management System V2.0 - Ramnagar High School</title>
    
    <!-- Favicon - Food Plate Emoji -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçΩÔ∏è</text></svg>">
    
    <!-- Alternative Favicons for better compatibility -->
    <link rel="alternate icon" type="image/png" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2248%22 fill=%22%230066cc%22/><text x=%2250%22 y=%2270%22 font-size=%2260%22 text-anchor=%22middle%22 fill=%22white%22>üçΩÔ∏è</text></svg>">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2248%22 fill=%22%230066cc%22/><text x=%2250%22 y=%2270%22 font-size=%2260%22 text-anchor=%22middle%22 fill=%22white%22>üçΩÔ∏è</text></svg>">
    
    <!-- Theme Color for Mobile Browsers -->
    <meta name="theme-color" content="#0066cc">
    <meta name="apple-mobile-web-app-status-bar-style" content="#0066cc">
    
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    

    <script>
    // Debug: Check if html2pdf loaded
    window.addEventListener('DOMContentLoaded', function() {
        console.log('=== PDF LIBRARY CHECK ===');
        if (typeof html2pdf !== 'undefined') {
            console.log('‚úÖ html2pdf library loaded successfully!');
        } else {
            console.error('‚ùå html2pdf library NOT loaded!');
            console.log('Please check:');
            console.log('1. Internet connection');
            console.log('2. CDN accessibility');
            console.log('3. Browser console for errors');
        }
        
        // Also check if autoDownloadPDF exists
        if (typeof autoDownloadPDF !== 'undefined') {
            console.log('‚úÖ autoDownloadPDF function exists!');
        } else {
            console.error('‚ùå autoDownloadPDF function NOT found!');
        }
        console.log('=====================');
    });
    </script>
    <!-- Flatpickr Date Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <script>
    // ========================================
    // GLOBAL ERROR HANDLER
    // ========================================
    window.addEventListener('error', function(e) {
        // Silently handle external resource loading errors
        if (e.target && (e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
            console.warn('Resource failed to load:', e.target.src || e.target.href);
            e.preventDefault();
            return false;
        }
    }, true);
    
    // Handle unhandled promise rejections
    window.addEventListener('unhandledrejection', function(e) {
        console.warn('Promise rejection:', e.reason);
        e.preventDefault();
    });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <!-- SheetJS for Excel Upload (Enhanced Form C) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <!-- Authentication Module (V2.0) -->
    <script src="auth.js"></script>
    
    <style>
        /* ===== STYLISH CALENDAR PICKER ===== */
        .flatpickr-calendar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border-radius: 12px !important;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4) !important;
            border: none !important;
            padding: 10px !important;
        }
        
        .flatpickr-months {
            background: transparent !important;
            border-bottom: 2px solid rgba(255,255,255,0.2) !important;
            padding-bottom: 10px !important;
        }
        
        .flatpickr-month, .flatpickr-current-month {
            color: white !important;
            fill: white !important;
        }
        
        .flatpickr-current-month .flatpickr-monthDropdown-months {
            background: rgba(255,255,255,0.15) !important;
            color: white !important;
            border: 1px solid rgba(255,255,255,0.3) !important;
            border-radius: 6px !important;
            font-weight: 600 !important;
        }
        
        .flatpickr-months .flatpickr-prev-month:hover,
        .flatpickr-months .flatpickr-next-month:hover {
            background: rgba(255,255,255,0.2) !important;
            border-radius: 50% !important;
        }
        
        .flatpickr-weekday {
            color: rgba(255,255,255,0.9) !important;
            font-weight: 700 !important;
        }
        
        .flatpickr-day {
            color: white !important;
            border-radius: 8px !important;
            font-weight: 600 !important;
            transition: all 0.3s ease !important;
        }
        
        .flatpickr-day:hover {
            background: rgba(255,255,255,0.25) !important;
            transform: scale(1.1) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
        }
        
        .flatpickr-day.today {
            background: rgba(255,255,255,0.3) !important;
            border: 2px solid rgba(255,255,255,0.6) !important;
            font-weight: 700 !important;
        }
        
        .flatpickr-day.selected {
            background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%) !important;
            color: #5d4037 !important;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.5) !important;
            font-weight: 700 !important;
            transform: scale(1.15) !important;
        }
        
        .flatpickr-day.prevMonthDay, .flatpickr-day.nextMonthDay {
            color: rgba(255,255,255,0.4) !important;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        body.dark-mode .container {
            background: #1e1e2e;
            color: #e0e0e0;
        }

        /* ========== HEADER ========== */
        .header {
            background: linear-gradient(135deg, #0052a3 0%, #003d7a 50%, #1e3c72 100%);
            color: #e8f0ff;
            padding: 20px 30px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 20px;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 52, 122, 0.35), inset 0 1px 0 rgba(255,255,255,0.1);
            border-bottom: 3px solid rgba(102, 126, 234, 0.5);
            overflow: visible;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -5%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1;
        }

        .school-logo {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.25);
        }

        .school-logo img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: contain;
        }

        .header-content {
            text-align: center;
        }

        .header-content h1 {
            font-size: 20px;
            font-weight: 700;
            margin: 4px 0;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.25), 0 0 20px rgba(102, 126, 234, 0.1);
            letter-spacing: 2.5px;
            color: #fff9e6;
            position: relative;
            z-index: 1;
        }

        .header-content p {
            font-size: 13px;
            line-height: 1.4;
            opacity: 0.92;
            margin: 6px 0;
            color: #d0deff;
        }

        .header-content .govt-text {
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 3px;
            letter-spacing: 1.5px;
            color: #b3d9ff;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.2);
        }

        .header-content .school-info {
            font-size: 12px;
            line-height: 1.3;
            margin: 6px 0 0 0;
            color: #c9d9f5;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 10;
        }
        
        .header-controls-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Status Badge */
        .status-badge {
            background: rgba(16, 185, 129, 0.15);
            border: 1.5px solid rgba(16, 185, 129, 0.4);
            padding: 8px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            color: #d1fae5;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
        }

        .status-badge .pulse-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Clock Styling */
        .clock {
            background: rgba(59, 130, 246, 0.15);
            border: 1.5px solid rgba(59, 130, 246, 0.4);
            padding: 8px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            color: #dbeafe;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 110px;
            font-family: 'Courier New', monospace;
        }

        .clock span:last-child {
            display: inline-block;
            width: 65px;
            text-align: center;
        }

        /* Notification Bell */
        .notification-btn {
            position: relative;
            background: rgba(251, 191, 36, 0.15);
            border: 1.5px solid rgba(251, 191, 36, 0.4);
            color: #fef3c7;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);
        }

        .notification-btn:hover {
            background: rgba(251, 191, 36, 0.25);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #ef4444;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #3b4d8f;
        }

        /* Dark Mode Toggle */
        .dark-mode-btn {
            background: rgba(139, 92, 246, 0.15);
            border: 1.5px solid rgba(139, 92, 246, 0.4);
            color: #ede9fe;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
        }

        .dark-mode-btn:hover {
            background: rgba(139, 92, 246, 0.25);
            transform: rotate(20deg) scale(1.05);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        /* Admin Dropdown */
        .admin-dropdown {
            position: relative;
            z-index: 1000;
        }

        .admin-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .admin-btn .dropdown-icon {
            font-size: 10px;
            transition: transform 0.3s ease;
        }

        .admin-dropdown.active .dropdown-icon {
            transform: rotate(180deg);
        }

        .admin-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05);
            min-width: 220px;
            display: none;
            z-index: 10000;
            overflow: hidden;
        }

        .admin-dropdown.active .admin-menu {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .admin-menu-item {
            padding: 12px 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #334155;
            font-size: 13px;
            font-weight: 500;
            border-bottom: 1px solid #f1f5f9;
        }

        .admin-menu-item:last-child {
            border-bottom: none;
        }

        .admin-menu-item:hover {
            background: #f8fafc;
            padding-left: 22px;
        }

        .admin-menu-item.danger {
            color: #dc2626;
        }

        .admin-menu-item.danger:hover {
            background: #fef2f2;
        }

        body.dark-mode .admin-menu {
            background: #1e293b;
            border: 1px solid #334155;
        }

        body.dark-mode .admin-menu-item {
            color: #e2e8f0;
            border-bottom-color: #334155;
        }

        body.dark-mode .admin-menu-item:hover {
            background: #334155;
        }
        
        /* Responsive header */
        @media (max-width: 1024px) {
            .header {
                grid-template-columns: 1fr;
                padding: 15px 20px;
            }
            
            .header-left {
                justify-content: center;
            }
            
            .header-controls {
                justify-content: center;
                margin-top: 15px;
                flex-wrap: wrap;
            }
            
            .header-content .school-info {
                font-size: 11px;
                white-space: normal;
                text-align: center;
            }

            .notification-btn, .dark-mode-btn {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }

            .admin-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        /* ========== BUTTON HOVER EFFECTS ========== */
        button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        button:active {
            transform: translateY(0);
        }

        /* ========== RESPONSIVE TABLE ========== */
        @media (max-width: 768px) {
            table {
                font-size: 12px;
            }
            
            button {
                padding: 10px 18px !important;
                font-size: 13px !important;
            }

            .header-content h1 {
                font-size: 16px;
            }
        }

        /* ========== TABS ========== */
        .tabs {
            display: flex;
            gap: 8px;
            padding: 20px 20px 15px 20px;
            background: white;
            border-bottom: none;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        body.dark-mode .tabs {
            background: #1e1e2e;
        }

        .tab-btn {
            padding: 10px 18px;
            background: #f1f5f9;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
            white-space: nowrap;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tab-btn:hover {
            background: #e2e8f0;
            color: #475569;
            transform: translateY(-1px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* Special styling for specific tabs when active */
        .tab-btn.active[onclick*="tools"] {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        body.dark-mode .tab-btn {
            background: #2d2d3d;
            color: #94a3b8;
        }

        body.dark-mode .tab-btn:hover {
            background: #3d3d4d;
            color: #cbd5e1;
        }

        body.dark-mode .tab-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        body.dark-mode .tab-btn.active[onclick*="tools"] {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        /* ========== CONTENT ========== */
        .content {
            padding: 20px;
            min-height: 600px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ========== SETTINGS SECTIONS ========== */
        .settings-section {
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
        }

        .settings-section h3 {
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 700;
            color: #003d7a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-section.orange {
            border-left-color: #ff9800;
        }

        .settings-section.orange h3 {
            color: #ff9800;
        }

        .settings-section.green {
            border-left-color: #28a745;
        }

        .settings-section.green h3 {
            color: #28a745;
        }

        .settings-section.purple {
            border-left-color: #9c27b0;
        }

        .settings-section.purple h3 {
            color: #9c27b0;
        }

        .settings-section.blue {
            border-left-color: #2196F3;
        }

        .settings-section.blue h3 {
            color: #2196F3;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .settings-grid.full {
            grid-template-columns: 1fr;
        }

        body.dark-mode .settings-section {
            background: #252535;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }
        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #333;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        body.dark-mode .form-group label {
            color: #e0e0e0;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background: #333;
            border-color: #555;
            color: #e0e0e0;
        }

        /* ========== FORM-C TABLE ========== */
        .form-c-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #003d7a;
        }

        body.dark-mode .form-c-section {
            background: #252535;
            border-color: #667eea;
        }

        .form-c-header {
            background: #003d7a;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }

        .form-c-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-c-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            background: white;
            border: 2px solid #003d7a;
        }

        body.dark-mode .form-c-table {
            background: #333;
            border-color: #667eea;
        }

        .form-c-table thead {
            background: #003d7a;
            color: white;
        }

        .form-c-table th,
        .form-c-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        body.dark-mode .form-c-table td {
            border-color: #555;
        }

        .form-c-table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        body.dark-mode .form-c-table tbody tr:nth-child(even) {
            background: #3a3a4a;
        }

        .form-c-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        body.dark-mode .form-c-table input {
            background: #222;
            border-color: #555;
            color: #e0e0e0;
        }

        /* ========== BUTTONS ========== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
            margin: 2px;
        }

        /* ========== TABLES ========== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
        }

        body.dark-mode .data-table {
            background: #333;
        }

        .data-table thead {
            background: #003d7a;
            color: white;
        }

        .data-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        body.dark-mode .data-table td {
            border-bottom-color: #555;
        }

        .data-table tbody tr:hover {
            background: #f5f5f5;
        }

        body.dark-mode .data-table tbody tr:hover {
            background: #3a3a4a;
        }

        /* ========== DASHBOARD ========== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .dashboard-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .dashboard-card .value {
            font-size: 28px;
            font-weight: bold;
        }

        .dashboard-card.green {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .dashboard-card.orange {
            background: linear-gradient(135deg, #ff6a00 0%, #ee0979 100%);
        }

        .dashboard-card.blue {
            background: linear-gradient(135deg, #003d7a 0%, #1e3c72 100%);
        }
        /* ========== FOOTER ========== */
        .footer {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
            box-shadow: 0 -4px 16px rgba(30, 58, 138, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .footer-center {
            flex-grow: 1;
            text-align: center;
        }

        .footer-center p {
            margin: 0;
            font-weight: 500;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
        }

        .footer-right {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        body.dark-mode .footer {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-top-color: rgba(255, 255, 255, 0.05);
        }
        
        
        .footer::before {
            content: '';
            position: absolute;
            bottom: -50%;
            left: -5%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .mdm-logo {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255,255,255,0.25);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15), inset 0 1px 2px rgba(255,255,255,0.2);
        }

        .mdm-logo img {
            width: 42px;
            height: 42px;
            object-fit: contain;
        }

        .footer-center {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .footer-center p {
            font-size: 13px;
            line-height: 1.5;
            color: #d0deff;
            font-weight: 500;
        }

        /* ========== ALERTS ========== */
        .alert {
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: none;
            font-weight: 600;
            font-size: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: slideDown 0.3s ease-out;
            position: relative;
            z-index: 1000;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #28a745;
            border-left: 5px solid #28a745;
        }

        .alert-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 2px solid #dc3545;
            border-left: 5px solid #dc3545;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            color: #856404;
            border: 2px solid #ffc107;
            border-left: 5px solid #ffc107;
        }

        /* ========== HOVER EFFECTS ========== */
        .dashboard-card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12) !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .header-left {
                justify-content: center;
                width: 100%;
            }

            .header-controls {
                position: static;
                justify-content: center;
                width: 100%;
                margin-top: 10px;
            }

            .header-content h1 {
                font-size: 16px;
            }

            .header-content .govt-text {
                font-size: 14px;
            }

            .header-content .school-info {
                font-size: 10px;
            }

            .form-c-inputs {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .footer {
                flex-direction: column;
            }
        }
        /* ========== LOCK SCREEN ========== */
        .lock-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 61, 122, 0.98) 0%, rgba(30, 60, 114, 0.95) 100%);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .lock-screen.active {
            display: flex;
        }

        .lock-content {
            background: white;
            padding: 50px 40px;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: lockSlideIn 0.5s ease-out;
        }

        @keyframes lockSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .lock-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .pin-input-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .pin-digit {
            width: 60px;
            height: 60px;
            font-size: 28px;
            text-align: center;
            border: 3px solid #e2e8f0;
            border-radius: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .pin-digit:focus {
            outline: none;
            border-color: #0052a3;
            background: white;
            box-shadow: 0 0 0 4px rgba(0, 82, 163, 0.1);
        }

        .btn-unlock {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #0052a3 0%, #003d7a 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 82, 163, 0.3);
        }

        .lock-error {
            color: #dc2626;
            font-size: 13px;
            margin-top: 15px;
            display: none;
            font-weight: 600;
        }

        .lock-error.show {
            display: block;
        }

        /* ========== AUTO LOGOUT WARNING ========== */
        .timeout-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .timeout-warning.active {
            display: flex;
        }

        .timeout-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 450px;
            width: 90%;
        }

        .timeout-timer {
            font-size: 48px;
            font-weight: 900;
            color: #dc2626;
            margin: 20px 0;
        }

        .btn-extend {
            padding: 15px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            margin: 10px;
        }

        /* ========== LOGIN SCREEN ========== */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
            overflow: hidden;
        }

        .login-container {
            background: white;
            padding: 30px 25px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 420px;
            width: 90%;
            margin: 0 auto;
        }

        .login-logo-circle {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(30, 60, 114, 0.4);
        }

        .login-logo-inner {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #e8f0ff 0%, #c8dcf5 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .login-title {
            text-align: center;
            margin-bottom: 6px;
        }

        .login-title h1 {
            color: #0066cc;
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 4px 0;
            letter-spacing: 0.5px;
        }

        .login-subtitle {
            text-align: center;
            color: #5a6c7d;
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .login-subtitle-small {
            text-align: center;
            color: #8391a1;
            font-size: 12px;
            font-style: italic;
            margin-bottom: 20px;
        }

        .login-form-group {
            margin-bottom: 16px;
        }

        .login-form-group label {
            display: block;
            color: #334155;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .login-input-wrapper {
            position: relative;
        }

        .login-input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            pointer-events: none;
        }

        .login-form-group input {
            width: 100%;
            padding: 12px 12px 12px 42px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
            color: #334155;
        }

        .login-form-group input:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .login-form-group input::placeholder {
            color: #94a3b8;
        }

        .login-password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            transition: all 0.2s;
        }

        .login-password-toggle:hover {
            transform: translateY(-50%) scale(1.1);
        }

        .login-remember-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .login-remember-label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            color: #334155;
            font-size: 13px;
        }

        .login-remember-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #0066cc;
        }

        .login-forgot-link {
            color: #0066cc;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
            transition: color 0.2s;
        }

        .login-forgot-link:hover {
            color: #0052a3;
            text-decoration: underline;
        }

        .login-button {
            width: 100%;
            padding: 13px;
            background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 102, 204, 0.4);
        }

        .login-button:active {
            transform: translateY(0);
        }

        .login-info-box {
            margin-top: 18px;
            padding: 14px;
            background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
            border-radius: 10px;
            border-left: 3px solid #0066cc;
        }

        .login-info-title {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #0066cc;
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .login-info-text {
            color: #334155;
            font-size: 12px;
            line-height: 1.5;
            margin: 0;
        }

        #loginError {
            display: none;
            padding: 10px;
            background: #fee;
            border: 2px solid #fcc;
            border-radius: 8px;
            margin-bottom: 12px;
            color: #c33;
            font-size: 14px;
            text-align: center;
            font-weight: 600;
        }

        body.dark-mode .login-screen {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-mode .login-container {
            background: #1e1e2e !important;
        }

        body.dark-mode .login-container input {
            background: #2a2a3e !important;
            border-color: #444 !important;
            color: #e0e0e0 !important;
        }

        body.dark-mode .login-container h1 {
            color: #6b94c1 !important;
        }

        body.dark-mode .login-container label {
            color: #aaa !important;
        }

        body.dark-mode .login-container p {
            color: #999 !important;
        }

        /* ========== PRINT STYLES ========== */
        @media print {
            button, .btn, .header-controls, .tab-navigation, .footer, input[type="file"], .no-print {
                display: none !important;
            }
            body {
                background: white !important;
            }
            .container {
                box-shadow: none !important;
            }
            .signature-section {
                display: flex !important;
                margin-top: 50px !important;
                page-break-inside: avoid !important;
            }
        }
        
        /* Hide floating buttons from feature scripts - everything is now in Tools tab */
        #open-search-btn,
        #open-bulk-btn,
        #open-export-btn,
        #unified-tools-btn {
            display: none !important;
        }
        
        /* ===== FIX 1: TOOLS TAB ACTIVE STYLING ===== */
        .tab-btn[onclick*="tools"] {
            background: white !important;
            color: #333 !important;
            transition: all 0.3s;
        }

        .tab-btn[onclick*="tools"].active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            font-weight: bold;
        }

        .tab-btn[onclick*="tools"]:hover:not(.active) {
            background: #f5f5f5 !important;
        }

        body.dark-mode .tab-btn[onclick*="tools"]:not(.active) {
            background: #333 !important;
            color: #e0e0e0 !important;
        }
        
        /* ===== FIX 3: RESPONSIVE DESIGN FOR ALL SCREENS ===== */
        
        /* Large Desktop (1920px+) */
        @media (min-width: 1920px) {
            .container {
                max-width: 1800px;
                margin: 0 auto;
            }
        }

        /* Tablet Landscape (768px - 1023px) */
        @media (max-width: 1023px) {
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-btn {
                font-size: 13px;
                padding: 8px 15px;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* Tablet Portrait (600px - 767px) */
        @media (max-width: 767px) {
            .header h1 {
                font-size: 20px;
            }
            
            .header p {
                font-size: 11px;
            }
            
            .tabs {
                display: flex;
                overflow-x: auto;
                gap: 5px;
                padding: 5px;
            }
            
            .tab-btn {
                font-size: 12px;
                padding: 8px 12px;
                flex-shrink: 0;
            }
            
            .content {
                padding: 10px;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr !important;
            }
            
            #tools > div > div[style*="grid"] {
                grid-template-columns: 1fr !important;
            }
            
            .form-grid {
                grid-template-columns: 1fr !important;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 6px !important;
            }
        }

        /* Mobile Landscape (480px - 599px) */
        @media (max-width: 599px) {
            body {
                padding: 5px;
            }
            
            .container {
                border-radius: 8px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .logo img {
                width: 50px;
                height: 50px;
            }
            
            .btn {
                padding: 8px 15px;
                font-size: 13px;
            }
            
            .hide-mobile {
                display: none !important;
            }
        }

        /* Mobile Portrait (320px - 479px) */
        @media (max-width: 479px) {
            .header h1 {
                font-size: 16px;
            }
            
            .header p {
                font-size: 9px;
            }
            
            .tab-btn {
                font-size: 11px;
                padding: 6px 10px;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .header-actions {
                flex-direction: column;
                gap: 5px;
            }
            
            input, select, textarea {
                font-size: 14px;
            }
            
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            table {
                min-width: 600px;
            }
        }

        /* Touch device improvements */
        @media (hover: none) and (pointer: coarse) {
            .btn, .tab-btn, button {
                min-height: 44px;
                min-width: 44px;
            }
            
            .tabs {
                gap: 8px;
            }
        }

        /* Print styles */
        @media print {
            .header-actions,
            .tabs,
            .footer,
            .btn,
            button {
                display: none !important;
            }
            
            .content {
                padding: 0;
            }
            
            body {
                background: white;
                padding: 0;
            }
        }
        
        /* ===== FIX 4: ANIMATED LOGIN BACKGROUND - MOVING BALLS ===== */
        
        body.login-page {
            position: relative;
            height: 100vh;
            overflow: hidden; /* No scroll on login page */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Animated floating balls */
        body.login-page::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            top: -100px;
            left: -100px;
            animation: floatBall1 20s ease-in-out infinite;
            z-index: 0;
        }

        body.login-page::after {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            bottom: -150px;
            right: -150px;
            animation: floatBall2 25s ease-in-out infinite;
            z-index: 0;
        }

        /* Multiple animated balls */
        .login-screen::before {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.12);
            border-radius: 50%;
            top: 20%;
            right: 10%;
            animation: floatBall3 18s ease-in-out infinite;
            z-index: 0;
        }

        .login-screen::after {
            content: '';
            position: absolute;
            width: 250px;
            height: 250px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            bottom: 15%;
            left: 15%;
            animation: floatBall4 22s ease-in-out infinite;
            z-index: 0;
        }

        /* Ball animations */
        @keyframes floatBall1 {
            0%, 100% {
                transform: translate(0, 0) scale(1);
            }
            33% {
                transform: translate(100px, 100px) scale(1.1);
            }
            66% {
                transform: translate(-50px, 80px) scale(0.9);
            }
        }

        @keyframes floatBall2 {
            0%, 100% {
                transform: translate(0, 0) scale(1);
            }
            33% {
                transform: translate(-80px, -80px) scale(1.2);
            }
            66% {
                transform: translate(60px, -100px) scale(0.95);
            }
        }

        @keyframes floatBall3 {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
            50% {
                transform: translate(-100px, 50px) rotate(180deg) scale(1.15);
            }
        }

        @keyframes floatBall4 {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
            50% {
                transform: translate(80px, -60px) rotate(-180deg) scale(1.1);
            }
        }
        
        /* Login screen centered without scroll */
        .login-screen {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
        }

        /* Login box with glass effect */
        .login-container {
            position: relative;
            z-index: 2;
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            animation: fadeInScale 0.6s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Login button with ripple effect */
        .login-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .login-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .login-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        /* Input glow effect */
        .login-container input:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3),
                        0 0 20px rgba(102, 126, 234, 0.2);
            animation: inputPulse 2s ease-in-out infinite;
        }

        @keyframes inputPulse {
            0%, 100% {
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3),
                            0 0 20px rgba(102, 126, 234, 0.2);
            }
            50% {
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5),
                            0 0 30px rgba(102, 126, 234, 0.4);
            }
        }
        
        /* Ensure main container scrolls normally when logged in */
        body:not(.login-page) {
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        body:not(.login-page) .container {
            position: relative;
            z-index: 1;
        }
        
        /* Mobile responsive for login - even more compact */
        @media (max-height: 700px) {
            .login-container {
                padding: 20px 20px;
                max-width: 380px;
            }
            
            .login-logo-circle {
                width: 60px;
                height: 60px;
                margin-bottom: 10px;
            }
            
            .login-logo-inner {
                width: 42px;
                height: 42px;
                font-size: 22px;
            }
            
            .login-title h1 {
                font-size: 20px;
            }
            
            .login-subtitle {
                font-size: 13px;
                margin-bottom: 4px;
            }
            
            .login-subtitle-small {
                font-size: 11px;
                margin-bottom: 15px;
            }
            
            .login-form-group {
                margin-bottom: 12px;
            }
            
            .login-form-group label {
                font-size: 12px;
                margin-bottom: 4px;
            }
            
            .login-form-group input {
                padding: 10px 10px 10px 38px;
                font-size: 13px;
            }
            
            .login-input-icon {
                font-size: 16px;
                left: 10px;
            }
            
            .login-password-toggle {
                font-size: 16px;
                right: 10px;
            }
            
            .login-remember-row {
                margin-bottom: 14px;
            }
            
            .login-remember-label {
                font-size: 12px;
            }
            
            .login-forgot-link {
                font-size: 12px;
            }
            
            .login-button {
                padding: 11px;
                font-size: 14px;
            }
            
            .login-info-box {
                margin-top: 14px;
                padding: 10px;
            }
            
            .login-info-title {
                font-size: 11px;
                margin-bottom: 6px;
            }
            
            .login-info-text {
                font-size: 11px;
                line-height: 1.4;
            }
        }
        
        /* Extra small screens */
        @media (max-height: 600px) {
            .login-container {
                padding: 15px;
            }
            
            .login-logo-circle {
                width: 50px;
                height: 50px;
                margin-bottom: 8px;
            }
            
            .login-logo-inner {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .login-title h1 {
                font-size: 18px;
                margin-bottom: 2px;
            }
            
            .login-subtitle {
                font-size: 12px;
                margin-bottom: 2px;
            }
            
            .login-subtitle-small {
                font-size: 10px;
                margin-bottom: 10px;
            }
            
            .login-form-group {
                margin-bottom: 10px;
            }
            
            .login-info-box {
                margin-top: 10px;
                padding: 8px;
            }
        }
    </style>
    
    <!-- Enhanced Form C System CSS -->
    <link rel="stylesheet" href="enhanced-formc-system.css">
    
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div class="login-screen" id="loginScreen" style="display: flex !important; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); align-items: center; justify-content: center; z-index: 10000;">
        <div class="login-container" style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 420px; width: 90%; text-align: center;">
            <!-- Logo Circle -->
            <div class="login-logo-circle">
                <div class="login-logo-inner">
                    üçΩÔ∏è
                </div>
            </div>

            <!-- Title -->
            <div class="login-title">
                <h1>RHS MDM System</h1>
            </div>
            <div class="login-subtitle">Ramnagar High School</div>
            <div class="login-subtitle-small">Mid-Day Meal Management Portal</div>

            <!-- Error Message -->
            <div id="loginError"></div>

            <!-- Username Field -->
            <div class="login-form-group">
                <label>Username</label>
                <div class="login-input-wrapper">
                    <span class="login-input-icon">üë§</span>
                    <input type="text" id="loginUsername" placeholder="Enter your username" onkeypress="if(event.key==='Enter') performLogin()">
                </div>
            </div>

            <!-- Password Field -->
            <div class="login-form-group">
                <label>Password</label>
                <div class="login-input-wrapper">
                    <span class="login-input-icon">üîí</span>
                    <input type="password" id="loginPassword" placeholder="Enter your password" onkeypress="if(event.key==='Enter') performLogin()">
                    <button type="button" class="login-password-toggle" onclick="toggleLoginPassword()" title="Show/Hide Password">üëÅÔ∏è</button>
                </div>
            </div>

            <!-- Remember Me & Forgot Password -->
            <div class="login-remember-row">
                <label class="login-remember-label">
                    <input type="checkbox" id="rememberMe">
                    <span>Remember me</span>
                </label>
                <a href="#" class="login-forgot-link" onclick="ForgotPasswordSystem.openForgotModal(); return false;" style="color: #667eea; font-weight: 600; text-decoration: none; transition: all 0.3s;">Forgot Password?</a>
            </div>

            <!-- Login Button -->
            <button class="login-button" onclick="performLogin()">
                LOGIN TO DASHBOARD
            </button>

            <!-- Info Box -->
            <div class="login-info-box">
                <div class="login-info-title">
                    <span>üîí</span>
                    <span>Secure Access</span>
                </div>
                <p class="login-info-text">
                    This portal is exclusively for authorized school staff to manage Mid-Day Meal records and reports.
                </p>
            </div>
        </div>
    </div>

    <!-- LOCK SCREEN -->
    <div class="lock-screen" id="lockScreen">
        <div class="lock-content">
            <div class="lock-icon">üîê</div>
            <h2 style="color: #0052a3; margin-bottom: 10px;">System Locked</h2>
            <p style="color: #64748b; margin-bottom: 30px;">Enter your 4-digit PIN to unlock</p>
            
            <div class="pin-input-group">
                <input type="password" class="pin-digit" maxlength="1" id="lockPin1" />
                <input type="password" class="pin-digit" maxlength="1" id="lockPin2" />
                <input type="password" class="pin-digit" maxlength="1" id="lockPin3" />
                <input type="password" class="pin-digit" maxlength="1" id="lockPin4" />
            </div>
            
            <button class="btn-unlock" onclick="unlockSystem()">üîì Unlock System</button>
            <div class="lock-error" id="lockError">‚ùå Incorrect PIN</div>
        </div>
    </div>

    <!-- AUTO LOGOUT WARNING -->
    <div class="timeout-warning" id="timeoutWarning">
        <div class="timeout-content">
            <div style="font-size: 70px; margin-bottom: 20px;">‚ö†Ô∏è</div>
            <h2 style="color: #dc2626;">Session Expiring!</h2>
            <p style="color: #64748b;">Your session will expire in:</p>
            <div class="timeout-timer" id="timeoutTimer">2:00</div>
            <button class="btn-extend" onclick="extendSession()">‚úÖ Extend Session</button>
            <button class="btn-extend" onclick="forceLogout()" style="background: #6c757d;">üö™ Logout Now</button>
        </div>
    </div>

    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <!-- Left: Logo -->
            <div class="header-left">
                <div class="school-logo">
                    <img id="headerLogoImg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23667eea' width='100' height='100'/%3E%3Ctext x='50' y='55' font-size='45' text-anchor='middle' fill='white' font-weight='bold'%3Eüè´%3C/text%3E%3C/svg%3E" alt="School Logo">
                </div>
            </div>
            
            <!-- Center: School Info -->
            <div class="header-content">
                <p class="govt-text">Government of West Bengal</p>
                <h1>RAMNAGAR HIGH SCHOOL <span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-left: 10px; vertical-align: middle;">V2.0 üîê</span></h1>
                <p class="school-info">Uttar Ramnagar, Purba Bardhaman ‚Ä¢ Block: Ausgram-II ‚Ä¢ DISE: 19090306103 ‚Ä¢ HOI: Dasarath Bagdi ‚Ä¢ MDM I/C: Tapas Mahata</p>
            </div>

            <!-- Right: Status & Controls -->
            <div class="header-controls">
                <!-- Active Status -->
                <div class="status-badge">
                    <span class="pulse-dot"></span>
                    <span id="activityText">Active</span>
                </div>

                <!-- Clock -->
                <div class="clock">
                    <span>üïê</span>
                    <span id="clock">12:00:00</span>
                </div>

                <!-- Notification Bell -->
                <button class="notification-btn" onclick="showNotifications()" title="Notifications">
                    üîî
                    <span class="notification-badge">2</span>
                </button>

                <!-- Dark Mode Toggle -->
                <button class="dark-mode-btn" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                    üåô
                </button>

                <!-- Admin Dropdown -->
                <div class="admin-dropdown" id="adminDropdown">
                    <button class="admin-btn" onclick="toggleAdminMenu()">
                        <span>‚í∂</span>
                        <span class="user-name">Admin</span>
                        <span class="dropdown-icon">‚ñº</span>
                    </button>
                    <div class="admin-menu">
                        <div class="admin-menu-item" onclick="location.href='dashboard.html'">
                            üìä Dashboard
                        </div>
                        <div class="admin-menu-item" onclick="openPasswordModal()">
                            üîë Change Password
                        </div>
                        <div class="admin-menu-item" onclick="showLockScreen()">
                            üîí Lock Screen
                        </div>
                        <div class="admin-menu-item danger" onclick="logout()">
                            üö™ Logout
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="switchTab('form-c')">üìã Form-C Entry</button>
            <button class="tab-btn" onclick="switchTab('rice-ledger')">üåæ Rice Ledger</button>
            <button class="tab-btn" onclick="switchTab('bank-ledger')">üè¶ Bank Ledger</button>
            <button class="tab-btn" onclick="switchTab('expense-ledger')">üí∞ Expense Ledger</button>
            <button class="tab-btn" onclick="switchTab('reports')">üìÑ Reports</button>
            <button class="tab-btn" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
            <button class="tab-btn" onclick="switchTab('tools')">üéõÔ∏è Tools</button>
        </div>

        <!-- CONTENT -->
        <div class="content">

            <!-- DASHBOARD TAB -->
            <div id="dashboard" class="tab-content active">
                <!-- Dashboard Overview Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div style="border-left: 4px solid #3b82f6; padding-left: 12px;">
                        <h2 style="color: #0f172a; font-size: 18px; font-weight: 700; margin: 0;">Dashboard Overview</h2>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="showQuickActionsMenu()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none; color: white; padding: 10px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 12px; transition: all 0.3s; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)'">
                            ‚ûï Quick Entry
                        </button>
                        <button onclick="showStats()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border: none; color: white; padding: 10px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 12px; transition: all 0.3s; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(139, 92, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(139, 92, 246, 0.3)'">
                            üìä Statistics
                        </button>
                        <button onclick="exportToCSV('formCTable', 'MDM_Data')" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); border: none; color: white; padding: 10px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 12px; transition: all 0.3s; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(14, 165, 233, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(14, 165, 233, 0.3)'">
                            üì• Export CSV
                        </button>
                        <button onclick="showNotifications()" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); border: none; color: white; padding: 10px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 12px; transition: all 0.3s; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(249, 115, 22, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(249, 115, 22, 0.3)'">
                            üîî Alerts
                        </button>
                    </div>
                </div>

                <!-- Quick Actions Bar - REMOVED to match new design -->

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 30px;">
                    <!-- Card 1: Total Students Enrolled -->
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 1px solid #e2e8f0; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.12)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.06)';">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                            <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #f472b6 0%, #ec4899 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 10px rgba(236,72,153,0.25);">
                                üë•
                            </div>
                            <div>
                                <p style="font-size: 12px; color: #64748b; margin: 0; font-weight: 500;">Total Students</p>
                            </div>
                        </div>
                        <p style="font-size: 32px; font-weight: 700; color: #0f172a; margin: 0;" id="dashTotalStudents">374</p>
                        <p style="font-size: 11px; color: #94a3b8; margin: 6px 0 0 0;">V-VIII cumulative</p>
                    </div>

                    <!-- Card 2: Average Attendance -->
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 1px solid #e2e8f0; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.12)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.06)';">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                            <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 10px rgba(139,92,246,0.25);">
                                üìà
                            </div>
                            <div>
                                <p style="font-size: 12px; color: #64748b; margin: 0; font-weight: 500;">Avg Attendance</p>
                            </div>
                        </div>
                        <p style="font-size: 32px; font-weight: 700; color: #0f172a; margin: 0;" id="dashAvgAttendance">87.5%</p>
                        <p style="font-size: 11px; color: #94a3b8; margin: 6px 0 0 0;">Monthly percentage</p>
                    </div>

                    <!-- Card 3: Rice Per Meal -->
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 1px solid #e2e8f0; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.12)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.06)';">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                            <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 10px rgba(251,191,36,0.25);">
                                üçö
                            </div>
                            <div>
                                <p style="font-size: 12px; color: #64748b; margin: 0; font-weight: 500;">Rice Per Meal</p>
                            </div>
                        </div>
                        <p style="font-size: 32px; font-weight: 700; color: #0f172a; margin: 0;" id="dashRicePerMeal">100g</p>
                        <p style="font-size: 11px; color: #94a3b8; margin: 6px 0 0 0;">Avg allocation</p>
                    </div>

                    <!-- Card 4: Fund Per Meal - Class V -->
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 1px solid #e2e8f0; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.12)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.06)';">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                            <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #34d399 0%, #10b981 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 10px rgba(16,185,129,0.25);">
                                üí∞
                            </div>
                            <div>
                                <p style="font-size: 12px; color: #64748b; margin: 0; font-weight: 500;">Fund - Class V</p>
                            </div>
                        </div>
                        <p style="font-size: 32px; font-weight: 700; color: #0f172a; margin: 0;" id="dashFundClassV">‚Çπ 6.78</p>
                        <p style="font-size: 11px; color: #94a3b8; margin: 6px 0 0 0;">Per meal</p>
                    </div>

                    <!-- Card 5: Fund Per Meal - Class VI-VIII -->
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 1px solid #e2e8f0; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.12)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.06)';">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                            <div style="width: 44px; height: 44px; background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 10px rgba(59,130,246,0.25);">
                                üíµ
                            </div>
                            <div>
                                <p style="font-size: 12px; color: #64748b; margin: 0; font-weight: 500;">Fund - VI-VIII</p>
                            </div>
                        </div>
                        <p style="font-size: 32px; font-weight: 700; color: #0f172a; margin: 0;" id="dashFundClassVIVIIVIII">‚Çπ 10.17</p>
                        <p style="font-size: 11px; color: #94a3b8; margin: 6px 0 0 0;">Per meal</p>
                    </div>
                </div>

                <!-- Class-wise Student Strength -->
                <div style="border-left: 4px solid #6366f1; padding-left: 12px; margin-bottom: 16px;">
                    <h2 style="color: #0f172a; font-size: 17px; font-weight: 700; margin: 0;">üéì Class-wise Student Strength</h2>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 14px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%); border-radius: 14px; padding: 16px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.06); border: 2px solid #e0e7ff; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); border-radius: 50%; opacity: 0.1;"></div>
                        <p style="font-size: 14px; font-weight: 600; color: #6366f1; margin: 0 0 10px 0;">Class V</p>
                        <p style="font-size: 36px; font-weight: 700; color: #0f172a; margin: 0; position: relative; z-index: 1;" id="classVStrength">79</p>
                        <p style="font-size: 10px; color: #64748b; margin: 6px 0 0 0; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600;">STUDENTS</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%); border-radius: 14px; padding: 16px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.06); border: 2px solid #e0e7ff; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); border-radius: 50%; opacity: 0.1;"></div>
                        <p style="font-size: 14px; font-weight: 600; color: #6366f1; margin: 0 0 10px 0;">Class VI</p>
                        <p style="font-size: 36px; font-weight: 700; color: #0f172a; margin: 0; position: relative; z-index: 1;" id="classVIStrength">99</p>
                        <p style="font-size: 10px; color: #64748b; margin: 6px 0 0 0; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600;">STUDENTS</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #ede9fe 100%); border-radius: 14px; padding: 16px; text-align: center; box-shadow: 0 4px 12px rgba(99,102,241,0.15); border: 2px solid #c7d2fe; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); border-radius: 50%; opacity: 0.15;"></div>
                        <p style="font-size: 14px; font-weight: 600; color: #6366f1; margin: 0 0 10px 0;">Class VII ‚≠ê</p>
                        <p style="font-size: 36px; font-weight: 700; color: #0f172a; margin: 0; position: relative; z-index: 1;" id="classVIIStrength">98</p>
                        <p style="font-size: 10px; color: #64748b; margin: 6px 0 0 0; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600;">STUDENTS</p>
                    </div>
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%); border-radius: 14px; padding: 16px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.06); border: 2px solid #e0e7ff; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); border-radius: 50%; opacity: 0.1;"></div>
                        <p style="font-size: 14px; font-weight: 600; color: #6366f1; margin: 0 0 10px 0;">Class VIII</p>
                        <p style="font-size: 36px; font-weight: 700; color: #0f172a; margin: 0; position: relative; z-index: 1;" id="classVIIIStrength">98</p>
                        <p style="font-size: 10px; color: #64748b; margin: 6px 0 0 0; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600;">STUDENTS</p>
                    </div>
                </div>

                <!-- Class-wise MT Summary -->
                <div style="border-left: 4px solid #f97316; padding-left: 12px; margin-bottom: 16px;">
                    <h2 style="color: #0f172a; font-size: 17px; font-weight: 700; margin: 0;">üìù Class-wise MT Summary</h2>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 16px; margin-bottom: 30px;">
                    <!-- Primary Section -->
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%); border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 2px solid #bbf7d0;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <span style="font-size: 16px;">‚≠ê</span>
                            <h3 style="font-size: 14px; font-weight: 700; color: #15803d; margin: 0;">Primary Section</h3>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 10px rgba(34,197,94,0.25);">
                            <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
                                <span style="width: 8px; height: 8px; background: white; border-radius: 50%; display: inline-block;"></span>
                                <p style="font-size: 12px; color: white; margin: 0; font-weight: 600;">Class V TOTAL MT</p>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <p style="font-size: 10px; color: rgba(255,255,255,0.85); margin: 0 0 3px 0; font-weight: 500;">TODAY</p>
                                    <p style="font-size: 28px; font-weight: 700; color: white; margin: 0;" id="classVMTToday">0</p>
                                </div>
                                <div style="text-align: right;">
                                    <p style="font-size: 10px; color: rgba(255,255,255,0.85); margin: 0 0 3px 0; font-weight: 500;">UP TO DATE</p>
                                    <p style="font-size: 28px; font-weight: 700; color: white; margin: 0;" id="classVMTTotal">0</p>
                                </div>
                            </div>
                        </div>

                        <div style="background: #f8fafc; border-radius: 10px; padding: 14px;">
                            <p style="font-size: 11px; color: #475569; margin: 0 0 6px 0; font-weight: 600;">TOTAL MT (TODAY + UP TO DATE)</p>
                            <p style="font-size: 32px; font-weight: 700; color: #16a34a; margin: 0;" id="classVMTGrandTotal">0</p>
                        </div>
                    </div>

                    <!-- Upper Primary Section -->
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%); border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 2px solid #bfdbfe;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <span style="font-size: 16px;">üéì</span>
                            <h3 style="font-size: 14px; font-weight: 700; color: #1e40af; margin: 0;">Upper Primary Section</h3>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 10px rgba(59,130,246,0.25);">
                            <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
                                <span style="width: 8px; height: 8px; background: white; border-radius: 50%; display: inline-block;"></span>
                                <p style="font-size: 12px; color: white; margin: 0; font-weight: 600;">Class VI+VII+VIII MT</p>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <p style="font-size: 10px; color: rgba(255,255,255,0.85); margin: 0 0 3px 0; font-weight: 500;">TODAY</p>
                                    <p style="font-size: 28px; font-weight: 700; color: white; margin: 0;" id="upperPrimaryMTToday">0</p>
                                </div>
                                <div style="text-align: right;">
                                    <p style="font-size: 10px; color: rgba(255,255,255,0.85); margin: 0 0 3px 0; font-weight: 500;">UP TO DATE</p>
                                    <p style="font-size: 28px; font-weight: 700; color: white; margin: 0;" id="upperPrimaryMTTotal">0</p>
                                </div>
                            </div>
                        </div>

                        <div style="background: #f8fafc; border-radius: 10px; padding: 14px; margin-bottom: 12px;">
                            <p style="font-size: 11px; color: #475569; margin: 0 0 6px 0; font-weight: 600;">TOTAL MT (TODAY + UP TO DATE)</p>
                            <p style="font-size: 32px; font-weight: 700; color: #2563eb; margin: 0;" id="upperPrimaryMTGrandTotal">0</p>
                        </div>

                        <div style="background: #f1f5f9; border-radius: 10px; padding: 12px;">
                            <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 10px;">
                                <span style="font-size: 11px;">üìä</span>
                                <p style="font-size: 11px; color: #475569; margin: 0; font-weight: 700;">CLASS-WISE BREAKDOWN (TODAY)</p>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <div style="text-align: center;">
                                    <p style="font-size: 10px; color: #64748b; margin: 0 0 4px 0; font-weight: 600;">Class VI</p>
                                    <p style="font-size: 22px; font-weight: 700; color: #0f172a; margin: 0;" id="classVIMTToday">0</p>
                                </div>
                                <div style="text-align: center;">
                                    <p style="font-size: 10px; color: #64748b; margin: 0 0 4px 0; font-weight: 600;">Class VII</p>
                                    <p style="font-size: 22px; font-weight: 700; color: #0f172a; margin: 0;" id="classVIIMTToday">0</p>
                                </div>
                                <div style="text-align: center;">
                                    <p style="font-size: 10px; color: #64748b; margin: 0 0 4px 0; font-weight: 600;">Class VIII</p>
                                    <p style="font-size: 22px; font-weight: 700; color: #0f172a; margin: 0;" id="classVIIIMTToday">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bank Account Details -->
                <div style="border-left: 4px solid #64748b; padding-left: 12px; margin-bottom: 16px;">
                    <h2 style="color: #0f172a; font-size: 17px; font-weight: 700; margin: 0;">üè¶ Bank Account Details</h2>
                </div>

                <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); border: 2px solid #cbd5e1; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 8px rgba(59,130,246,0.2);">
                            üè¶
                        </div>
                        <h3 style="font-size: 15px; font-weight: 700; color: #0f172a; margin: 0;">Bank Account Information</h3>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 14px;">
                        <div style="background: #f8fafc; padding: 12px; border-radius: 10px; border-left: 3px solid #3b82f6;">
                            <p style="font-size: 11px; color: #64748b; margin: 0 0 5px 0; font-weight: 600;">Account Name</p>
                            <p style="font-size: 14px; font-weight: 700; color: #0f172a; margin: 0;" id="dashBankAccountName">RHS MDM Account</p>
                        </div>
                        <div style="background: #f8fafc; padding: 12px; border-radius: 10px; border-left: 3px solid #3b82f6;">
                            <p style="font-size: 11px; color: #64748b; margin: 0 0 5px 0; font-weight: 600;">Account Number</p>
                            <p style="font-size: 14px; font-weight: 700; color: #0f172a; margin: 0;" id="dashBankAccountNumber">XXXX-XXXX-XXXX</p>
                        </div>
                        <div style="background: #f8fafc; padding: 12px; border-radius: 10px; border-left: 3px solid #3b82f6;">
                            <p style="font-size: 11px; color: #64748b; margin: 0 0 5px 0; font-weight: 600;">Branch</p>
                            <p style="font-size: 14px; font-weight: 700; color: #0f172a; margin: 0;" id="dashBankBranch">State Bank of India</p>
                        </div>
                        <div style="background: #f8fafc; padding: 12px; border-radius: 10px; border-left: 3px solid #10b981;">
                            <p style="font-size: 11px; color: #64748b; margin: 0 0 5px 0; font-weight: 600;">Opening Balance</p>
                            <p style="font-size: 14px; font-weight: 700; color: #10b981; margin: 0;" id="dashOpeningBalance">‚Çπ 0.00</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FORM-C TAB -->
            <div id="form-c" class="tab-content">
                <div class="form-c-section">
                    <div class="alert alert-success" id="alertSuccess"></div>
                    <div class="alert alert-danger" id="alertError"></div>

                    <div class="form-c-header" style="background: linear-gradient(135deg, #003d7a 0%, #1e5f9e 100%); color: white; padding: 15px 20px; border-radius: 8px 8px 0 0; font-size: 20px; font-weight: bold; text-align: center; margin-bottom: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.2);">
                        üìã FORM-C: Daily MDM Entry
                    </div>

                    <!-- üëÅÔ∏è AT A GLANCE DASHBOARD -->
                    <div id="formCAtAGlance"></div>

                    <!-- ‚ö° ENHANCED FORM C - QUICK ACTIONS PANEL -->
                    <div style="background: linear-gradient(135deg, #f0f8ff 0%, #e3f2fd 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #0066cc; box-shadow: 0 3px 10px rgba(0,102,204,0.1);">
                        <h3 style="color: #0066cc; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px;">
                            ‚ö° Quick Actions
                            <span style="font-size: 12px; background: #28a745; color: white; padding: 3px 8px; border-radius: 12px; font-weight: normal;">NEW!</span>
                        </h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="EnhancedFormC.uploadExcel()" 
                                    style="padding: 10px 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 3px 10px rgba(40,167,69,0.3); transition: all 0.3s; font-size: 14px;">
                                üì• Upload Excel
                            </button>
                            <button onclick="EnhancedFormC.downloadExcelTemplate()" 
                                    style="padding: 10px 20px; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 3px 10px rgba(23,162,184,0.3); transition: all 0.3s; font-size: 14px;">
                                üìÑ Download Template
                            </button>
                            <button onclick="EnhancedFormC.autoFillDefaults()" 
                                    style="padding: 10px 20px; background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 3px 10px rgba(255,193,7,0.3); transition: all 0.3s; font-size: 14px;">
                                ‚ö° Auto-Fill
                            </button>
                            <button onclick="EnhancedFormC.openTemplatesModal()" 
                                    style="padding: 10px 20px; background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 3px 10px rgba(111,66,193,0.3); transition: all 0.3s; font-size: 14px;">
                                üìã Templates
                            </button>
                            <button onclick="EnhancedFormC.copyLastWeek()" 
                                    style="padding: 10px 20px; background: linear-gradient(135deg, #e83e8c 0%, #d63384 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 3px 10px rgba(232,62,140,0.3); transition: all 0.3s; font-size: 14px;">
                                üìÖ Copy Week
                            </button>
                            <button onclick="EnhancedFormC.openClassStrengthSettings()" 
                                    style="padding: 10px 20px; background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 3px 10px rgba(108,117,125,0.3); transition: all 0.3s; font-size: 14px;">
                                ‚öôÔ∏è Settings
                            </button>
                            <button onclick="EnhancedFormC.openHolidayManager()" 
                                    style="padding: 10px 20px; background: linear-gradient(135deg, #fd7e14 0%, #e8590c 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 3px 10px rgba(253,126,20,0.3); transition: all 0.3s; font-size: 14px;">
                                üìÖ Holidays
                            </button>
                        </div>
                        <p style="margin: 12px 0 0 0; font-size: 12px; color: #666; line-height: 1.4;">
                            üí° <strong>Tip:</strong> Use "Upload Excel" to import 30 days in 30 seconds! Download template first, fill it, then upload.
                        </p>
                    </div>

                    <!-- üìä STATS WIDGET -->
                    <div id="formCStatsWidget" style="margin-bottom: 20px;">
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <p style="text-align: center; color: #999;">üìä Loading stats...</p>
                        </div>
                    </div>

                    <!-- üìÖ CALENDAR VIEW -->
                    <div id="formCCalendarView" style="margin-bottom: 20px;">
                        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <p style="text-align: center; color: #999;">üìÖ Loading calendar...</p>
                        </div>
                    </div>

                    <div style="overflow-x: auto; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 8px;">
                        <table id="formCTable" style="width: 100%; border-collapse: collapse; background: white; min-width: 1200px;">
                            <thead>
                                <tr style="background: #0066cc; color: white;">
                                    <th rowspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; min-width: 50px; font-weight: 600;">No.</th>
                                    <th rowspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; min-width: 150px; font-weight: 600;">Date</th>
                                    <th colspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; font-weight: 600;">Class V</th>
                                    <th colspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; font-weight: 600;">Class VI</th>
                                    <th colspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; font-weight: 600;">Class VII</th>
                                    <th colspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; font-weight: 600;">Class VIII</th>
                                    <th colspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; font-weight: 600;">TOTAL VI-VIII</th>
                                    <th rowspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; min-width: 100px; font-weight: 600;">Rice(Kg)</th>
                                    <th rowspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; min-width: 100px; font-weight: 600;">Cost(‚Çπ)</th>
                                    <th rowspan="2" style="padding: 15px 10px; text-align: center; border: 1px solid white; min-width: 250px; font-weight: 600;">Menu</th>
                                </tr>
                                <tr style="background: #0066cc; color: white;">
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">CP</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">MT</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">CP</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">MT</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">CP</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">MT</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">CP</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">MT</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">CP</th>
                                    <th style="padding: 12px 8px; border: 1px solid white; font-weight: 600;">MT</th>
                                </tr>
                            </thead>
                            <tbody id="formCTableBody">
                                <tr style="background: white;">
                                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: 600; color: #003d7a;">1</td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="text" id="cpDate" placeholder="dd-mm-yyyy" maxlength="10" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" onkeyup="formatDateInput(this)" onblur="validateDateInput(this)">
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="number" id="cpV" min="0" value="0" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" oninput="calculateFormC()" onchange="calculateFormC()">
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="number" id="mtV" min="0" value="0" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" oninput="calculateFormC()" onchange="calculateFormC()">
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="number" id="cpVI" min="0" value="0" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" oninput="calculateFormC()" onchange="calculateFormC()">
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="number" id="mtVI" min="0" value="0" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" oninput="calculateFormC()" onchange="calculateFormC()">
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="number" id="cpVII" min="0" value="0" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" oninput="calculateFormC()" onchange="calculateFormC()">
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="number" id="mtVII" min="0" value="0" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" oninput="calculateFormC()" onchange="calculateFormC()">
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="number" id="cpVIII" min="0" value="0" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" oninput="calculateFormC()" onchange="calculateFormC()">
                                    </td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <input type="number" id="mtVIII" min="0" value="0" style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-size: 13px;" oninput="calculateFormC()" onchange="calculateFormC()">
                                    </td>
                                    <td style="padding: 12px 8px; border: 1px solid #ddd; background: #f0f8ff; text-align: center; font-weight: 600; color: #003d7a; font-size: 16px;" id="totalCPVI">0</td>
                                    <td style="padding: 12px 8px; border: 1px solid #ddd; background: #f0f8ff; text-align: center; font-weight: 600; color: #003d7a; font-size: 16px;" id="totalMTVI">0</td>
                                    <td style="padding: 12px 8px; border: 1px solid #ddd; background: #fff9e6; text-align: center; font-weight: 600; color: #0066cc; font-size: 16px;" id="totalRice">0.00</td>
                                    <td style="padding: 12px 8px; border: 1px solid #ddd; background: #fff9e6; text-align: center; font-weight: 600; color: #0066cc; font-size: 16px;" id="totalCost">0.00</td>
                                    <td style="padding: 5px; border: 1px solid #ddd;">
                                        <select id="formCMenu" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;">
                                            <option value="Rice + Dal + Vegetable + Ban">Rice + Dal + Vegetable + Ban</option>
                                            <option value="Rice + Dal + Potato + Fish">Rice + Dal + Potato + Fish</option>
                                            <option value="Rice + Dal + Egg + Vegetable">Rice + Dal + Egg + Vegetable</option>
                                            <option value="Rice + Lentil + Mixed Veg">Rice + Lentil + Mixed Veg</option>
                                            <option value="Khichuri + Egg">Khichuri + Egg</option>
                                            <option value="Custom">Custom Menu</option>
                                        </select>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div style="margin-top: 25px; display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; align-items: center;">
                        <button onclick="saveFormCEntry()" style="padding: 14px 28px; background: #003d7a; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 15px; display: flex; align-items: center; gap: 8px; box-shadow: 0 3px 8px rgba(0,61,122,0.3); transition: 0.3s;">
                            üíæ Save
                        </button>
                        <button onclick="validateFormC()" style="padding: 14px 28px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 15px; display: flex; align-items: center; gap: 8px; box-shadow: 0 3px 8px rgba(40,167,69,0.3); transition: 0.3s;">
                            ‚úì Validate
                        </button>
                        <button onclick="printFormC()" style="padding: 14px 28px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 15px; display: flex; align-items: center; gap: 8px; box-shadow: 0 3px 8px rgba(108,117,125,0.3); transition: 0.3s;">
                            üñ®Ô∏è Print
                        </button>
                        <button onclick="copyYesterdayFormC()" style="padding: 14px 28px; background: #ff9800; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 15px; display: flex; align-items: center; gap: 8px; box-shadow: 0 3px 8px rgba(255,152,0,0.3); transition: 0.3s;">
                            üìã Copy Yesterday
                        </button>
                        <button onclick="clearFormC()" style="padding: 14px 28px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 15px; display: flex; align-items: center; gap: 8px; box-shadow: 0 3px 8px rgba(220,53,69,0.3); transition: 0.3s;">
                            üóëÔ∏è Clear
                        </button>
                    </div>

                    <p style="margin-top: 20px; text-align: center; font-size: 13px; color: #666; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <strong>‡¶∂‡ßá‡¶∑ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ (Last Saved):</strong> <span id="lastSaveTime" style="color: #003d7a; font-weight: 600;">--:--</span>
                    </p>

                    <hr style="margin: 35px 0; border: none; border-top: 3px solid #003d7a; border-radius: 3px;">
                    
                    <h4 style="color: #003d7a; margin-bottom: 15px; font-size: 20px; font-weight: bold; text-align: center; padding: 10px; background: #f0f8ff; border-radius: 8px;">
                        üìã ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶§‡¶•‡ßç‡¶Ø (Saved Entries)
                    </h4>
                    
                    <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%); padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #0066cc;">
                        <p style="margin: 0; color: #003d7a; font-size: 14px; line-height: 1.6;">
                            <strong>‚ÑπÔ∏è ‡¶è‡¶á Section ‡¶ü‡¶ø‡¶∞ ‡¶ï‡¶æ‡¶ú:</strong> 
                            ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶¨ save ‡¶ï‡¶∞‡¶æ entries ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§ 
                            ‡¶Ø‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã entry <strong style="color: #28a745;">Edit ‚úèÔ∏è</strong> ‡¶¨‡¶æ <strong style="color: #dc3545;">Delete üóëÔ∏è</strong> ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§ 
                            Complete history tracking ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ü‡¶æ ‡¶ñ‡ßÅ‡¶¨ ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø‡•§
                        </p>
                    </div>
                    
                    <!-- Month Filter -->
                    <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 15px; background: white; padding: 15px; border-radius: 8px; border: 2px solid #003d7a;">
                        <label style="font-weight: 600; color: #003d7a; font-size: 15px;">üìÖ Month Filter:</label>
                        <select id="formCMonthFilter" onchange="filterFormCByMonth()" style="flex: 1; max-width: 250px; padding: 8px 12px; border: 2px solid #003d7a; border-radius: 5px; font-size: 14px; font-weight: 600; color: #003d7a;">
                            <option value="all">All Months (‡¶∏‡¶¨ ‡¶Æ‡¶æ‡¶∏)</option>
                        </select>
                        <button onclick="filterFormCByMonth()" style="background: linear-gradient(135deg, #003d7a 0%, #1e5f9e 100%); color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 14px;">
                            üîç Filter
                        </button>
                        <button onclick="clearAllFormCData()" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 14px; margin-left: auto;">
                            üóëÔ∏è Clear All Data
                        </button>
                        <span id="formCFilterStatus" style="color: #28a745; font-weight: 600; font-size: 13px;"></span>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="data-table" style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #003d7a 0%, #1e5f9e 100%); color: white;">
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: left; font-weight: 600;">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ (Date)</th>
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: center; font-weight: 600;">Class V</th>
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: center; font-weight: 600;">Class VI</th>
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: center; font-weight: 600;">Class VII</th>
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: center; font-weight: 600;">Class VIII</th>
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: center; font-weight: 600;">‡¶Æ‡ßã‡¶ü ‡¶ö‡¶æ‡¶≤ (Total Rice)</th>
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: center; font-weight: 600;">‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö (Total Cost)</th>
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: left; font-weight: 600;">‡¶Æ‡ßá‡¶®‡ßÅ (Menu)</th>
                                    <th style="padding: 14px; border: 1px solid #003d7a; text-align: center; font-weight: 600;">Action</th>
                                </tr>
                            </thead>
                            <tbody id="formCTableBody2" style="background: white;">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- RICE LEDGER TAB -->
            <div id="rice-ledger" class="tab-content">
                <h2 style="color: #003d7a; margin-bottom: 20px;">üçö Rice Ledger</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>üìÖ Date:</label>
                        <input type="text" id="riceLedgerDate" placeholder="dd-mm-yyyy" maxlength="10" value="" onkeyup="formatDateInput(this)" onblur="validateDateInput(this)">
                    </div>
                    <div class="form-group">
                        <label>Opening Stock (Kg):</label>
                        <input type="number" step="0.01" id="riceOpening" min="0">
                    </div>
                    <div class="form-group">
                        <label>Received (Kg):</label>
                        <input type="number" step="0.01" id="riceReceived" min="0">
                    </div>
                    <div class="form-group">
                        <label>Used (Kg):</label>
                        <input type="number" step="0.01" id="riceUsed" min="0" onchange="calculateRiceClosing()">
                    </div>
                    <div class="form-group">
                        <label>Closing Stock (Kg):</label>
                        <input type="number" step="0.01" id="riceClosing" readonly style="background: #f0f0f0;">
                    </div>
                    <div class="form-group">
                        <label>Supplier:</label>
                        <input type="text" id="riceSupplier" placeholder="Supplier Name">
                    </div>
                </div>

                <button class="btn btn-success" onclick="saveRiceLedger()">üíæ Save Rice Entry</button>
                <button class="btn btn-danger" onclick="clearRiceEntry()">üßπ Clear</button>

                <hr style="margin: 20px 0;">

                <h4 style="color: #003d7a; margin-bottom: 15px;">Rice Ledger History</h4>
                <table id="riceLedgerTable" class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Opening (Kg)</th>
                            <th>Received (Kg)</th>
                            <th>Used (Kg)</th>
                            <th>Closing (Kg)</th>
                            <th>Supplier</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="riceLedgerTableBody">
                    </tbody>
                </table>
            </div>

            <!-- BANK LEDGER TAB -->
            <div id="bank-ledger" class="tab-content">
                <h2 style="color: #003d7a; margin-bottom: 20px;">üè¶ Bank Ledger</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>üìÖ Date:</label>
                        <input type="text" id="bankDate" placeholder="dd-mm-yyyy" maxlength="10" value="" onkeyup="formatDateInput(this)" onblur="validateDateInput(this)">
                    </div>
                    <div class="form-group">
                        <label>Transaction Type:</label>
                        <select id="bankType">
                            <option value="Receipt">üí∞ Receipt</option>
                            <option value="Withdrawal">üîÑ Withdrawal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Amount (‚Çπ):</label>
                        <input type="number" step="0.01" id="bankAmount" min="0">
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <input type="text" id="bankDescription" placeholder="e.g., Government Grant, Salary">
                    </div>
                </div>

                <button class="btn btn-success" onclick="saveBankEntry()">üíæ Save Bank Entry</button>
                <button class="btn btn-danger" onclick="clearBankEntry()">üßπ Clear</button>

                <hr style="margin: 20px 0;">

                <h4 style="color: #003d7a; margin-bottom: 15px;">Bank Ledger History</h4>
                <table id="bankLedgerTable" class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount (‚Çπ)</th>
                            <th>Description</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="bankLedgerTableBody">
                    </tbody>
                </table>
            </div>

            <!-- EXPENSE LEDGER TAB -->
            <div id="expense-ledger" class="tab-content">
                <h2 style="color: #003d7a; margin-bottom: 20px;">üí∞ Expense Ledger</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label>üìÖ Date:</label>
                        <input type="text" id="expenseDate" placeholder="dd-mm-yyyy" maxlength="10" value="" onkeyup="formatDateInput(this)" onblur="validateDateInput(this)">
                    </div>
                    <div class="form-group">
                        <label>Category:</label>
                        <select id="expenseCategory">
                            <option value="Food">üçï Food Items</option>
                            <option value="Fuel">üî• Fuel</option>
                            <option value="Salary">üíº Salary</option>
                            <option value="Maintenance">üîß Maintenance</option>
                            <option value="Other">üìå Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Amount (‚Çπ):</label>
                        <input type="number" step="0.01" id="expenseAmount" min="0">
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <input type="text" id="expenseDescription" placeholder="Details">
                    </div>
                </div>

                <button class="btn btn-success" onclick="saveExpenseEntry()">üíæ Save Expense</button>
                <button class="btn btn-danger" onclick="clearExpenseEntry()">üßπ Clear</button>

                <hr style="margin: 20px 0;">

                <h4 style="color: #003d7a; margin-bottom: 15px;">Expense Ledger History</h4>
                <table id="expenseLedgerTable" class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Amount (‚Çπ)</th>
                            <th>Description</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="expenseLedgerTableBody">
                    </tbody>
                </table>
            </div>

            <!-- SETTINGS TAB -->
            <div id="settings" class="tab-content">
                <!-- Important Instructions Box -->
                <div style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3); border-left: 5px solid #ff6f00;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 40px;">üí°</div>
                        <div>
                            <h3 style="margin: 0 0 5px 0; font-size: 18px; font-weight: 700;">‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£!</h3>
                            <p style="margin: 0; font-size: 14px; line-height: 1.5;">‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á <strong>"üíæ ‡¶∏‡¶¨ Settings ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®"</strong> ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßá‡¶≠ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ!</p>
                        </div>
                    </div>
                </div>

                <!-- Top Header with Buttons -->
                <div style="background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%); color: white; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <div style="width: 35px; height: 35px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">üçΩÔ∏è</div>
                            <h2 style="margin: 0; font-size: 20px; font-weight: bold;">MDM Control Center ‚Äî v23.1 Ultimate</h2>
                        </div>
                        <p style="margin: 0; font-size: 13px; opacity: 0.9; padding-left: 45px;">Government of West Bengal ‚Ä¢ Ramnagar High School</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="changeTheme()" style="background: white; color: #4A90E2; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 13px;">üé® Theme</button>
                        <button onclick="exportData()" style="background: white; color: #4A90E2; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 13px;">üì• Export</button>
                        <button onclick="document.getElementById('importInput').click()" style="background: white; color: #4A90E2; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 13px;">üì§ Import</button>
                        <button onclick="lockSystem()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 13px;">üîí Lock</button>
                    </div>
                </div>

                <!-- Action Buttons Bar -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                    <div style="display: flex; gap: 10px;">
                        <button onclick="saveAllSettings()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 15px; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40, 167, 69, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(40, 167, 69, 0.4)'">üíæ ‡¶∏‡¶¨ Settings ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <button onclick="loadSettings()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 5px; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">üìÇ Load</button>
                        <button onclick="resetSettings()" style="background: rgba(220,53,69,0.9); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 5px; transition: all 0.3s;" onmouseover="this.style.background='#dc3545'" onmouseout="this.style.background='rgba(220,53,69,0.9)'">‚Üª Reset</button>
                    </div>
                    <div style="font-size: 13px; color: white; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px;">
                        <strong>Status:</strong> <span style="color: #90EE90; font-weight: 700;">‚óè Ready</span>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- Left Column - Main Settings -->
                    <div>
                        <!-- Control Center Header -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #4A90E2;">
                            <h3 style="color: #4A90E2; margin-bottom: 5px; font-size: 18px; font-weight: 600;">üìä Control Center ‚Äî Manage School & MDM Master Data</h3>
                            <p style="margin: 0; font-size: 12px; color: #666;">All changes are saved locally (browser). Use Export to backup JSON.</p>
                        </div>

                        <!-- Logo Upload Section -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.25);">
                            <h3 style="color: white; margin-bottom: 15px; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">üè´ ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤‡ßá‡¶∞ Logo ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <!-- Header Logo -->
                                <div class="form-group">
                                    <label style="font-size: 12px; color: rgba(255,255,255,0.95); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: block;">üìå Header Logo</label>
                                    
                                    <!-- Current Logo Preview -->
                                    <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 6px; margin-bottom: 8px; text-align: center; border: 2px dashed rgba(255,255,255,0.3);">
                                        <img id="headerLogoPreview" src="" style="max-width: 80px; max-height: 80px; object-fit: contain; display: none;">
                                        <div id="headerLogoPlaceholder" style="color: rgba(255,255,255,0.7); font-size: 48px;">üè´</div>
                                        <p style="color: rgba(255,255,255,0.8); font-size: 11px; margin: 5px 0 0 0;">Current Logo</p>
                                    </div>
                                    
                                    <input type="file" id="headerLogoInput" accept="image/*" style="width: 100%; background: rgba(255,255,255,0.15); padding: 8px; border: 1px solid rgba(255,255,255,0.4); border-radius: 4px; font-size: 11px; color: rgba(255,255,255,0.8); margin-bottom: 8px;">
                                    <button onclick="uploadHeaderLogo()" style="background: rgba(255,255,255,0.25); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 600; width: 100%; font-size: 12px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);" onmouseover="this.style.background='rgba(255,255,255,0.35)'" onmouseout="this.style.background='rgba(255,255,255,0.25)'">üì§ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                                </div>
                                
                                <!-- Footer Logo -->
                                <div class="form-group">
                                    <label style="font-size: 12px; color: rgba(255,255,255,0.95); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: block;">üìå Footer Logo</label>
                                    
                                    <!-- Current Logo Preview -->
                                    <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 6px; margin-bottom: 8px; text-align: center; border: 2px dashed rgba(255,255,255,0.3);">
                                        <img id="footerLogoPreview" src="" style="max-width: 80px; max-height: 80px; object-fit: contain; display: none;">
                                        <div id="footerLogoPlaceholder" style="color: rgba(255,255,255,0.7); font-size: 48px;">üåæ</div>
                                        <p style="color: rgba(255,255,255,0.8); font-size: 11px; margin: 5px 0 0 0;">Current Logo</p>
                                    </div>
                                    
                                    <input type="file" id="footerLogoInput" accept="image/*" style="width: 100%; background: rgba(255,255,255,0.15); padding: 8px; border: 1px solid rgba(255,255,255,0.4); border-radius: 4px; font-size: 11px; color: rgba(255,255,255,0.8); margin-bottom: 8px;">
                                    <button onclick="uploadFooterLogo()" style="background: rgba(255,255,255,0.25); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 600; width: 100%; font-size: 12px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);" onmouseover="this.style.background='rgba(255,255,255,0.35)'" onmouseout="this.style.background='rgba(255,255,255,0.25)'">üì§ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                                </div>
                            </div>
                            
                            <!-- Instructions -->
                            <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; border-left: 3px solid rgba(255,255,255,0.5);">
                                <p style="color: rgba(255,255,255,0.9); font-size: 11px; margin: 0; line-height: 1.5;">
                                    üí° <strong>‡¶ü‡¶ø‡¶™‡¶∏:</strong> PNG/JPG format ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶ø‡¶§ ‚Ä¢ Maximum 2MB ‚Ä¢ Square logos ‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶≠‡¶æ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ‡¶Ø‡¶º ‚Ä¢ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                                </p>
                            </div>
                        </div>

                        <!-- School Information -->
                        <div class="settings-section orange">
                            <h3>üè´ School Information</h3>
                            <div class="settings-grid">
                                <div class="form-group">
                                    <label>School Name</label>
                                    <input type="text" id="settingsSchoolName" value="Ramnagar High School" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>HOI Name</label>
                                    <input type="text" id="settingsHOI" value="Dasarath Bagdi" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Block</label>
                                    <input type="text" id="settingsBlock" value="Ausgram-II" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>HOI Designation</label>
                                    <input type="text" id="settingsHOIDesignation" value="Headmaster" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group full">
                                    <label>Address</label>
                                    <input type="text" id="settingsLocation" value="P.O: Uttar Ramnagar, Purba Bardhaman" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>HOI Mobile</label>
                                    <input type="tel" id="settingsHOIMobile" value="9679656985" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>DISE Code</label>
                                    <input type="text" id="settingsDISE" value="19090306103" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>MDM I/C Name</label>
                                    <input type="text" id="settingsMDMIC" value="Tapas Mahata" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Category</label>
                                    <input type="text" id="settingsCategory" value="Govt. Sponsored" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>MDM I/C Mobile</label>
                                    <input type="tel" id="settingsMDMICMobile" value="" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>District (‡¶ú‡ßá‡¶≤‡¶æ)</label>
                                    <input type="text" id="settingsDistrict" value="PURBA BARDHAMAN" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Subdivision (‡¶Æ‡¶π‡¶ï‡ßÅ‡¶Æ‡¶æ)</label>
                                    <input type="text" id="settingsSubdivision" value="BARDHAMAN SADAR N" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>GP/Ward (‡¶ó‡ßç‡¶∞‡¶æ.‡¶™./‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°)</label>
                                    <input type="text" id="settingsGPWard" value="UTTAR RAMNAGAR" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>SHG Name (‡¶ó‡ßã‡¶∑‡ßç‡¶†‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ)</label>
                                    <input type="text" id="settingsSHGName" value="MA MANASA MATA" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Contact No (‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶®‡¶Ç)</label>
                                    <input type="tel" id="settingsContactNo" value="9679699886" style="background: #f8f9fa;">
                                </div>
                            </div>
                        </div>

                        <!-- Enrollment Section -->
                        <div class="settings-section green">
                            <h3>üë• Enrollment (Class-wise)</h3>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 12px;">
                                <div class="form-group">
                                    <label>Class V</label>
                                    <input type="number" id="enrollmentV" value="79" min="0" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Class VI</label>
                                    <input type="number" id="enrollmentVI" value="99" min="0" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Class VII</label>
                                    <input type="number" id="enrollmentVII" value="98" min="0" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Class VIII</label>
                                    <input type="number" id="enrollmentVIII" value="98" min="0" style="background: #f8f9fa;">
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding-top: 12px; border-top: 1px solid #dee2e6;">
                                <div style="background: #e8f5e9; padding: 10px; border-radius: 5px; text-align: center;">
                                    <p style="font-size: 11px; color: #666; margin: 0; text-transform: uppercase; font-weight: 600;">Primary (V)</p>
                                    <p style="font-size: 20px; font-weight: bold; color: #28a745; margin: 4px 0 0 0;" id="totalPrimaryDisplay">79</p>
                                </div>
                                <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; text-align: center;">
                                    <p style="font-size: 11px; color: #666; margin: 0; text-transform: uppercase; font-weight: 600;">Upper Primary (VI-VIII)</p>
                                    <p style="font-size: 20px; font-weight: bold; color: #2196F3; margin: 4px 0 0 0;" id="totalUpperPrimaryDisplay">295</p>
                                </div>
                            </div>
                        </div>

                        <!-- MDM Parameters -->
                        <div class="settings-section purple">
                            <h3>üçö Rice & Cooking Cost per Student</h3>
                            <div class="settings-grid" style="grid-template-columns: repeat(2, 1fr);">
                                <div class="form-group">
                                    <label>Rice - Class V (gm)</label>
                                    <input type="number" id="riceClassV" value="100" min="0" step="1" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Cost - Class V (‚Çπ)</label>
                                    <input type="number" id="costClassV" value="6.78" min="0" step="0.01" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Rice - VI-VIII (gm)</label>
                                    <input type="number" id="riceClassVIVIIVIII" value="150" min="0" step="1" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Cost - VI-VIII (‚Çπ)</label>
                                    <input type="number" id="costClassVIVIIVIII" value="10.17" min="0" step="0.01" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Rice Opening (kg)</label>
                                    <input type="number" id="riceOpeningStock" value="524.01" min="0" step="0.01" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Rice Received (kg)</label>
                                    <input type="number" id="riceReceivedStock" value="0" min="0" step="0.01" style="background: #f8f9fa;">
                                </div>
                                <div class="form-group">
                                    <label>Fund Opening (‚Çπ)</label>
                                    <input type="number" id="fundOpening" value="120000" min="0" step="1" style="background: #f8f9fa;">
                                </div>
                            </div>
                        </div>

                        <!-- Cook Details -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #ff5722;">
                            <h3 style="color: #ff5722; margin-bottom: 15px; font-size: 16px; font-weight: 600;">üë®‚Äçüç≥ Cook Details</h3>
                            
                            <!-- Add Cook Form -->
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #ff5722; margin-bottom: 12px; font-size: 14px; font-weight: 600;">Add New Cook-cum-Helper</h4>
                                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1.2fr auto; gap: 10px; align-items: end;">
                                    <div>
                                        <label style="font-size: 12px; color: #666; font-weight: 500; display: block; margin-bottom: 5px;">Full Name *</label>
                                        <input type="text" id="newCookName" placeholder="Enter cook name" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 13px;">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666; font-weight: 500; display: block; margin-bottom: 5px;">Gender *</label>
                                        <select id="newCookGender" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 13px;">
                                            <option value="M">Male</option>
                                            <option value="F">Female</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666; font-weight: 500; display: block; margin-bottom: 5px;">Category *</label>
                                        <select id="newCookCaste" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 13px;">
                                            <option value="GEN">General</option>
                                            <option value="OBC">OBC</option>
                                            <option value="SC">SC</option>
                                            <option value="ST">ST</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666; font-weight: 500; display: block; margin-bottom: 5px;">Payment *</label>
                                        <select id="newCookPaymentMode" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 13px;">
                                            <option value="Bank">Bank</option>
                                            <option value="Cash">Cash</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666; font-weight: 500; display: block; margin-bottom: 5px;">Amount (‚Çπ) *</label>
                                        <input type="number" id="newCookAmount" placeholder="Amount" min="0" step="0.01" value="1500" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 13px;">
                                    </div>
                                    <button onclick="addNewCook()" style="padding: 8px 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 13px; white-space: nowrap;">
                                        ‚ûï Add Cook
                                    </button>
                                </div>
                            </div>

                            <!-- Cooks List -->
                            <div id="cooksListContainer">
                                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px; width: 40px;">#</th>
                                            <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px;">Name</th>
                                            <th style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-size: 13px; width: 80px;">Gender</th>
                                            <th style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-size: 13px; width: 90px;">Category</th>
                                            <th style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-size: 13px; width: 90px;">Payment</th>
                                            <th style="padding: 10px; text-align: right; border: 1px solid #dee2e6; font-size: 13px; width: 100px;">Amount (‚Çπ)</th>
                                            <th style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-size: 13px; width: 80px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cooksTableBody">
                                        <!-- Cooks will be populated here -->
                                    </tbody>
                                </table>
                                <p id="noCooksMessage" style="text-align: center; padding: 20px; color: #999; font-size: 13px; display: none;">
                                    No cook-cum-helpers added yet. Click "Add Cook" to add.
                                </p>
                            </div>
                            
                            <p style="font-size: 11px; color: #999; margin: 10px 0 0 0;">üíæ Cook details will be saved when you click "Save Settings" button</p>
                        </div>

                        <!-- Staff & Management -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #00bcd4;">
                            <h3 style="color: #00bcd4; margin-bottom: 15px; font-size: 16px; font-weight: 600;">üíº Staff & Management</h3>
                            
                            <!-- Add Staff Form -->
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #00bcd4; margin-bottom: 12px; font-size: 14px; font-weight: 600;">Add New Staff</h4>
                                <div style="display: grid; grid-template-columns: 2fr 1.5fr 1.5fr auto; gap: 10px; align-items: end;">
                                    <div>
                                        <label style="font-size: 12px; color: #666; font-weight: 500; display: block; margin-bottom: 5px;">Teacher Name</label>
                                        <input type="text" id="newStaffName" placeholder="Enter teacher name" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 13px;">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666; font-weight: 500; display: block; margin-bottom: 5px;">Designation</label>
                                        <input type="text" id="newStaffDesignation" placeholder="e.g., HOI, Assistant Teacher" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 13px;">
                                    </div>
                                    <div>
                                        <label style="font-size: 12px; color: #666; font-weight: 500; display: block; margin-bottom: 5px;">Mobile</label>
                                        <input type="tel" id="newStaffMobile" placeholder="10-digit mobile" maxlength="10" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 13px;">
                                    </div>
                                    <button onclick="addNewStaff()" style="padding: 8px 20px; background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; font-size: 13px; white-space: nowrap;">
                                        ‚ûï Add Staff
                                    </button>
                                </div>
                            </div>

                            <!-- Staff List -->
                            <div id="staffListContainer">
                                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                                    <thead>
                                        <tr style="background: #f8f9fa;">
                                            <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px; width: 50px;">#</th>
                                            <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px;">Name</th>
                                            <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px;">Designation</th>
                                            <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px; width: 120px;">Mobile</th>
                                            <th style="padding: 10px; text-align: center; border: 1px solid #dee2e6; font-size: 13px; width: 80px;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="staffTableBody">
                                        <!-- Staff will be populated here -->
                                    </tbody>
                                </table>
                                <p id="noStaffMessage" style="text-align: center; padding: 20px; color: #999; font-size: 13px; display: none;">
                                    No staff added yet. Click "Add Staff" to add.
                                </p>
                            </div>
                            
                            <p style="font-size: 11px; color: #999; margin: 10px 0 0 0;">üíæ Staff details will be saved when you click "Save Settings" button</p>
                        </div>

                        <!-- Weekly Menu -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #f44336;">
                            <h3 style="color: #f44336; margin-bottom: 15px; font-size: 16px; font-weight: 600;">üìÖ Weekly Menu (Mon-Sat)</h3>
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px; font-weight: 600; width: 100px;">Day</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px; font-weight: 600;">Main Course</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6; font-size: 13px; font-weight: 600; width: 150px;">Snack</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; font-weight: 500;">Monday</td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuMon1" value="Dal, Vegetable" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuMon2" value="Banana" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; font-weight: 500;">Tuesday</td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuTue1" value="Dal, Vegetable, Egg Curry" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuTue2" value="Egg" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; font-weight: 500;">Wednesday</td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuWed1" value="Dal, Soya Bean" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuWed2" value="Soya Snacks" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; font-weight: 500;">Thursday</td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuThu1" value="Dal, Vegetable" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuThu2" value="Fruit" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; font-weight: 500;">Friday</td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuFri1" value="Dal, Vegetable" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuFri2" value="Fruit" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; font-weight: 500;">Saturday</td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuSat1" value="Dal, Soya Bean" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6;"><input type="text" id="menuSat2" value="Soya Snacks" style="width: 100%; padding: 6px; border: 1px solid #dee2e6; border-radius: 3px; font-size: 13px;"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Bank & Other Details -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #607d8b;">
                            <h3 style="color: #607d8b; margin-bottom: 15px; font-size: 16px; font-weight: 600;">üè¶ Bank Account Details</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label style="font-size: 13px; color: #666; font-weight: 500;">Bank Account Name</label>
                                    <input type="text" id="bankAccountName" value="Ramnagar High School (MDM)" style="width: 100%; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 14px;">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 13px; color: #666; font-weight: 500;">Account Number</label>
                                    <input type="text" id="bankAccountNumber" value="1120011004752" style="width: 100%; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 14px;">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 13px; color: #666; font-weight: 500;">Bank & Branch</label>
                                    <input type="text" id="bankBranch" value="Uttar Ramnagar, SBI" style="width: 100%; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 14px;">
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 13px; color: #666; font-weight: 500;">IFSC Code</label>
                                    <input type="text" id="bankIFSC" value="SBIN0020000" style="width: 100%; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 14px;">
                                </div>
                            </div>
                        </div>

                        <!-- Security & Save -->
                        <div style="background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%); padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 2px solid #fb923c;">
                            <h3 style="color: #e91e63; margin-bottom: 5px; font-size: 16px; font-weight: 600;">üîê Security & PIN Lock</h3>
                            <p style="font-size: 12px; color: #92400e; margin-bottom: 15px; font-weight: 500;">
                                <strong>Current PIN Status:</strong> <span id="pinStatusText">Default PIN Active (1234)</span>
                            </p>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label style="font-size: 13px; color: #666; font-weight: 500;">üîë New PIN (4 digits)</label>
                                    <div style="display: flex; gap: 8px;">
                                        <input type="password" id="changePIN" placeholder="Enter 4-digit PIN" maxlength="4" style="flex: 1; background: white; padding: 10px; border: 2px solid #fb923c; border-radius: 5px; font-size: 14px;">
                                        <button onclick="togglePinVisibility('changePIN')" style="background: #f8f9fa; border: 2px solid #dee2e6; padding: 10px 14px; border-radius: 5px; cursor: pointer; font-size: 14px;">üëÅÔ∏è</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 13px; color: #666; font-weight: 500;">üîë Confirm PIN (4 digits)</label>
                                    <div style="display: flex; gap: 8px;">
                                        <input type="password" id="confirmPIN" placeholder="Re-enter PIN" maxlength="4" style="flex: 1; background: white; padding: 10px; border: 2px solid #fb923c; border-radius: 5px; font-size: 14px;">
                                        <button onclick="togglePinVisibility('confirmPIN')" style="background: #f8f9fa; border: 2px solid #dee2e6; padding: 10px 14px; border-radius: 5px; cursor: pointer; font-size: 14px;">üëÅÔ∏è</button>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="applyPIN()" style="flex: 1; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">üîê Apply New PIN</button>
                                <button onclick="showLockScreen()" style="flex: 1; background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);">üîí Lock System Now</button>
                            </div>
                            <div style="background: rgba(251, 146, 60, 0.1); padding: 12px; border-radius: 8px; margin-top: 15px; border: 1px solid #fb923c;">
                                <div style="font-size: 13px; font-weight: 600; color: #ea580c; margin-bottom: 5px;">üîê PIN Protection Active</div>
                                <div style="font-size: 12px; color: #78350f;">System can be locked manually or will auto-lock on logout</div>
                            </div>
                        </div>

                        <!-- Auto Logout Settings -->
                        <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #3b82f6;">
                            <h3 style="color: #3b82f6; margin-bottom: 15px; font-size: 16px; font-weight: 600;">‚è±Ô∏è Auto Logout Settings</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label style="font-size: 13px; color: #666; font-weight: 500;">Idle Timeout Duration</label>
                                    <select id="settings_timeout" onchange="updateTimeoutSetting()" style="width: 100%; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 14px;">
                                        <option value="900000">15 minutes</option>
                                        <option value="1800000" selected>30 minutes</option>
                                        <option value="2700000">45 minutes</option>
                                        <option value="3600000">60 minutes</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label style="font-size: 13px; color: #666; font-weight: 500;">Warning Before Logout</label>
                                    <select id="settings_warningTime" style="width: 100%; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 14px;">
                                        <option value="60000">1 minute</option>
                                        <option value="120000" selected>2 minutes</option>
                                        <option value="180000">3 minutes</option>
                                    </select>
                                </div>
                            </div>
                            <div style="background: rgba(59, 130, 246, 0.1); border: 2px solid #3b82f6; border-radius: 8px; padding: 15px; margin-top: 15px;">
                                <div style="font-weight: 600; color: #1e40af; margin-bottom: 8px;">‚ÑπÔ∏è Auto Logout Features:</div>
                                <ul style="margin-left: 20px; color: #1e40af; font-size: 13px; line-height: 1.8;">
                                    <li>Automatic logout after specified idle time</li>
                                    <li>Warning notification before logout</li>
                                    <li>Data auto-saved before logout</li>
                                    <li>Activity tracking (mouse, keyboard, clicks)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Enhanced Live Preview & More -->
                    <div>
                        <!-- Live Preview -->
                        <div style="background: white; padding: 18px; border-radius: 10px; margin-bottom: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); position: sticky; top: 20px; border: 2px solid #e3f2fd;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <h3 style="color: #0052a3; margin: 0; font-size: 17px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 24px;">üìä</span>
                                    Live Preview
                                </h3>
                                <button onclick="refreshPreview()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">üîÑ Refresh</button>
                            </div>
                            
                            <div style="text-align: center; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                                <div style="width: 70px; height: 70px; background: white; border-radius: 50%; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; font-size: 32px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">üè´</div>
                                <h4 id="previewSchoolName" style="margin: 8px 0 5px 0; font-size: 15px; font-weight: 700; color: white;">Ramnagar High School</h4>
                                <p id="previewDISE" style="font-size: 11px; color: rgba(255,255,255,0.9); margin: 0; font-weight: 500;">DISE: 19090306103</p>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); padding: 12px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 3px 10px rgba(40, 167, 69, 0.2);">
                                <p style="font-size: 11px; color: rgba(255,255,255,0.9); margin: 0 0 4px 0; font-weight: 500;">MDM In-Charge</p>
                                <p id="previewMDMIC" style="font-size: 14px; font-weight: 700; color: white; margin: 0;">Tapas Mahata</p>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                <div style="background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); padding: 12px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(255, 152, 0, 0.2);">
                                    <p style="font-size: 24px; font-weight: 700; color: white; margin: 0;" id="previewTotalEnrollment">374</p>
                                    <p style="font-size: 10px; color: rgba(255,255,255,0.9); margin: 4px 0 0 0; text-transform: uppercase; font-weight: 600;">Students</p>
                                </div>
                                <div style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); padding: 12px; border-radius: 8px; text-align: center; box-shadow: 0 3px 10px rgba(33, 150, 243, 0.2);">
                                    <p style="font-size: 24px; font-weight: 700; color: white; margin: 0;" id="previewFormCCount">0</p>
                                    <p style="font-size: 10px; color: rgba(255,255,255,0.9); margin: 4px 0 0 0; text-transform: uppercase; font-weight: 600;">Entries</p>
                                </div>
                            </div>

                            <div style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); padding: 12px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 3px 10px rgba(156, 39, 176, 0.2);">
                                <p style="font-size: 11px; color: rgba(255,255,255,0.9); margin: 0 0 4px 0; font-weight: 500;">Rice per Meal</p>
                                <p id="previewRicePerMeal" style="font-size: 16px; font-weight: 700; color: white; margin: 0;">100g V | 150g VI-VIII</p>
                            </div>

                            <div style="background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%); padding: 12px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0, 188, 212, 0.2);">
                                <p style="font-size: 11px; color: rgba(255,255,255,0.9); margin: 0 0 4px 0; font-weight: 500;">Cost per Meal</p>
                                <p id="previewCostPerMeal" style="font-size: 16px; font-weight: 700; color: white; margin: 0;">‚Çπ6.78 V | ‚Çπ10.17 VI-VIII</p>
                            </div>

                            <div style="margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                                <p style="font-size: 10px; color: #666; margin: 0; line-height: 1.5;">
                                    <strong>üí° Note:</strong> Preview updates automatically when you change settings. Click "Save Settings" to make changes permanent.
                                </p>
                            </div>
                        </div>

                        <!-- Quick Stats Widget - NEW! -->
                        <div style="background: white; padding: 18px; border-radius: 10px; margin-bottom: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #e8f5e9;">
                            <h3 style="color: #28a745; margin: 0 0 15px 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <span style="font-size: 22px;">üìà</span>
                                Quick Statistics
                            </h3>
                            
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #e8f5e9; border-radius: 6px;">
                                    <span style="font-size: 12px; color: #666; font-weight: 500;">Total Cooks</span>
                                    <span id="statsCoooksCount" style="font-size: 18px; font-weight: 700; color: #28a745;">0</span>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #e3f2fd; border-radius: 6px;">
                                    <span style="font-size: 12px; color: #666; font-weight: 500;">Total Staff</span>
                                    <span id="statsStaffCount" style="font-size: 18px; font-weight: 700; color: #2196F3;">0</span>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #fff3e0; border-radius: 6px;">
                                    <span style="font-size: 12px; color: #666; font-weight: 500;">Rice Entries</span>
                                    <span id="statsRiceCount" style="font-size: 18px; font-weight: 700; color: #ff9800;">0</span>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f3e5f5; border-radius: 6px;">
                                    <span style="font-size: 12px; color: #666; font-weight: 500;">Bank Entries</span>
                                    <span id="statsBankCount" style="font-size: 18px; font-weight: 700; color: #9c27b0;">0</span>
                                </div>
                            </div>
                            
                            <button onclick="showStats()" style="width: 100%; margin-top: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 15px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                üìä View Full Statistics
                            </button>
                        </div>

                        <!-- System Health - NEW! -->
                        <div style="background: white; padding: 18px; border-radius: 10px; margin-bottom: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #e0f2f1;">
                            <h3 style="color: #00bcd4; margin: 0 0 15px 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <span style="font-size: 22px;">üè•</span>
                                System Health
                            </h3>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                    <span style="font-size: 11px; color: #666; font-weight: 500;">Data Integrity</span>
                                    <span style="font-size: 11px; color: #28a745; font-weight: 700;">‚úÖ 100%</span>
                                </div>
                                <div style="background: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: linear-gradient(90deg, #28a745, #20c997); width: 100%; height: 100%;"></div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                    <span style="font-size: 11px; color: #666; font-weight: 500;">Storage Used</span>
                                    <span id="storageUsed" style="font-size: 11px; color: #ff9800; font-weight: 700;">Calculating...</span>
                                </div>
                                <div style="background: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div id="storageBar" style="background: linear-gradient(90deg, #ff9800, #ff5722); width: 25%; height: 100%;"></div>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px;">
                                <div style="background: #e8f5e9; padding: 8px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 16px;">‚úÖ</div>
                                    <div style="font-size: 10px; color: #28a745; font-weight: 600; margin-top: 4px;">All Systems OK</div>
                                </div>
                                <div style="background: #e3f2fd; padding: 8px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 16px;">üîí</div>
                                    <div style="font-size: 10px; color: #2196F3; font-weight: 600; margin-top: 4px;">Data Secure</div>
                                </div>
                            </div>
                        </div>

                        <!-- Pro Tips - NEW! -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 18px; border-radius: 10px; margin-bottom: 16px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); color: white;">
                            <h3 style="color: white; margin: 0 0 15px 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px;">
                                <span style="font-size: 22px;">üí°</span>
                                Pro Tips
                            </h3>
                            
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 6px; backdrop-filter: blur(10px);">
                                    <div style="font-weight: 600; font-size: 12px; margin-bottom: 4px;">‚å®Ô∏è Keyboard Shortcut</div>
                                    <div style="font-size: 11px; opacity: 0.9; line-height: 1.4;">Press <kbd style="background: rgba(255,255,255,0.2); padding: 2px 6px; border-radius: 3px; font-size: 10px;">Ctrl+S</kbd> to save settings quickly</div>
                                </div>
                                
                                <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 6px; backdrop-filter: blur(10px);">
                                    <div style="font-weight: 600; font-size: 12px; margin-bottom: 4px;">üíæ Auto-Backup</div>
                                    <div style="font-size: 11px; opacity: 0.9; line-height: 1.4;">Export data weekly to avoid any data loss</div>
                                </div>
                                
                                <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 6px; backdrop-filter: blur(10px);">
                                    <div style="font-weight: 600; font-size: 12px; margin-bottom: 4px;">üìä Data Accuracy</div>
                                    <div style="font-size: 11px; opacity: 0.9; line-height: 1.4;">Always verify enrollment numbers match school records</div>
                                </div>
                                
                                <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 6px; backdrop-filter: blur(10px);">
                                    <div style="font-weight: 600; font-size: 12px; margin-bottom: 4px;">üîí Security</div>
                                    <div style="font-size: 11px; opacity: 0.9; line-height: 1.4;">Lock system when leaving computer unattended</div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions Widget - NEW! -->
                        <div style="background: white; padding: 18px; border-radius: 10px; margin-bottom: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #fff3e0;">
                            <h3 style="color: #ff9800; margin: 0 0 15px 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <span style="font-size: 22px;">‚ö°</span>
                                Quick Actions
                            </h3>
                            
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button onclick="switchTab('form-c')" style="width: 100%; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; text-align: left; display: flex; align-items: center; gap: 8px; transition: all 0.3s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
                                    <span>üìù</span> <span>Add Form-C Entry</span>
                                </button>
                                
                                <button onclick="generateFormCPDF()" style="width: 100%; background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; text-align: left; display: flex; align-items: center; gap: 8px; transition: all 0.3s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
                                    <span>üìÑ</span> <span>Generate PDF Report</span>
                                </button>
                                
                                <button onclick="exportData()" style="width: 100%; background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; text-align: left; display: flex; align-items: center; gap: 8px; transition: all 0.3s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
                                    <span>üíæ</span> <span>Backup All Data</span>
                                </button>
                                
                                <button onclick="showLockScreen()" style="width: 100%; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; text-align: left; display: flex; align-items: center; gap: 8px; transition: all 0.3s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
                                    <span>üîí</span> <span>Lock System Now</span>
                                </button>
                            </div>
                        </div>

                        <!-- Import / Export -->
                        <div style="background: white; padding: 18px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #f3e5f5;">
                            <h3 style="color: #9c27b0; margin: 0 0 15px 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <span style="font-size: 22px;">üìÇ</span>
                                Data Management
                            </h3>
                            <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                                <button onclick="exportData()" style="flex: 1; background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">‚Üì Export</button>
                                <button onclick="document.getElementById('importInput').click()" style="flex: 1; background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">‚Üë Import</button>
                            </div>
                            <p style="font-size: 10px; color: #999; margin: 0; line-height: 1.5; padding: 10px; background: #f8f9fa; border-radius: 6px;">üí° Export saves all settings, Form-C entries, ledgers & master data in one JSON file. Keep regular backups!</p>
                        </div>
                        
                        <!-- TODAY'S QUICK INFO -->
                        <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); padding: 18px; border-radius: 10px; margin-top: 16px; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);">
                            <h3 style="color: white; margin: 0 0 12px 0; font-size: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">üìÖ</span>
                                ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø
                            </h3>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px; margin-bottom: 8px;">
                                <div style="font-size: 11px; color: rgba(255,255,255,0.9); margin-bottom: 4px;">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</div>
                                <div style="font-size: 18px; font-weight: 700; color: white;" id="widgetTodayDate">19-11-2025</div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 9px; color: rgba(255,255,255,0.8);">‡¶∏‡¶Æ‡¶Ø‡¶º</div>
                                    <div style="font-size: 14px; font-weight: 700; color: white;" id="widgetTime">--:--</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 9px; color: rgba(255,255,255,0.8);">‡¶¶‡¶ø‡¶®</div>
                                    <div style="font-size: 14px; font-weight: 700; color: white;" id="widgetDay">--</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- CALENDAR QUICK ACCESS -->
                        <div style="background: white; padding: 16px; border-radius: 10px; margin-top: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #e3f2fd;">
                            <h3 style="color: #2196F3; margin: 0 0 12px 0; font-size: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">üìÜ</span>
                                Calendar Actions
                            </h3>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <button onclick="switchTab('form-c'); setTimeout(() => document.getElementById('cpDate').click(), 300);" style="width: 100%; background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; text-align: left; display: flex; align-items: center; gap: 8px; transition: all 0.3s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
                                    <span>üìù</span> <span>Form-C Date Pick</span>
                                </button>
                                <button onclick="switchTab('rice-ledger'); setTimeout(() => {const el = document.getElementById('riceLedgerDate'); if(el) el.click();}, 300);" style="width: 100%; background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; text-align: left; display: flex; align-items: center; gap: 8px; transition: all 0.3s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
                                    <span>üçö</span> <span>Rice Ledger Date</span>
                                </button>
                                <button onclick="switchTab('bank-ledger'); setTimeout(() => {const el = document.getElementById('bankDate'); if(el) el.click();}, 300);" style="width: 100%; background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; text-align: left; display: flex; align-items: center; gap: 8px; transition: all 0.3s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
                                    <span>üè¶</span> <span>Bank Entry Date</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- QUICK CALCULATOR -->
                        <div style="background: white; padding: 16px; border-radius: 10px; margin-top: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #fff3e0;">
                            <h3 style="color: #FF9800; margin: 0 0 12px 0; font-size: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 20px;">üßÆ</span>
                                Quick Calculator
                            </h3>
                            <div style="margin-bottom: 10px;">
                                <label style="font-size: 11px; color: #666; display: block; margin-bottom: 4px;">Students Present:</label>
                                <input type="number" id="calcStudents" placeholder="0" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 13px;" oninput="quickCalculate()">
                            </div>
                            <div style="background: #f5f5f5; padding: 10px; border-radius: 6px; margin-top: 8px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                    <span style="font-size: 11px; color: #666;">Rice Needed:</span>
                                    <span style="font-size: 13px; font-weight: 700; color: #FF9800;" id="calcRice">0 kg</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="font-size: 11px; color: #666;">Approx Cost:</span>
                                    <span style="font-size: 13px; font-weight: 700; color: #4CAF50;" id="calcCost">‚Çπ 0</span>
                                </div>
                            </div>
                        </div>
                        
                        <script>
                        // Update Today's Info Widget
                        function updateTodayWidget() {
                            const now = new Date();
                            const days = ['‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞', '‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞', '‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤‡¶¨‡¶æ‡¶∞', '‡¶¨‡ßÅ‡¶ß‡¶¨‡¶æ‡¶∞', '‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞', '‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞', '‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞'];
                            
                            const day = String(now.getDate()).padStart(2, '0');
                            const month = String(now.getMonth() + 1).padStart(2, '0');
                            const year = now.getFullYear();
                            const dateStr = `${day}-${month}-${year}`;
                            
                            const hours = String(now.getHours()).padStart(2, '0');
                            const minutes = String(now.getMinutes()).padStart(2, '0');
                            const timeStr = `${hours}:${minutes}`;
                            
                            const dayName = days[now.getDay()];
                            
                            const dateEl = document.getElementById('widgetTodayDate');
                            const timeEl = document.getElementById('widgetTime');
                            const dayEl = document.getElementById('widgetDay');
                            
                            if (dateEl) dateEl.textContent = dateStr;
                            if (timeEl) timeEl.textContent = timeStr;
                            if (dayEl) dayEl.textContent = dayName;
                        }
                        
                        // Quick Calculator
                        function quickCalculate() {
                            const students = parseInt(document.getElementById('calcStudents')?.value) || 0;
                            const ricePerStudent = 0.12; // 120g average
                            const costPerStudent = 8.5; // average cost
                            
                            const rice = (students * ricePerStudent).toFixed(2);
                            const cost = (students * costPerStudent).toFixed(2);
                            
                            const riceEl = document.getElementById('calcRice');
                            const costEl = document.getElementById('calcCost');
                            
                            if (riceEl) riceEl.textContent = rice + ' kg';
                            if (costEl) costEl.textContent = '‚Çπ ' + cost;
                        }
                        
                        // Update every minute
                        setInterval(updateTodayWidget, 60000);
                        setTimeout(updateTodayWidget, 1000);
                        </script>
                        
                        
                        <!-- Keyboard Shortcuts Widget -->
                        <div style="background: white; padding: 18px; border-radius: 10px; margin-top: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #e8eaf6;">
                            <h3 style="color: #5e35b1; margin: 0 0 15px 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <span style="font-size: 22px;">‚å®Ô∏è</span>
                                Keyboard Shortcuts
                            </h3>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; background: #f5f5f5; border-radius: 6px; border-left: 3px solid #5e35b1;">
                                    <span style="font-size: 11px; color: #666; font-weight: 500;">Save Settings</span>
                                    <kbd style="background: #5e35b1; color: white; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; font-family: monospace;">Ctrl+S</kbd>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; background: #f5f5f5; border-radius: 6px; border-left: 3px solid #00acc1;">
                                    <span style="font-size: 11px; color: #666; font-weight: 500;">Print Page</span>
                                    <kbd style="background: #00acc1; color: white; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; font-family: monospace;">Ctrl+P</kbd>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; background: #f5f5f5; border-radius: 6px; border-left: 3px solid #43a047;">
                                    <span style="font-size: 11px; color: #666; font-weight: 500;">Quick Actions</span>
                                    <kbd style="background: #43a047; color: white; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; font-family: monospace;">Ctrl+Space</kbd>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Data Statistics Widget -->
                        <div style="background: white; padding: 18px; border-radius: 10px; margin-top: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 2px solid #fff3e0;">
                            <h3 style="color: #f57c00; margin: 0 0 15px 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <span style="font-size: 22px;">üìä</span>
                                Data at a Glance
                            </h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);">
                                    <div style="font-size: 24px; font-weight: 700; color: white;" id="sidebarFormCCount">0</div>
                                    <div style="font-size: 10px; color: rgba(255,255,255,0.9); margin-top: 4px; text-transform: uppercase; font-weight: 600;">Form-C</div>
                                </div>
                                <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #43a047 0%, #66bb6a 100%); border-radius: 8px; box-shadow: 0 3px 10px rgba(67, 160, 71, 0.3);">
                                    <div style="font-size: 24px; font-weight: 700; color: white;" id="sidebarExpenseCount">0</div>
                                    <div style="font-size: 10px; color: rgba(255,255,255,0.9); margin-top: 4px; text-transform: uppercase; font-weight: 600;">Expenses</div>
                                </div>
                                <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); border-radius: 8px; box-shadow: 0 3px 10px rgba(255, 152, 0, 0.3);">
                                    <div style="font-size: 24px; font-weight: 700; color: white;" id="sidebarRiceCount">0</div>
                                    <div style="font-size: 10px; color: rgba(255,255,255,0.9); margin-top: 4px; text-transform: uppercase; font-weight: 600;">Rice</div>
                                </div>
                                <div style="text-align: center; padding: 12px; background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%); border-radius: 8px; box-shadow: 0 3px 10px rgba(0, 188, 212, 0.3);">
                                    <div style="font-size: 24px; font-weight: 700; color: white;" id="sidebarBankCount">0</div>
                                    <div style="font-size: 10px; color: rgba(255,255,255,0.9); margin-top: 4px; text-transform: uppercase; font-weight: 600;">Bank</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pro Tips Widget -->
                        <div style="background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%); padding: 18px; border-radius: 10px; margin-top: 16px; box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);">
                            <h3 style="color: #f57f17; margin: 0 0 12px 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 22px;">üí°</span>
                                Pro Tip
                            </h3>
                            <p style="font-size: 12px; color: #5d4037; margin: 0; line-height: 1.6; font-weight: 500;">
                                ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® Form-C entry ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá Settings verify ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ Rice allocation ‡¶è‡¶¨‡¶Ç cost per meal ‡¶∏‡¶†‡¶ø‡¶ï ‡¶•‡¶æ‡¶ï‡¶≤‡ßá reports automatic ‡¶∏‡¶†‡¶ø‡¶ï ‡¶π‡¶¨‡ßá!
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Hidden elements for backward compatibility -->
                <div style="display: none;">
                    <input type="file" id="importInput" onchange="importData()">
                    <table><tbody id="cookTableBody"></tbody></table>
                    <table><tbody id="staffTableBody"></tbody></table>
                </div>
            </div>

            <!-- REPORTS TAB -->
            <div id="reports" class="tab-content">
                <h2 style="color: #003d7a; margin-bottom: 20px;">üìÑ Reports & PDF Download</h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;">
                        <h3 style="color: #667eea; margin-bottom: 10px;">üìã Form-C Report</h3>
                        <p style="color: #666; margin-bottom: 15px;">Download daily Form-C entries as PDF</p>
                        <button class="btn btn-primary" onclick="generateFormCPDF()">üì• Download PDF</button>
                    </div>

                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745;">
                        <h3 style="color: #28a745; margin-bottom: 10px;">üçö Rice Ledger Report</h3>
                        <p style="color: #666; margin-bottom: 15px;">Monthly rice consumption summary</p>
                        <button class="btn btn-success" onclick="generateRicePDF()">üì• Download PDF</button>
                    </div>

                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <h3 style="color: #ff6a00; margin-bottom: 10px;">üè¶ Bank Ledger Report</h3>
                        <p style="color: #666; margin-bottom: 15px;">Financial transactions summary</p>
                        <button class="btn btn-warning" onclick="generateBankPDF()">üì• Download PDF</button>
                    </div>

                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545;">
                        <h3 style="color: #dc3545; margin-bottom: 10px;">üí∞ Expense Ledger Report</h3>
                        <p style="color: #666; margin-bottom: 15px;">Expense breakdown by category</p>
                        <button class="btn btn-danger" onclick="generateExpensePDF()">üì• Download PDF</button>
                    </div>

                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                        <h3 style="color: #17a2b8; margin-bottom: 10px;">üìä Monthly Summary Report</h3>
                        <p style="color: #666; margin-bottom: 15px;">Overall monthly MDM statistics</p>
                        <button class="btn btn-info" onclick="generateMonthlySummaryPDF()" style="background: #17a2b8;">üì• Download PDF</button>
                    </div>

                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #6f42c1;">
                        <h3 style="color: #6f42c1; margin-bottom: 10px;">üë• Staff Details Report</h3>
                        <p style="color: #666; margin-bottom: 15px;">Cook and Staff information</p>
                        <button class="btn btn-primary" onclick="generateStaffPDF()" style="background: #6f42c1;">üì• Download PDF</button>
                    </div>

                    <!-- NEW EXTERNAL PDF REPORTS (Auto-fetch from Form C & Master Data) -->
                    <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 4px solid #ff5722;">
                        <h3 style="color: #ff5722; margin-bottom: 10px;">üìÖ Daily Attendance Register</h3>
                        <p style="color: #666; margin-bottom: 15px;">Auto-fetch attendance from Form-C</p>
                        <button class="btn btn-primary" onclick="generateAttendancePDF()" style="background: #ff5722;">üì• Download PDF</button>
                    </div>

                    <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; border-left: 4px solid #4caf50;">
                        <h3 style="color: #4caf50; margin-bottom: 10px;">üìú Monthly Utilization Certificate</h3>
                        <p style="color: #666; margin-bottom: 15px;">UC with auto-calculated data</p>
                        <button class="btn btn-success" onclick="generateUCPDF()" style="background: #4caf50;">üì• Download PDF</button>
                    </div>

                    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; border-left: 4px solid #2196f3;">
                        <h3 style="color: #2196f3; margin-bottom: 10px;">üì¶ Stock Register Report</h3>
                        <p style="color: #666; margin-bottom: 15px;">Rice & ingredients stock status</p>
                        <button class="btn btn-info" onclick="generateStockPDF()" style="background: #2196f3;">üì• Download PDF</button>
                    </div>

                    <div style="background: #f3e5f5; padding: 20px; border-radius: 8px; border-left: 4px solid #9c27b0;">
                        <h3 style="color: #9c27b0; margin-bottom: 10px;">üìã Student Beneficiary List</h3>
                        <p style="color: #666; margin-bottom: 15px;">Class-wise student details</p>
                        <button class="btn btn-primary" onclick="generateBeneficiaryPDF()" style="background: #9c27b0;">üì• Download PDF</button>
                    </div>

                    <div style="background: #fff8e1; padding: 20px; border-radius: 8px; border-left: 4px solid #ff9800;">
                        <h3 style="color: #ff9800; margin-bottom: 10px;">üìä Monthly Monitoring Report</h3>
                        <p style="color: #666; margin-bottom: 15px;">Comprehensive monthly analysis</p>
                        <button class="btn btn-warning" onclick="generateMonitoringPDF()" style="background: #ff9800;">üì• Download PDF</button>
                    </div>
                </div>
                
                <!-- GOVERNMENT FORMS SECTION -->
                <div style="margin-top: 40px; border-top: 3px solid #667eea; padding-top: 30px;">
                    <h2 style="color: #003d7a; margin-bottom: 20px;">üèõÔ∏è Official Government Forms (Auto-Data)</h2>
                    <p style="color: #666; margin-bottom: 20px; font-size: 14px;">These forms automatically pull live data from your MDM System. Click to generate and download.</p>
                    

                    <!-- PDF Download Instructions -->
                    <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left: 5px solid #4caf50; padding: 25px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);">
                        <h3 style="color: #2e7d32; margin: 0 0 15px 0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 28px;">üì•</span> 
                            <span>Automatic PDF Download Feature</span>
                        </h3>
                        <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <p style="color: #555; margin: 0 0 15px 0; font-size: 15px; line-height: 1.6;">
                                <strong style="color: #2e7d32;">‚ú® NEW:</strong> When you click any "Generate" button below, the system will:
                            </p>
                            <ol style="color: #666; margin: 0 0 15px 0; padding-left: 25px; line-height: 2; font-size: 14px;">
                                <li><strong>Open a preview window</strong> - Review your form data before downloading</li>
                                <li><strong>Automatically download PDF</strong> - No manual steps required!</li>
                                <li><strong>Save to Downloads folder</strong> - Check your default downloads location</li>
                            </ol>
                            <div style="background: #fff9c4; border-left: 4px solid #fbc02d; padding: 15px; border-radius: 5px; margin-top: 15px;">
                                <p style="color: #f57f17; margin: 0; font-size: 14px; line-height: 1.6;">
                                    <strong>üí° Tip:</strong> The preview window also has a "Print" button if you want to save the PDF manually or print on paper.
                                </p>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 8px;">üñ±Ô∏è</div>
                                    <strong style="color: #1976d2; font-size: 13px;">Step 1: Click</strong>
                                    <p style="color: #666; margin: 5px 0 0 0; font-size: 12px;">Click Generate button</p>
                                </div>
                                <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 8px;">üëÅÔ∏è</div>
                                    <strong style="color: #7b1fa2; font-size: 13px;">Step 2: Preview</strong>
                                    <p style="color: #666; margin: 5px 0 0 0; font-size: 12px;">Review in new window</p>
                                </div>
                                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 8px;">‚úÖ</div>
                                    <strong style="color: #388e3c; font-size: 13px;">Step 3: Done!</strong>
                                    <p style="color: #666; margin: 5px 0 0 0; font-size: 12px;">PDF auto-downloads</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #ff6f00; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #ff6f00; margin-bottom: 10px;">üìù Form K (UP)</h3>
                            <p style="color: #666; margin-bottom: 10px; font-size: 13px;"><strong>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Ü‡¶Ø‡¶º ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Upper Primary)</strong></p>
                            <p style="color: #666; margin-bottom: 15px; font-size: 12px;">Class VI-VIII Monthly Utilization Report</p>
                            <button class="btn btn-primary" onclick="generateGovFormK('UP')" style="background: #ff6f00;">üì• Generate Form K (UP)</button>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #e91e63; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #e91e63; margin-bottom: 10px;">üìù Form K (P)</h3>
                            <p style="color: #666; margin-bottom: 10px; font-size: 13px;"><strong>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Ü‡¶Ø‡¶º ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Primary)</strong></p>
                            <p style="color: #666; margin-bottom: 15px; font-size: 12px;">Class V Monthly Utilization Report</p>
                            <button class="btn btn-primary" onclick="generateGovFormK('P')" style="background: #e91e63;">üì• Generate Form K (P)</button>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #1976d2; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #1976d2; margin-bottom: 10px;">üìä Form C (UP)</h3>
                            <p style="color: #666; margin-bottom: 10px; font-size: 13px;"><strong>Monthly Coverage Report (Upper Primary)</strong></p>
                            <p style="color: #666; margin-bottom: 15px; font-size: 12px;">Class VI-VIII Daily attendance & meal coverage</p>
                            <button class="btn btn-primary" onclick="generateGovFormC('UP')" style="background: #1976d2;">üì• Generate Form C (UP)</button>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #00acc1; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #00acc1; margin-bottom: 10px;">üìä Form C (P)</h3>
                            <p style="color: #666; margin-bottom: 10px; font-size: 13px;"><strong>Monthly Coverage Report (Primary)</strong></p>
                            <p style="color: #666; margin-bottom: 15px; font-size: 12px;">Class V Daily attendance & meal coverage</p>
                            <button class="btn btn-primary" onclick="generateGovFormC('P')" style="background: #00acc1;">üì• Generate Form C (P)</button>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #7b1fa2; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #7b1fa2; margin-bottom: 10px;">üè´ MDCF Master Data Form</h3>
                            <p style="color: #666; margin-bottom: 10px; font-size: 13px;"><strong>School Information</strong></p>
                            <p style="color: #666; margin-bottom: 15px; font-size: 12px;">MDM DRMS master data entry with enrollment details</p>
                            <button class="btn btn-primary" onclick="generateGovMasterForm()" style="background: #7b1fa2;">üì• Generate MDCF</button>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #388e3c; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #388e3c; margin-bottom: 10px;">üåæ PM POSHAN Form</h3>
                            <p style="color: #666; margin-bottom: 10px; font-size: 13px;"><strong>Monthly Data Capture</strong></p>
                            <p style="color: #666; margin-bottom: 15px; font-size: 12px;">Comprehensive PM POSHAN monthly data format</p>
                            <button class="btn btn-primary" onclick="generateGovPMPOSHAN()" style="background: #388e3c;">üì• Generate PM POSHAN</button>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #f57f17; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #f57f17; margin-bottom: 10px;">üçö Rice Register (UP)</h3>
                            <p style="color: #666; margin-bottom: 10px; font-size: 13px;"><strong>‡¶ö‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Upper Primary)</strong></p>
                            <p style="color: #666; margin-bottom: 15px; font-size: 12px;">Class VI-VIII Daily rice consumption ledger</p>
                            <button class="btn btn-primary" onclick="generateGovRiceRegister('UP')" style="background: #f57f17;">üì• Generate Rice Register (UP)</button>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #fffde7 0%, #fff9c4 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #fbc02d; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #fbc02d; margin-bottom: 10px;">üçö Rice Register (P)</h3>
                            <p style="color: #666; margin-bottom: 10px; font-size: 13px;"><strong>‡¶ö‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Primary)</strong></p>
                            <p style="color: #666; margin-bottom: 15px; font-size: 12px;">Class V Daily rice consumption ledger</p>
                            <button class="btn btn-primary" onclick="generateGovRiceRegister('P')" style="background: #fbc02d;">üì• Generate Rice Register (P)</button>
                        </div>
                    </div>
                    
                    <div style="background: #e3f2fd; border: 2px solid #2196f3; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <p style="color: #0d47a1; margin: 0; font-size: 13px; line-height: 1.6;">
                            <strong>‚ÑπÔ∏è Note:</strong> All government forms automatically fetch data from your Form-C entries, Rice Ledger, Bank Ledger, and Master Data. 
                            Make sure to enter all data in respective sections before generating these forms for office submission.
                        </p>
                    </div>
                </div>
            </div>

            <!-- TOOLS SECTION -->
            <div id="tools" class="tab-content">
                <div style="padding: 20px;">
                    <!-- Header -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; margin-bottom: 30px; color: white;">
                        <h2 style="margin: 0 0 10px 0;">
                            üéõÔ∏è MDM Tools Menu
                        </h2>
                        <p style="margin: 0; opacity: 0.9;">All system features and utilities in one place</p>
                    </div>
                    
                    <!-- Feature Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        
                        <!-- Search Feature -->
                        <div class="tool-card" style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #667eea; cursor: pointer; transition: all 0.3s;" onclick="if(typeof MDMSearch !== 'undefined') { MDMSearch.openPanel(); } else { alert('‚ùå Search system not loaded!'); }">
                            <div style="font-size: 40px; margin-bottom: 10px;">üîç</div>
                            <h3 style="margin: 10px 0 5px 0; color: #667eea;">Search Data</h3>
                            <p style="color: #666; margin: 0 0 10px 0; font-size: 14px;">Search across all ledgers with advanced filters</p>
                            <div id="search-status-tools" class="status-badge" style="padding: 5px 10px; background: #d4edda; color: #155724; border-radius: 3px; display: inline-block; font-size: 12px; font-weight: bold;">‚úÖ Ready</div>
                        </div>
                        
                        <!-- Bulk Entry Feature -->
                        <div class="tool-card" style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #27ae60; cursor: pointer; transition: all 0.3s;" onclick="if(typeof BulkFormC !== 'undefined') { BulkFormC.openPanel(); } else { alert('‚ùå Bulk Entry system not loaded!'); }">
                            <div style="font-size: 40px; margin-bottom: 10px;">üìã</div>
                            <h3 style="margin: 10px 0 5px 0; color: #27ae60;">Bulk Entry</h3>
                            <p style="color: #666; margin: 0 0 10px 0; font-size: 14px;">Add multiple Form C entries at once</p>
                            <div id="bulk-status-tools" class="status-badge" style="padding: 5px 10px; background: #d4edda; color: #155724; border-radius: 3px; display: inline-block; font-size: 12px; font-weight: bold;">‚úÖ Ready</div>
                        </div>
                        
                        <!-- Export Feature -->
                        <div class="tool-card" style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #3498db; cursor: pointer; transition: all 0.3s;" onclick="if(typeof AdvancedExport !== 'undefined') { AdvancedExport.openPanel(); } else { alert('‚ùå Export system not loaded!'); }">
                            <div style="font-size: 40px; margin-bottom: 10px;">üìä</div>
                            <h3 style="margin: 10px 0 5px 0; color: #3498db;">Export Data</h3>
                            <p style="color: #666; margin: 0 0 10px 0; font-size: 14px;">Export all ledgers to Excel format</p>
                            <div id="export-status-tools" class="status-badge" style="padding: 5px 10px; background: #d4edda; color: #155724; border-radius: 3px; display: inline-block; font-size: 12px; font-weight: bold;">‚úÖ Ready</div>
                        </div>
                        
                        <!-- Backup Feature -->
                        <div class="tool-card" style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #9b59b6; cursor: pointer; transition: all 0.3s;" onclick="if(typeof MDMBackup !== 'undefined') { if(confirm('Create a backup now?\\n\\nBackup file will be downloaded.')) { MDMBackup.create(); alert('‚úÖ Backup created successfully!\\n\\nFile is downloading...'); } } else { alert('‚ùå Backup system not loaded!'); }">
                            <div style="font-size: 40px; margin-bottom: 10px;">üíæ</div>
                            <h3 style="margin: 10px 0 5px 0; color: #9b59b6;">Create Backup</h3>
                            <p style="color: #666; margin: 0 0 10px 0; font-size: 14px;">Download complete system backup</p>
                            <div id="backup-status-tools" class="status-badge" style="padding: 5px 10px; background: #d4edda; color: #155724; border-radius: 3px; display: inline-block; font-size: 12px; font-weight: bold;">‚úÖ Auto-enabled</div>
                        </div>
                        
                        <!-- Activity Log Feature -->
                        <div class="tool-card" style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #e74c3c; cursor: pointer; transition: all 0.3s;" onclick="viewActivityLogInline()">
                            <div style="font-size: 40px; margin-bottom: 10px;">üìù</div>
                            <h3 style="margin: 10px 0 5px 0; color: #e74c3c;">Activity Log</h3>
                            <p style="color: #666; margin: 0 0 10px 0; font-size: 14px;">View recent system activities</p>
                            <div id="log-status-tools" class="status-badge" style="padding: 5px 10px; background: #d4edda; color: #155724; border-radius: 3px; display: inline-block; font-size: 12px; font-weight: bold;">‚úÖ Tracking</div>
                        </div>
                        
                        <!-- Sync Status Feature -->
                        <div class="tool-card" style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #f39c12; cursor: pointer; transition: all 0.3s;" onclick="showSyncStatusInline()">
                            <div style="font-size: 40px; margin-bottom: 10px;">üîÑ</div>
                            <h3 style="margin: 10px 0 5px 0; color: #f39c12;">Sync Status</h3>
                            <p style="color: #666; margin: 0 0 10px 0; font-size: 14px;">Check MongoDB connection status</p>
                            <div id="sync-status-tools" class="status-badge" style="padding: 5px 10px; background: #d4edda; color: #155724; border-radius: 3px; display: inline-block; font-size: 12px; font-weight: bold;">‚úÖ Connected</div>
                        </div>
                        
                    </div>
                    
                    <!-- System Info -->
                    <div style="background: linear-gradient(135deg, #e8f4f8 0%, #f0e8f8 100%); padding: 25px; border-radius: 10px; border-left: 4px solid #667eea;">
                        <h4 style="margin: 0 0 15px 0; color: #667eea;">‚ÑπÔ∏è System Information</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 14px; color: #555;">
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <strong style="color: #667eea;">Features Loaded:</strong><br>
                                <span id="features-count-tools" style="font-size: 20px; font-weight: bold; color: #27ae60;">Loading...</span>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <strong style="color: #667eea;">MongoDB Status:</strong><br>
                                <span id="mongo-status-tools" style="font-size: 16px; font-weight: bold;">‚úÖ Connected</span>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <strong style="color: #667eea;">Last Backup:</strong><br>
                                <span id="last-backup-tools" style="font-size: 14px;">Never</span>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 8px;">
                                <strong style="color: #667eea;">Activities Logged:</strong><br>
                                <span id="activities-count-tools" style="font-size: 20px; font-weight: bold; color: #e74c3c;">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions Info -->
                    <div style="margin-top: 20px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px;">
                        <strong style="color: #856404;">‚å®Ô∏è Keyboard Shortcuts:</strong>
                        <div style="margin-top: 10px; display: flex; gap: 20px; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <kbd style="background: white; padding: 5px 10px; border-radius: 3px; border: 1px solid #ddd; font-size: 12px; font-weight: bold;">Ctrl+F</kbd>
                                <span style="color: #856404;">Search</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <kbd style="background: white; padding: 5px 10px; border-radius: 3px; border: 1px solid #ddd; font-size: 12px; font-weight: bold;">Ctrl+M</kbd>
                                <span style="color: #856404;">Tools Menu</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Activity Log Display Area -->
                    <div id="activity-log-display" style="display: none; margin-top: 20px;"></div>
                    
                    <!-- Sync Status Display Area -->
                    <div id="sync-status-display" style="display: none; margin-top: 20px;"></div>
                </div>
                
                <style>
                    .tool-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
                    }
                </style>
            </div>

        </div>

        <!-- FOOTER -->
        <div class="footer">
            <div class="footer-left">
                <img id="footerLogoImg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%233b82f6'/%3E%3Ctext x='50' y='65' font-size='45' text-anchor='middle' fill='white'%3EüçΩÔ∏è%3C/text%3E%3C/svg%3E" alt="MDM Logo" style="width:36px; height:36px; object-fit: contain;">
                <div>
                    <p style="margin: 0; font-weight: 700; font-size: 13px;">Complete MDM Portal V19.0</p>
                    <p style="margin: 0; font-size: 11px; opacity: 0.8;">¬© 2025 Ramnagar High School ‚Ä¢ Developed by Tapas Mahata</p>
                </div>
            </div>
            <div class="footer-right">
                Version 2.0.0 ‚Ä¢ December 2024<br>
                üåæ Healthy Meal ‚Ä¢ Bright Future
            </div>
        </div>

    </div>

    <!-- Password Change Modal -->
    <div id="passwordChangeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; backdrop-filter: blur(5px);">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); width: 90%; max-width: 500px;">
            <!-- Close Button -->
            <button onclick="closePasswordModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 28px; cursor: pointer; color: #999; line-height: 1; transition: color 0.3s;" onmouseover="this.style.color='#333'" onmouseout="this.style.color='#999'">&times;</button>
            
            <!-- Header -->
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px;">üîë</div>
                <h2 style="margin: 0 0 8px 0; color: #333; font-size: 26px; font-weight: 700;">Password Change ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <p style="margin: 0; color: #666; font-size: 14px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>

            <!-- Form -->
            <form id="passwordChangeForm" onsubmit="submitPasswordChange(event)">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: 600; font-size: 14px;">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <div style="position: relative;">
                        <input type="password" id="currentPassword" required style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e1e8ed'">
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: 600; font-size: 14px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <div style="position: relative;">
                        <input type="password" id="newPassword" required minlength="6" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e1e8ed'">
                        <small style="color: #999; font-size: 12px; display: block; margin-top: 5px;">‚ö†Ô∏è ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá</small>
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; color: #555; font-weight: 600; font-size: 14px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                    <div style="position: relative;">
                        <input type="password" id="confirmPassword" required minlength="6" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 14px; transition: border-color 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e1e8ed'">
                    </div>
                </div>

                <div id="passwordChangeMessage" style="padding: 12px; border-radius: 8px; margin-bottom: 20px; display: none; font-size: 14px; font-weight: 500;"></div>

                <button type="submit" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'">
                    ‚úì ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
            </form>
        </div>
    </div>

    <script>
        // ========== AUTHENTICATION CHECK ==========
        function checkAuthentication() {
            const user = localStorage.getItem('mdm_user') || sessionStorage.getItem('mdm_user');
            
            if (!user) {
                // User not logged in, show login screen with animations
                document.getElementById('loginScreen').style.display = 'flex';
                document.querySelector('.container').style.display = 'none';
                document.body.classList.add('login-page');
                return false;
            }
            
            // User is logged in, show main container and remove animations
            document.getElementById('loginScreen').style.display = 'none';
            document.querySelector('.container').style.display = 'block';
            document.body.classList.remove('login-page');
            console.log('Authenticated user:', user);
            return true;
        }

        // Login functionality
        function performLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const rememberMe = document.getElementById('rememberMe').checked;
            const errorDiv = document.getElementById('loginError');

            // Clear previous error
            errorDiv.style.display = 'none';

            // Validate input
            if (!username || !password) {
                errorDiv.textContent = '‚ùå Please enter both username and password';
                errorDiv.style.display = 'block';
                return;
            }

            // Check credentials (default: admin/admin123)
            const storedUsername = localStorage.getItem('mdm_username') || 'admin';
            const storedPassword = localStorage.getItem('mdm_password') || 'admin123';

            if (username === storedUsername && password === storedPassword) {
                // Show loading state on login screen
                const loginButton = event?.target;
                if (loginButton) {
                    loginButton.innerHTML = '‚è≥ Logging in...';
                    loginButton.disabled = true;
                }

                // Simulate brief loading for better UX
                setTimeout(() => {
                    // Successful login
                    const storage = rememberMe ? localStorage : sessionStorage;
                    storage.setItem('mdm_user', username);
                    storage.setItem('mdm_login_time', new Date().toISOString());

                    // Hide login screen and show main system
                    document.getElementById('loginScreen').style.display = 'none';
                    document.querySelector('.container').style.display = 'block';
                    
                    // Remove animated login background
                    document.body.classList.remove('login-page');

                    // Clear login fields
                    document.getElementById('loginUsername').value = '';
                    document.getElementById('loginPassword').value = '';
                    document.getElementById('rememberMe').checked = false;

                    // Reset button
                    if (loginButton) {
                        loginButton.innerHTML = 'LOGIN TO DASHBOARD';
                        loginButton.disabled = false;
                    }

                    // Show prominent success message with animation
                    showLoginSuccessMessage(username);

                    // Load data and initialize
                    loadAllData();
                    updateDashboard();
                    startClock(); // Ensure clock starts
                }, 800);
            } else {
                // Failed login
                errorDiv.textContent = '‚ùå Invalid username or password';
                errorDiv.style.display = 'block';
                
                // Shake animation for error
                errorDiv.style.animation = 'shake 0.5s';
                setTimeout(() => errorDiv.style.animation = '', 500);
            }
        }

        // New function: Show prominent login success message
        function showLoginSuccessMessage(username) {
            // Create success overlay
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 99999;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s;
            `;

            const successBox = document.createElement('div');
            successBox.style.cssText = `
                background: white;
                padding: 40px 50px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                animation: scaleIn 0.4s;
                max-width: 400px;
            `;

            successBox.innerHTML = `
                <div style="font-size: 80px; margin-bottom: 20px;">‚úÖ</div>
                <h2 style="color: #28a745; margin: 0 0 10px 0; font-size: 28px;">Login Successful!</h2>
                <p style="color: #666; font-size: 16px; margin: 10px 0 20px 0;">Welcome back, <strong>${username}</strong>!</p>
                <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); height: 4px; width: 100%; border-radius: 2px; margin-top: 20px;"></div>
                <p style="color: #999; font-size: 13px; margin: 15px 0 0 0;">Redirecting to dashboard...</p>
            `;

            overlay.appendChild(successBox);
            document.body.appendChild(overlay);

            // Add keyframes for animations
            if (!document.getElementById('loginSuccessStyles')) {
                const style = document.createElement('style');
                style.id = 'loginSuccessStyles';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes scaleIn {
                        from { transform: scale(0.8); opacity: 0; }
                        to { transform: scale(1); opacity: 1; }
                    }
                    @keyframes shake {
                        0%, 100% { transform: translateX(0); }
                        25% { transform: translateX(-10px); }
                        75% { transform: translateX(10px); }
                    }
                `;
                document.head.appendChild(style);
            }

            // Auto remove after 2 seconds
            setTimeout(() => {
                overlay.style.animation = 'fadeIn 0.3s reverse';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                    // Show regular alert
                    showAlert('üéâ Successfully logged in to MDM System!', 'success');
                }, 300);
            }, 2000);
        }

        // Toggle password visibility
        function toggleLoginPassword() {
            const passwordField = document.getElementById('loginPassword');
            passwordField.type = passwordField.type === 'password' ? 'text' : 'password';
        }

        // Allow Enter key to login
        document.addEventListener('DOMContentLoaded', function() {
            const loginPassword = document.getElementById('loginPassword');
            if (loginPassword) {
                loginPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performLogin();
                    }
                });
            }
            const loginUsername = document.getElementById('loginUsername');
            if (loginUsername) {
                loginUsername.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performLogin();
                    }
                });
            }
        });

        // Add logout functionality
        function logout() {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                // Clear all session data
                localStorage.removeItem('mdm_user');
                localStorage.removeItem('mdm_remember');
                sessionStorage.removeItem('mdm_user');
                sessionStorage.removeItem('mdm_login_time');
                
                // Show success message
                showAlert('‚úÖ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
                
                // Show login screen and hide main container
                document.getElementById('loginScreen').style.display = 'flex';
                document.querySelector('.container').style.display = 'none';
                
                // Restore animated login background
                document.body.classList.add('login-page');
            }
        }

        // ========== PASSWORD CHANGE MODAL FUNCTIONS ==========
        function openPasswordModal() {
            document.getElementById('passwordChangeModal').style.display = 'block';
            document.getElementById('passwordChangeForm').reset();
            document.getElementById('passwordChangeMessage').style.display = 'none';
        }

        function closePasswordModal() {
            document.getElementById('passwordChangeModal').style.display = 'none';
            document.getElementById('passwordChangeForm').reset();
            document.getElementById('passwordChangeMessage').style.display = 'none';
        }

        function submitPasswordChange(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const messageDiv = document.getElementById('passwordChangeMessage');
            
            // Get current user
            const currentUser = localStorage.getItem('mdm_user') || sessionStorage.getItem('mdm_user');
            
            if (!currentUser) {
                showPasswordMessage('‚ùå Error: ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!', 'error');
                return;
            }

            // Validate passwords match
            if (newPassword !== confirmPassword) {
                showPasswordMessage('‚ùå ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ!', 'error');
                return;
            }

            // Validate password length
            if (newPassword.length < 6) {
                showPasswordMessage('‚ùå ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ß¨ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá!', 'error');
                return;
            }

            // Check current password against stored users
            const users = {
                'admin': 'admin123',
                'headmaster': 'hm@rhs2025',
                'mdm-incharge': 'mdm@rhs2025',
                'teacher': 'teacher123'
            };

            // Get saved passwords from localStorage
            const savedPasswords = JSON.parse(localStorage.getItem('mdm_passwords') || '{}');
            const actualPassword = savedPasswords[currentUser] || users[currentUser];

            if (actualPassword !== currentPassword) {
                showPasswordMessage('‚ùå ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤!', 'error');
                return;
            }

            // Update password in localStorage
            savedPasswords[currentUser] = newPassword;
            localStorage.setItem('mdm_passwords', JSON.stringify(savedPasswords));
            
            // Show success message
            showPasswordMessage('‚úÖ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
            
            // Close modal after 2 seconds
            setTimeout(() => {
                closePasswordModal();
            }, 2000);
        }

        function showPasswordMessage(message, type) {
            const messageDiv = document.getElementById('passwordChangeMessage');
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            if (type === 'success') {
                messageDiv.style.background = '#d4edda';
                messageDiv.style.color = '#155724';
                messageDiv.style.border = '1px solid #c3e6cb';
            } else {
                messageDiv.style.background = '#f8d7da';
                messageDiv.style.color = '#721c24';
                messageDiv.style.border = '1px solid #f5c6cb';
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('passwordChangeModal');
            if (event.target === modal) {
                closePasswordModal();
            }
        }

        // ========== DATA STRUCTURE ==========
        const mdmLogoDataUrl = "data:image/png;base64,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";
        
        const mdmData = {
            school: {
                name: 'Ramnagar High School',
                location: 'Uttar Ramnagar, Purba Bardhaman',
                block: 'Ausgram-II',
                dise: '19090306103',
                hoi: 'Dasarath Bagdi',
                mdmic: 'Tapas Mahata',
                district: 'PURBA BARDHAMAN',
                subdivision: 'BARDHAMAN SADAR N',
                gpWard: 'UTTAR RAMNAGAR',
                shgName: 'MA MANASA MATA',
                bankName: 'UCO',
                bankAccountNo: '11200110014752',
                contactNo: '9679699886'
            },
            enrollment: { V: 79, VI: 99, VII: 98, VIII: 99 },
            rice: { V: 100, VI: 150, VII: 150, VIII: 150 },
            cost: { V: 6.78, VI: 10.17, VII: 10.17, VIII: 10.17 },
            riceOpeningStock: 524.01,
            riceReceivedStock: 0,
            fundOpening: 120000,
            cookingCostReceived: 10000,
            formC: [],
            riceLedger: [],
            bankLedger: [],
            expenseLedger: [],
            cooks: [],
            staff: [],
            mdcf: {
                monthYear: '',
                schoolType: 'Government',
                schoolCategory: 'Primary with Upper Primary',
                state: 'West Bengal',
                kitchenType: 'SHG',
                // Meals Availed Status
                mealsAvailed: {
                    balVatika: { schoolDays: 0, mdmDaysServed: 0, totalMeals: 0 },
                    primary: { schoolDays: 0, mdmDaysServed: 0, totalMeals: 0 },
                    upperPrimary: { schoolDays: 0, mdmDaysServed: 0, totalMeals: 0 }
                },
                // Fund Details
                fundDetails: {
                    cookingCostBalVatika: { opening: 0, received: 0, expenditure: 0, closing: 0 },
                    cookingCostPrimary: { opening: 0, received: 0, expenditure: 0, closing: 0 },
                    cookingCostUpperPrimary: { opening: 0, received: 0, expenditure: 0, closing: 0 },
                    cookCumHelper: { opening: 0, received: 0, expenditure: 0, closing: 0 },
                    mmeExpenses: { opening: 0, received: 0, expenditure: 0, closing: 0 },
                    bankBalanceMatch: 'Yes'
                },
                // Food Grains Details
                foodGrains: {
                    balVatika: {
                        wheat: { opening: 0, received: 0, consumption: 0, closing: 0 },
                        rice: { opening: 0, received: 0, consumption: 0, closing: 0 }
                    },
                    primary: {
                        wheat: { opening: 0, received: 0, consumption: 0, closing: 0 },
                        rice: { opening: 0, received: 0, consumption: 0, closing: 0 }
                    },
                    upperPrimary: {
                        wheat: { opening: 0, received: 0, consumption: 0, closing: 0 },
                        rice: { opening: 0, received: 0, consumption: 0, closing: 0 }
                    }
                },
                // Children Health Status
                healthStatus: {
                    ifaTabletsBoys: 0,
                    ifaTabletsGirls: 0,
                    rbskScreened: 0,
                    rbskReferred: 0
                },
                // School Inspection
                inspection: {
                    taskForce: false,
                    districtOfficials: false,
                    blockOfficials: false,
                    smcMembers: false,
                    untowardIncidents: 0
                }
            }
        };

        // ========== DATA SYNC FUNCTION ==========
        function syncFormCData() {
            // Sync formCData to mdmData.formC if exists
            const formCData = JSON.parse(localStorage.getItem('formCData') || '[]');
            if (formCData.length > 0 && (!mdmData.formC || mdmData.formC.length === 0)) {
                console.log(`üîÑ Syncing ${formCData.length} entries from formCData to mdmData.formC`);
                mdmData.formC = formCData;
                localStorage.setItem('mdmData', JSON.stringify(mdmData));
                console.log('‚úÖ Data synced successfully!');
            } else if (formCData.length > 0) {
                console.log(`‚ÑπÔ∏è formCData has ${formCData.length} entries, mdmData.formC has ${mdmData.formC.length} entries`);
            }
        }

        // ========== INITIALIZATION ==========
        window.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            if (!checkAuthentication()) {
                return; // Stop if not authenticated
            }
            
            console.log('MDM System initialized successfully');
            try {
                loadAllData();
                syncFormCData(); // Sync formCData to mdmData.formC
                loadLogos(); // Load uploaded logos
                setDate('cpDate');
                setDate('riceLedgerDate');
                setDate('bankDate');
                setDate('expenseDate');
                
                // Initialize calendar date pickers
                setTimeout(() => {
                    if (typeof flatpickr !== 'undefined') {
                        flatpickr('#cpDate', { dateFormat: 'd-m-Y', allowInput: true });
                        flatpickr('#riceLedgerDate', { dateFormat: 'd-m-Y', allowInput: true });
                        flatpickr('#bankDate', { dateFormat: 'd-m-Y', allowInput: true });
                        flatpickr('#expenseDate', { dateFormat: 'd-m-Y', allowInput: true });
                        console.log('‚úÖ Calendar pickers initialized');
                    }
                }, 500);
                
                startClock();
                loadFormCTable();
                loadRiceLedgerTable();
                loadBankLedgerTable();
                loadExpenseLedgerTable();
                loadCooksTable();
                loadStaffTable();
                populateCookDropdown();
                
                // ‚úÖ RENDER DYNAMIC COOKS & STAFF LISTS IN SETTINGS
                renderCooksList();
                renderStaffList();
                
                // ‚úÖ RESTORE LAST ACTIVE TAB
                const activeTab = localStorage.getItem('activeTab') || 'dashboard';
                if (activeTab && activeTab !== 'dashboard') {
                    setTimeout(() => {
                        switchTab(activeTab);
                        // Activate the corresponding button
                        document.querySelectorAll('.tab-btn').forEach(btn => {
                            btn.classList.remove('active');
                            if (btn.textContent.toLowerCase().includes(activeTab.replace('-', ' '))) {
                                btn.classList.add('active');
                            }
                        });
                    }, 100);
                }
                
                // ‚úÖ INITIALIZE ACTIVITY TRACKING & AUTO LOGOUT
                initActivityTracking();
                
                // ‚úÖ SETUP PIN INPUT NAVIGATION
                setupPinInputNavigation();
                
                // ‚úÖ POPULATE SETTINGS FIELDS
                populateSettingsFields();
                
                // ‚úÖ LOAD PIN STATUS
                const savedPIN = localStorage.getItem('mdm_pin');
                if (savedPIN && savedPIN !== '1234') {
                    document.getElementById('pinStatusText').textContent = 'Custom PIN Active (****) ‚úÖ';
                }
                
                // Update dashboard with latest data
                setTimeout(updateDashboard, 500);
                
                // ‚úÖ REFRESH SETTINGS SIDEBAR PREVIEW
                setTimeout(refreshPreview, 600);
                setTimeout(updateSidebarStats, 700);
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });

        // Get today's date in Asia/Kolkata timezone
        function getTodayDateISO() {
            const today = new Date();
            const kolkataDate = new Date(today.toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }));
            return kolkataDate.toISOString().split('T')[0];
        }

        // Get today's date in dd-mm-yyyy format
        function getTodayDateDDMMYYYY() {
            const today = new Date();
            const kolkataDate = new Date(today.toLocaleString('en-US', { timeZone: 'Asia/Kolkata' }));
            const day = String(kolkataDate.getDate()).padStart(2, '0');
            const month = String(kolkataDate.getMonth() + 1).padStart(2, '0');
            const year = kolkataDate.getFullYear();
            return `${day}-${month}-${year}`;
        }

        function setDate(elementId) {
            const today = getTodayDateDDMMYYYY(); // Changed to dd-mm-yyyy format
            const element = document.getElementById(elementId);
            if (element) {
                element.value = today;
            }
        }

        // Auto-format date input as user types
        function formatDateInput(input) {
            let value = input.value.replace(/\D/g, ''); // Remove non-digits
            
            if (value.length >= 2) {
                value = value.substring(0, 2) + '-' + value.substring(2);
            }
            if (value.length >= 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 9);
            }
            
            input.value = value;
        }

        // Validate date input
        function validateDateInput(input) {
            const value = input.value;
            const datePattern = /^(\d{2})-(\d{2})-(\d{4})$/;
            
            if (!value) return true; // Allow empty
            
            const match = value.match(datePattern);
            if (!match) {
                input.style.borderColor = '#dc3545';
                showAlert('‚ùå ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Ø‡¶º! dd-mm-yyyy format ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return false;
            }
            
            const day = parseInt(match[1]);
            const month = parseInt(match[2]);
            const year = parseInt(match[3]);
            
            // Validate ranges
            if (month < 1 || month > 12) {
                input.style.borderColor = '#dc3545';
                showAlert('‚ùå ‡¶Æ‡¶æ‡¶∏ ‡ßß ‡¶•‡ßá‡¶ï‡ßá ‡ßß‡ß® ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
                return false;
            }
            
            if (day < 1 || day > 31) {
                input.style.borderColor = '#dc3545';
                showAlert('‚ùå ‡¶¶‡¶ø‡¶® ‡ßß ‡¶•‡ßá‡¶ï‡ßá ‡ß©‡ßß ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
                return false;
            }
            
            if (year < 2020 || year > 2030) {
                input.style.borderColor = '#dc3545';
                showAlert('‚ùå ‡¶¨‡¶õ‡¶∞ ‡ß®‡ß¶‡ß®‡ß¶ ‡¶•‡ßá‡¶ï‡ßá ‡ß®‡ß¶‡ß©‡ß¶ ‡¶è‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
                return false;
            }
            
            // Valid date
            input.style.borderColor = '#28a745';
            return true;
        }

        // ========== DATE FORMAT CONVERSION ==========
        // Convert yyyy-mm-dd to dd-mm-yyyy for display
        function formatDateToDDMMYYYY(dateString) {
            if (!dateString) return '';
            
            // If already in dd-mm-yyyy format, return as is
            if (dateString.includes('-')) {
                const parts = dateString.split('-');
                if (parts.length === 3 && parts[0].length === 2) {
                    return dateString;
                }
                // Convert from yyyy-mm-dd to dd-mm-yyyy
                if (parts[0].length === 4) {
                    return `${parts[2]}-${parts[1]}-${parts[0]}`;
                }
            }
            return dateString;
        }

        // Convert dd-mm-yyyy to yyyy-mm-dd for date inputs
        function formatDateToYYYYMMDD(dateString) {
            if (!dateString) return '';
            
            // If already in yyyy-mm-dd format, return as is
            if (dateString.includes('-')) {
                const parts = dateString.split('-');
                if (parts.length === 3 && parts[0].length === 4) {
                    return dateString;
                }
                // Convert from dd-mm-yyyy to yyyy-mm-dd
                if (parts[0].length === 2) {
                    return `${parts[2]}-${parts[1]}-${parts[0]}`;
                }
            }
            return dateString;
        }

        function startClock() {
            // Update immediately
            updateClockDisplay();
            
            // Then update every second
            setInterval(updateClockDisplay, 1000);
        }

        function updateClockDisplay() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const clockElement = document.getElementById('clock');
            if (clockElement) {
                clockElement.textContent = time;
            }
        }

        // ========== TAB SWITCHING ==========
        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));

            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
                console.log('Tab activated successfully:', tabName);
                
                // ‚úÖ SAVE TAB STATE TO LOCALSTORAGE
                localStorage.setItem('activeTab', tabName);
                
                // If switching to Form C, ensure date is set
                if (tabName === 'form-c') {
                    const cpDate = document.getElementById('cpDate');
                    if (cpDate && !cpDate.value) {
                        const today = getTodayDateDDMMYYYY();
                        cpDate.value = today;
                        console.log('Date set for Form C:', today);
                    }
                }
                
                // If switching to dashboard, update it
                if (tabName === 'dashboard') {
                    setTimeout(updateDashboard, 100);
                }
                
                // ‚úÖ If switching to settings, populate fields from data
                if (tabName === 'settings') {
                    populateSettingsFields();
                }
                
                // ‚úÖ If switching to tools, update system info
                if (tabName === 'tools') {
                    setTimeout(updateToolsSystemInfo, 500);
                }
            } else {
                console.error('Tab not found:', tabName);
            }
            
            // Activate the button that was clicked
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        // ========== DARK MODE ==========
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            
            // Update dark mode icon
            const darkModeBtn = document.querySelector('.dark-mode-btn');
            if (darkModeBtn) {
                darkModeBtn.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
            }
        }

        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }

        // ========== ADMIN DROPDOWN ==========
        function toggleAdminMenu() {
            const dropdown = document.getElementById('adminDropdown');
            dropdown.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('adminDropdown');
            if (dropdown && !dropdown.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Update notification count dynamically
        function updateNotificationCount() {
            // This can be connected to actual notifications system
            const notificationBadge = document.querySelector('.notification-badge');
            if (notificationBadge) {
                const count = 2; // You can change this dynamically
                notificationBadge.textContent = count;
                notificationBadge.style.display = count > 0 ? 'flex' : 'none';
            }
        }

        // ========== DASHBOARD FUNCTIONS ==========
        function updateDashboard() {
            // Update Total Students
            const enrollV = parseInt(document.getElementById('enrollmentV')?.value) || 79;
            const enrollVI = parseInt(document.getElementById('enrollmentVI')?.value) || 99;
            const enrollVII = parseInt(document.getElementById('enrollmentVII')?.value) || 98;
            const enrollVIII = parseInt(document.getElementById('enrollmentVIII')?.value) || 98;
            const totalStudents = enrollV + enrollVI + enrollVII + enrollVIII;
            
            if (document.getElementById('dashTotalStudents'))
                document.getElementById('dashTotalStudents').textContent = totalStudents;

            // Update Class-wise Strength
            if (document.getElementById('classVStrength'))
                document.getElementById('classVStrength').textContent = enrollV;
            if (document.getElementById('classVIStrength'))
                document.getElementById('classVIStrength').textContent = enrollVI;
            if (document.getElementById('classVIIStrength'))
                document.getElementById('classVIIStrength').textContent = enrollVII;
            if (document.getElementById('classVIIIStrength'))
                document.getElementById('classVIIIStrength').textContent = enrollVIII;

            // Update Rice Per Meal (weighted average) - values are in grams
            const riceV = parseFloat(document.getElementById('riceClassV')?.value) || 100;
            const riceVIVIIVIII = parseFloat(document.getElementById('riceClassVIVIIVIII')?.value) || 150;
            const avgRice = ((riceV * enrollV) + (riceVIVIIVIII * (enrollVI + enrollVII + enrollVIII))) / totalStudents;
            if (document.getElementById('dashRicePerMeal'))
                document.getElementById('dashRicePerMeal').textContent = Math.round(avgRice) + 'g';

            // Update Fund Per Meal (separate for Class V and VI-VIII)
            const costV = parseFloat(document.getElementById('costClassV')?.value) || 6.78;
            const costVIVIIVIII = parseFloat(document.getElementById('costClassVIVIIVIII')?.value) || 10.17;
            
            if (document.getElementById('dashFundClassV'))
                document.getElementById('dashFundClassV').textContent = '‚Çπ ' + costV.toFixed(2);
            if (document.getElementById('dashFundClassVIVIIVIII'))
                document.getElementById('dashFundClassVIVIIVIII').textContent = '‚Çπ ' + costVIVIIVIII.toFixed(2);

            // Calculate Average Attendance from Form-C entries
            calculateAverageAttendance();

            // Update Bank Account Details
            if (document.getElementById('dashBankAccountName'))
                document.getElementById('dashBankAccountName').textContent = 
                    document.getElementById('bankAccountName')?.value || 'RHS MDM Account';
        // Function to mask bank account number
        function maskAccountNumber(accountNumber) {
            if (!accountNumber) return 'XXXX-XXXX-XXXX';
            const numStr = accountNumber.toString().replace(/\D/g, '');
            if (numStr.length < 4) return 'XXXX-XXXX-XXXX';
            const last4 = numStr.slice(-4);
            return 'XXXX-XXXX-' + last4;
        }

        if (document.getElementById('dashBankAccountNumber'))
                document.getElementById('dashBankAccountNumber').textContent = 
                    maskAccountNumber(document.getElementById('bankAccountNumber')?.value);
            if (document.getElementById('dashBankBranch'))
                document.getElementById('dashBankBranch').textContent = 
                    document.getElementById('bankBranch')?.value || 'State Bank of India';
            if (document.getElementById('dashOpeningBalance'))
                document.getElementById('dashOpeningBalance').textContent = 
                    '‚Çπ ' + (parseFloat(document.getElementById('fundOpening')?.value) || 0).toLocaleString('en-IN', {minimumFractionDigits: 2});

            // Update MT Summary
            updateMTSummary();
        }

        function calculateAverageAttendance() {
            // Get Form-C entries from local storage
            const formCEntries = mdmData.formC || [];
            
            if (formCEntries.length === 0) {
                if (document.getElementById('dashAvgAttendance'))
                    document.getElementById('dashAvgAttendance').textContent = '0%';
                return;
            }

            // Calculate average attendance from last 6 months or available entries
            let totalCP = 0;
            let totalEnrollment = 0;
            let entryCount = Math.min(formCEntries.length, 180); // roughly 6 months

            for (let i = 0; i < entryCount; i++) {
                const entry = formCEntries[i];
                totalCP += (entry.cpV || 0) + (entry.cpVI || 0) + (entry.cpVII || 0) + (entry.cpVIII || 0);
                
                // Use current enrollment as proxy
                const enrollV = parseInt(document.getElementById('enrollmentV')?.value) || 79;
                const enrollVI = parseInt(document.getElementById('enrollmentVI')?.value) || 99;
                const enrollVII = parseInt(document.getElementById('enrollmentVII')?.value) || 98;
                const enrollVIII = parseInt(document.getElementById('enrollmentVIII')?.value) || 98;
                totalEnrollment += enrollV + enrollVI + enrollVII + enrollVIII;
            }

            const avgAttendance = entryCount > 0 ? (totalCP / totalEnrollment) * 100 : 0;
            
            if (document.getElementById('dashAvgAttendance'))
                document.getElementById('dashAvgAttendance').textContent = avgAttendance.toFixed(1) + '%';
        }

        function updateMTSummary() {
            const formCEntries = mdmData.formC || [];
            
            // Get today's entry (last entry if exists)
            let todayEntry = formCEntries.length > 0 ? formCEntries[formCEntries.length - 1] : null;
            
            // Class V MT
            const classVMTToday = todayEntry ? (todayEntry.mtV || 0) : 0;
            let classVMTTotal = 0;
            
            // Upper Primary MT (VI+VII+VIII)
            const classVIMTToday = todayEntry ? (todayEntry.mtVI || 0) : 0;
            const classVIIMTToday = todayEntry ? (todayEntry.mtVII || 0) : 0;
            const classVIIIMTToday = todayEntry ? (todayEntry.mtVIII || 0) : 0;
            const upperPrimaryMTToday = classVIMTToday + classVIIMTToday + classVIIIMTToday;
            
            let classVIMTTotal = 0;
            let classVIIMTTotal = 0;
            let classVIIIMTTotal = 0;

            // Calculate totals from all entries
            formCEntries.forEach(entry => {
                classVMTTotal += entry.mtV || 0;
                classVIMTTotal += entry.mtVI || 0;
                classVIIMTTotal += entry.mtVII || 0;
                classVIIIMTTotal += entry.mtVIII || 0;
            });

            const upperPrimaryMTTotal = classVIMTTotal + classVIIMTTotal + classVIIIMTTotal;

            // Update Primary Section
            if (document.getElementById('classVMTToday'))
                document.getElementById('classVMTToday').textContent = classVMTToday;
            if (document.getElementById('classVMTTotal'))
                document.getElementById('classVMTTotal').textContent = classVMTTotal;
            if (document.getElementById('classVMTGrandTotal'))
                document.getElementById('classVMTGrandTotal').textContent = classVMTTotal + classVMTToday;

            // Update Upper Primary Section
            if (document.getElementById('upperPrimaryMTToday'))
                document.getElementById('upperPrimaryMTToday').textContent = upperPrimaryMTToday;
            if (document.getElementById('upperPrimaryMTTotal'))
                document.getElementById('upperPrimaryMTTotal').textContent = upperPrimaryMTTotal;
            if (document.getElementById('upperPrimaryMTGrandTotal'))
                document.getElementById('upperPrimaryMTGrandTotal').textContent = upperPrimaryMTTotal + upperPrimaryMTToday;

            // Update Class-wise breakdown
            if (document.getElementById('classVIMTToday'))
                document.getElementById('classVIMTToday').textContent = classVIMTToday;
            if (document.getElementById('classVIIMTToday'))
                document.getElementById('classVIIMTToday').textContent = classVIIMTToday;
            if (document.getElementById('classVIIIMTToday'))
                document.getElementById('classVIIIMTToday').textContent = classVIIIMTToday;
        }

        // ========== FORM-C FUNCTIONS ==========
        function calculateFormC() {
            const cpV = parseInt(document.getElementById('cpV').value) || 0;
            const mtV = parseInt(document.getElementById('mtV').value) || 0;
            const cpVI = parseInt(document.getElementById('cpVI').value) || 0;
            const mtVI = parseInt(document.getElementById('mtVI').value) || 0;
            const cpVII = parseInt(document.getElementById('cpVII').value) || 0;
            const mtVII = parseInt(document.getElementById('mtVII').value) || 0;
            const cpVIII = parseInt(document.getElementById('cpVIII').value) || 0;
            const mtVIII = parseInt(document.getElementById('mtVIII').value) || 0;

            // Validation: MT cannot be greater than CP
            if (mtV > cpV) document.getElementById('mtV').value = cpV;
            if (mtVI > cpVI) document.getElementById('mtVI').value = cpVI;
            if (mtVII > cpVII) document.getElementById('mtVII').value = cpVII;
            if (mtVIII > cpVIII) document.getElementById('mtVIII').value = cpVIII;

            // Total for VI-VIII only (for TOTAL column)
            const totalCPVI = cpVI + cpVII + cpVIII;
            const totalMTVI = mtVI + mtVII + mtVIII;

            // Rice calculation: Class V gets 100gm, VI-VIII get 150gm per student
            const riceV = (mtV * mdmData.rice.V) / 1000;
            const riceVI = (mtVI * mdmData.rice.VI) / 1000;
            const riceVII = (mtVII * mdmData.rice.VII) / 1000;
            const riceVIII = (mtVIII * mdmData.rice.VIII) / 1000;
            const totalRice = riceV + riceVI + riceVII + riceVIII;

            // Cost calculation: Class V pays ‚Çπ6.78, VI-VIII pay ‚Çπ10.17 per student
            const costV = mtV * mdmData.cost.V;
            const costVI = mtVI * mdmData.cost.VI;
            const costVII = mtVII * mdmData.cost.VII;
            const costVIII = mtVIII * mdmData.cost.VIII;
            const totalCost = costV + costVI + costVII + costVIII;

            // Update display
            document.getElementById('totalCPVI').textContent = totalCPVI;
            document.getElementById('totalMTVI').textContent = totalMTVI;
            document.getElementById('totalRice').textContent = totalRice.toFixed(2);
            document.getElementById('totalCost').textContent = '‚Çπ' + totalCost.toFixed(2);

            // Update dashboard
            document.getElementById('dashTodayRice').textContent = totalRice.toFixed(2);
            document.getElementById('dashTodayCost').textContent = '‚Çπ ' + totalCost.toFixed(2);
            document.getElementById('todayCP').textContent = cpV + cpVI + cpVII + cpVIII;
            document.getElementById('todayMT').textContent = mtV + mtVI + mtVII + mtVIII;
            const attendance = (cpV + cpVI + cpVII + cpVIII) > 0 ? (((mtV + mtVI + mtVII + mtVIII) / (cpV + cpVI + cpVII + cpVIII)) * 100).toFixed(1) : 0;
            document.getElementById('todayAttendance').textContent = attendance + ' %';
        }

        function saveFormCEntry() {
            const dateElement = document.getElementById('cpDate');
            const date = dateElement ? dateElement.value : '';
            
            console.log('üíæ Saving Form C entry...', { date });
            
            // ‚úÖ VALIDATION 1: Date check
            if (!date) {
                showAlert('‚ùå Please select a date', 'error');
                console.error('‚ùå No date selected');
                return;
            }
            
            // ‚úÖ VALIDATION 2: Duplicate date check
            const isDuplicate = mdmData.formC.some(entry => entry.date === date);
            if (isDuplicate) {
                showAlert('‚ùå Entry for this date already exists! Please delete the old entry first.', 'error');
                console.error('‚ùå Duplicate date:', date);
                return;
            }
            
            // Get all values
            const cpV = parseInt(document.getElementById('cpV').value) || 0;
            const mtV = parseInt(document.getElementById('mtV').value) || 0;
            const cpVI = parseInt(document.getElementById('cpVI').value) || 0;
            const mtVI = parseInt(document.getElementById('mtVI').value) || 0;
            const cpVII = parseInt(document.getElementById('cpVII').value) || 0;
            const mtVII = parseInt(document.getElementById('mtVII').value) || 0;
            const cpVIII = parseInt(document.getElementById('cpVIII').value) || 0;
            const mtVIII = parseInt(document.getElementById('mtVIII').value) || 0;
            
            console.log('üìä Values:', { cpV, mtV, cpVI, mtVI, cpVII, mtVII, cpVIII, mtVIII });
            
            // ‚úÖ VALIDATION 3: Negative values check
            if (cpV < 0 || mtV < 0 || cpVI < 0 || mtVI < 0 || cpVII < 0 || mtVII < 0 || cpVIII < 0 || mtVIII < 0) {
                showAlert('‚ùå Values cannot be negative!', 'error');
                return;
            }
            
            // ‚úÖ VALIDATION 4: MT cannot exceed CP
            if (mtV > cpV) {
                showAlert(`‚ùå Class V: MT (${mtV}) cannot be greater than CP (${cpV})!`, 'error');
                return;
            }
            if (mtVI > cpVI) {
                showAlert(`‚ùå Class VI: MT (${mtVI}) cannot be greater than CP (${cpVI})!`, 'error');
                return;
            }
            if (mtVII > cpVII) {
                showAlert(`‚ùå Class VII: MT (${mtVII}) cannot be greater than CP (${cpVII})!`, 'error');
                return;
            }
            if (mtVIII > cpVIII) {
                showAlert(`‚ùå Class VIII: MT (${mtVIII}) cannot be greater than CP (${cpVIII})!`, 'error');
                return;
            }
            
            // ‚úÖ VALIDATION 5: CP cannot exceed enrollment
            const enrollV = mdmData.enrollment.V || 0;
            const enrollVI = mdmData.enrollment.VI || 0;
            const enrollVII = mdmData.enrollment.VII || 0;
            const enrollVIII = mdmData.enrollment.VIII || 0;
            
            if (cpV > enrollV) {
                showAlert(`‚ùå Class V: CP (${cpV}) cannot exceed enrollment (${enrollV})! Update enrollment in Settings if needed.`, 'error');
                return;
            }
            if (cpVI > enrollVI) {
                showAlert(`‚ùå Class VI: CP (${cpVI}) cannot exceed enrollment (${enrollVI})! Update enrollment in Settings if needed.`, 'error');
                return;
            }
            if (cpVII > enrollVII) {
                showAlert(`‚ùå Class VII: CP (${cpVII}) cannot exceed enrollment (${enrollVII})! Update enrollment in Settings if needed.`, 'error');
                return;
            }
            if (cpVIII > enrollVIII) {
                showAlert(`‚ùå Class VIII: CP (${cpVIII}) cannot exceed enrollment (${enrollVIII})! Update enrollment in Settings if needed.`, 'error');
                return;
            }
            
            // ‚úÖ VALIDATION 6: At least one student must be present
            const totalMT = mtV + mtVI + mtVII + mtVIII;
            if (totalMT === 0) {
                showAlert('‚ùå At least one student must have taken meal (MT > 0)!', 'error');
                return;
            }

            // Create entry object
            const entry = {
                date: date,
                cpV: cpV,
                mtV: mtV,
                cpVI: cpVI,
                mtVI: mtVI,
                cpVII: cpVII,
                mtVII: mtVII,
                cpVIII: cpVIII,
                mtVIII: mtVIII,
                totalCPVI: cpVI + cpVII + cpVIII,
                totalMTVI: mtVI + mtVII + mtVIII,
                menu: document.getElementById('formCMenu').value || 'Rice + Dal + Vegetable',
                cook: '',
                weather: '',
                rice: parseFloat(document.getElementById('totalRice').textContent) || 0,
                cost: parseFloat(document.getElementById('totalCost').textContent) || 0,
                timestamp: new Date().toLocaleTimeString()
            };

            console.log('üíæ Saving entry:', entry);

            // Save to mdmData.formC
            mdmData.formC.push(entry);
            saveAllData();
            
            // ALSO save to formCData (Enhanced Form C system)
            const formCData = JSON.parse(localStorage.getItem('formCData') || '[]');
            formCData.push(entry);
            localStorage.setItem('formCData', JSON.stringify(formCData));
            
            console.log('‚úÖ Saved to both storage systems');
            
            // Show success message
            showAlert('‚úÖ Form-C entry saved successfully!', 'success');
            
            // Update table
            loadFormCTable();
            
            // Update Enhanced Form C displays if available
            if (typeof EnhancedFormC !== 'undefined') {
                setTimeout(() => {
                    EnhancedFormC.renderCalendarView();
                    EnhancedFormC.updateStats();
                    console.log('‚úÖ Updated calendar and stats');
                }, 100);
            }
            
            // Update timestamp
            const lastSaveTimeElement = document.getElementById('lastSaveTime');
            if (lastSaveTimeElement) {
                lastSaveTimeElement.textContent = entry.timestamp;
            }
            
            // Clear form
            clearFormC();
            
            // Update dashboard
            if (typeof updateDashboard === 'function') {
                updateDashboard();
            }
            
            console.log('üéâ Form C entry saved successfully!');
        }

        function clearFormC() {
            document.getElementById('cpV').value = '0';
            document.getElementById('mtV').value = '0';
            document.getElementById('cpVI').value = '0';
            document.getElementById('mtVI').value = '0';
            document.getElementById('cpVII').value = '0';
            document.getElementById('mtVII').value = '0';
            document.getElementById('cpVIII').value = '0';
            document.getElementById('mtVIII').value = '0';
            
            const menuElement = document.getElementById('formCMenu');
            if (menuElement) {
                menuElement.value = 'Rice + Dal + Vegetable + Ban';
            }
            
            document.getElementById('totalCPVI').textContent = '0';
            document.getElementById('totalMTVI').textContent = '0';
            document.getElementById('totalRice').textContent = '0.00';
            document.getElementById('totalCost').textContent = '0.00';
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            const cpDateElement = document.getElementById('cpDate');
            if (cpDateElement) {
                cpDateElement.value = today;
            }
        }

        function loadFormCTable(filterMonth = 'all') {
            const tbody = document.getElementById('formCTableBody2') || document.getElementById('formCTableBody');
            if (!tbody) {
                console.error('‚ùå Table body not found!');
                return;
            }
            
            console.log('üìã Loading Form C table...', { filterMonth, totalEntries: mdmData.formC.length });
            
            tbody.innerHTML = '';
            
            // Helper function to normalize date to MM-YYYY format
            function getMonthYear(dateStr) {
                // Handle both DD-MM-YYYY and YYYY-MM-DD formats
                let parts;
                if (dateStr.includes('-')) {
                    parts = dateStr.split('-');
                    if (parts[0].length === 4) {
                        // YYYY-MM-DD format
                        return `${parts[1]}-${parts[0]}`;
                    } else {
                        // DD-MM-YYYY format
                        return `${parts[1]}-${parts[2]}`;
                    }
                }
                return null;
            }
            
            // Filter by month if specified
            let filteredData = mdmData.formC;
            if (filterMonth && filterMonth !== 'all') {
                filteredData = mdmData.formC.filter(entry => {
                    const entryMonthYear = getMonthYear(entry.date);
                    return entryMonthYear === filterMonth;
                });
                console.log(`üîç Filtered to ${filteredData.length} entries for ${filterMonth}`);
            }
            
            // Update filter status
            const statusElement = document.getElementById('formCFilterStatus');
            if (statusElement) {
                if (filterMonth === 'all') {
                    statusElement.textContent = `Total: ${filteredData.length} entries`;
                    statusElement.style.color = '#28a745';
                } else {
                    statusElement.textContent = `Showing: ${filteredData.length} entries for ${filterMonth}`;
                    statusElement.style.color = '#007bff';
                }
            }
            
            // Display entries
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="padding: 30px; text-align: center; color: #999; font-size: 16px;">
                            ‚ÑπÔ∏è No entries found. ${filterMonth === 'all' ? 'Upload Excel or add manual entries.' : 'Try selecting a different month.'}
                        </td>
                    </tr>
                `;
            } else {
                filteredData.forEach((entry, index) => {
                    const row = `<tr style="background: ${index % 2 === 0 ? '#fafafa' : 'white'}; border-bottom: 1px solid #ddd;">
                        <td style="padding: 10px; border: 1px solid #ddd;">${formatDateToDDMMYYYY(entry.date)}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${entry.cpV}/${entry.mtV}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${entry.cpVI}/${entry.mtVI}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${entry.cpVII}/${entry.mtVII}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${entry.cpVIII}/${entry.mtVIII}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center; background: #fffacd; font-weight: 600;">${entry.rice} kg</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center; background: #fffacd; font-weight: 600;">${entry.cost}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${entry.menu}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
                            <button class="btn btn-danger btn-sm" onclick="deleteFormCEntry('${entry.date}')" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer;">üóëÔ∏è</button>
                        </td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
                console.log(`‚úÖ Displayed ${filteredData.length} entries in table`);
            }
            
            // Populate month filter dropdown
            populateMonthFilter();
        }

        // ========== CLEAR ALL FORM C DATA ==========
        function clearAllFormCData() {
            if (!confirm('‚ö†Ô∏è WARNING: This will delete ALL Form C data!\n\nAre you absolutely sure?\n\nThis action cannot be undone!')) {
                return;
            }
            
            console.log('üóëÔ∏è Starting complete Form C data deletion...');
            
            // Clear mdmData.formC
            mdmData.formC = [];
            console.log('‚úÖ Cleared mdmData.formC');
            
            // Clear formCData
            localStorage.removeItem('formCData');
            console.log('‚úÖ Cleared formCData');
            
            // Save changes
            localStorage.setItem('mdmData', JSON.stringify(mdmData));
            console.log('‚úÖ Saved to localStorage');
            
            // Refresh all displays
            loadFormCTable();
            console.log('‚úÖ Refreshed table');
            
            // Refresh Enhanced Form C displays if available
            if (typeof EnhancedFormC !== 'undefined') {
                setTimeout(() => {
                    EnhancedFormC.renderCalendarView();
                    EnhancedFormC.updateStats();
                    console.log('‚úÖ Refreshed calendar and stats');
                }, 100);
            }
            
            showAlert('üéâ ALL Form C data deleted successfully!', 'success');
            console.log('üéâ Complete deletion finished!');
        }

        function deleteFormCEntry(dateToDelete) {
            if (!confirm(`Delete entry for ${dateToDelete}?`)) return;
            
            // Delete from mdmData.formC
            mdmData.formC = mdmData.formC.filter(entry => entry.date !== dateToDelete);
            
            // Also delete from formCData to keep in sync
            const formCData = JSON.parse(localStorage.getItem('formCData') || '[]');
            const updatedFormCData = formCData.filter(entry => entry.date !== dateToDelete);
            localStorage.setItem('formCData', JSON.stringify(updatedFormCData));
            
            saveAllData();
            loadFormCTable();
            
            // Refresh Enhanced Form C displays if available
            if (typeof EnhancedFormC !== 'undefined') {
                setTimeout(() => {
                    EnhancedFormC.renderCalendarView();
                    EnhancedFormC.updateStats();
                }, 100);
            }
            
            showAlert('‚úÖ Entry deleted successfully!', 'success');
            console.log(`üóëÔ∏è Deleted entry for ${dateToDelete}`);
        }

        function populateMonthFilter() {
            const select = document.getElementById('formCMonthFilter');
            if (!select) {
                console.error('‚ùå Month filter dropdown not found!');
                return;
            }
            
            if (mdmData.formC.length === 0) {
                console.log('‚ÑπÔ∏è No Form C data to populate months');
                return;
            }
            
            // Helper function to extract MM-YYYY
            function getMonthYear(dateStr) {
                let parts;
                if (dateStr.includes('-')) {
                    parts = dateStr.split('-');
                    if (parts[0].length === 4) {
                        // YYYY-MM-DD format
                        return `${parts[1]}-${parts[0]}`;
                    } else {
                        // DD-MM-YYYY format
                        return `${parts[1]}-${parts[2]}`;
                    }
                }
                return null;
            }
            
            // Get unique months from data
            const months = new Set();
            mdmData.formC.forEach(entry => {
                const monthYear = getMonthYear(entry.date);
                if (monthYear) {
                    months.add(monthYear);
                }
            });
            
            console.log(`üìÖ Found ${months.size} unique months:`, Array.from(months));
            
            // Clear existing options (except "All Months")
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Add month options
            Array.from(months).sort((a, b) => {
                const [aMonth, aYear] = a.split('-').map(Number);
                const [bMonth, bYear] = b.split('-').map(Number);
                if (aYear !== bYear) return bYear - aYear; // Newer years first
                return bMonth - aMonth; // Newer months first
            }).forEach(monthYear => {
                const [month, year] = monthYear.split('-');
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const monthName = monthNames[parseInt(month) - 1];
                const option = document.createElement('option');
                option.value = monthYear;
                option.textContent = `${monthName} ${year}`;
                select.appendChild(option);
            });
            
            console.log(`‚úÖ Month filter populated with ${months.size} options`);
        }

        function filterFormCByMonth() {
            const select = document.getElementById('formCMonthFilter');
            const filterValue = select.value;
            console.log(`üîç Filtering by month: ${filterValue}`);
            loadFormCTable(filterValue);
        }

        function validateFormC() {
            console.log('‚úì Validating Form C...');
            
            // Get all values
            const cpV = parseInt(document.getElementById('cpV').value) || 0;
            const mtV = parseInt(document.getElementById('mtV').value) || 0;
            const cpVI = parseInt(document.getElementById('cpVI').value) || 0;
            const mtVI = parseInt(document.getElementById('mtVI').value) || 0;
            const cpVII = parseInt(document.getElementById('cpVII').value) || 0;
            const mtVII = parseInt(document.getElementById('mtVII').value) || 0;
            const cpVIII = parseInt(document.getElementById('cpVIII').value) || 0;
            const mtVIII = parseInt(document.getElementById('mtVIII').value) || 0;
            
            console.log('üìä Values to validate:', { 
                V: { cp: cpV, mt: mtV }, 
                VI: { cp: cpVI, mt: mtVI },
                VII: { cp: cpVII, mt: mtVII },
                VIII: { cp: cpVIII, mt: mtVIII }
            });
            
            let errors = [];
            
            // Check Class V
            if (mtV > cpV) {
                errors.push(`Class V: MT (${mtV}) cannot be greater than CP (${cpV})`);
            }
            
            // Check Class VI
            if (mtVI > cpVI) {
                errors.push(`Class VI: MT (${mtVI}) cannot be greater than CP (${cpVI})`);
            }
            
            // Check Class VII
            if (mtVII > cpVII) {
                errors.push(`Class VII: MT (${mtVII}) cannot be greater than CP (${cpVII})`);
            }
            
            // Check Class VIII
            if (mtVIII > cpVIII) {
                errors.push(`Class VIII: MT (${mtVIII}) cannot be greater than CP (${cpVIII})`);
            }
            
            // Check for negative values
            if (cpV < 0 || mtV < 0 || cpVI < 0 || mtVI < 0 || cpVII < 0 || mtVII < 0 || cpVIII < 0 || mtVIII < 0) {
                errors.push('Values cannot be negative');
            }
            
            // Check if at least one student present
            const totalMT = mtV + mtVI + mtVII + mtVIII;
            if (totalMT === 0) {
                errors.push('At least one student must have taken meal (MT > 0)');
            }
            
            // Check enrollment limits
            const enrollV = mdmData.enrollment.V || 0;
            const enrollVI = mdmData.enrollment.VI || 0;
            const enrollVII = mdmData.enrollment.VII || 0;
            const enrollVIII = mdmData.enrollment.VIII || 0;
            
            if (cpV > enrollV) {
                errors.push(`Class V: CP (${cpV}) exceeds enrollment (${enrollV})`);
            }
            if (cpVI > enrollVI) {
                errors.push(`Class VI: CP (${cpVI}) exceeds enrollment (${enrollVI})`);
            }
            if (cpVII > enrollVII) {
                errors.push(`Class VII: CP (${cpVII}) exceeds enrollment (${enrollVII})`);
            }
            if (cpVIII > enrollVIII) {
                errors.push(`Class VIII: CP (${cpVIII}) exceeds enrollment (${enrollVIII})`);
            }
            
            // Show results
            if (errors.length > 0) {
                const errorMessage = '‚ùå Validation Failed:\n\n' + errors.join('\n');
                showAlert(errorMessage, 'error');
                console.error('‚ùå Validation errors:', errors);
                return false;
            }
            
            showAlert('‚úÖ Form-C is valid! All checks passed.', 'success');
            console.log('‚úÖ Validation passed');
            return true;
        }

        function copyYesterdayFormC() {
            if (mdmData.formC.length === 0) {
                showAlert('No previous entries to copy', 'error');
                return;
            }
            const yesterday = mdmData.formC[mdmData.formC.length - 1];
            document.getElementById('cpV').value = yesterday.cpV;
            document.getElementById('mtV').value = yesterday.mtV;
            document.getElementById('cpVI').value = yesterday.cpVI;
            document.getElementById('mtVI').value = yesterday.mtVI;
            document.getElementById('cpVII').value = yesterday.cpVII;
            document.getElementById('mtVII').value = yesterday.mtVII;
            document.getElementById('cpVIII').value = yesterday.cpVIII;
            document.getElementById('mtVIII').value = yesterday.mtVIII;
            calculateFormC();
            showAlert('Previous entry copied!', 'success');
        }

        function printFormC() {
            window.print();
        }

        // ========== RICE LEDGER FUNCTIONS ==========
        function calculateRiceClosing() {
            const opening = parseFloat(document.getElementById('riceOpening').value) || 0;
            const received = parseFloat(document.getElementById('riceReceived').value) || 0;
            const used = parseFloat(document.getElementById('riceUsed').value) || 0;
            const closing = opening + received - used;
            document.getElementById('riceClosing').value = closing.toFixed(2);
        }

        function saveRiceLedger() {
            const entry = {
                date: document.getElementById('riceLedgerDate').value,
                opening: parseFloat(document.getElementById('riceOpening').value) || 0,
                received: parseFloat(document.getElementById('riceReceived').value) || 0,
                used: parseFloat(document.getElementById('riceUsed').value) || 0,
                closing: parseFloat(document.getElementById('riceClosing').value) || 0,
                supplier: document.getElementById('riceSupplier').value
            };

            mdmData.riceLedger.push(entry);
            saveAllData();
            showAlert('Rice entry saved!', 'success');
            loadRiceLedgerTable();
            clearRiceEntry();
        }

        function clearRiceEntry() {
            document.getElementById('riceOpening').value = '';
            document.getElementById('riceReceived').value = '';
            document.getElementById('riceUsed').value = '';
            document.getElementById('riceClosing').value = '';
            document.getElementById('riceSupplier').value = '';
        }

        function loadRiceLedgerTable() {
            const tbody = document.getElementById('riceLedgerTableBody');
            tbody.innerHTML = '';
            mdmData.riceLedger.forEach((entry, index) => {
                const row = `<tr>
                    <td>${formatDateToDDMMYYYY(entry.date)}</td>
                    <td>${entry.opening.toFixed(2)}</td>
                    <td>${entry.received.toFixed(2)}</td>
                    <td>${entry.used.toFixed(2)}</td>
                    <td>${entry.closing.toFixed(2)}</td>
                    <td>${entry.supplier}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteRiceEntry(${index})">üóëÔ∏è</button></td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function deleteRiceEntry(index) {
            mdmData.riceLedger.splice(index, 1);
            saveAllData();
            loadRiceLedgerTable();
        }

        // ========== BANK LEDGER FUNCTIONS ==========
        function saveBankEntry() {
            const entry = {
                date: document.getElementById('bankDate').value,
                type: document.getElementById('bankType').value,
                amount: parseFloat(document.getElementById('bankAmount').value) || 0,
                description: document.getElementById('bankDescription').value
            };

            mdmData.bankLedger.push(entry);
            saveAllData();
            showAlert('Bank entry saved!', 'success');
            loadBankLedgerTable();
            clearBankEntry();
        }

        function clearBankEntry() {
            document.getElementById('bankAmount').value = '';
            document.getElementById('bankDescription').value = '';
        }

        function loadBankLedgerTable() {
            const tbody = document.getElementById('bankLedgerTableBody');
            tbody.innerHTML = '';
            mdmData.bankLedger.forEach((entry, index) => {
                const row = `<tr>
                    <td>${formatDateToDDMMYYYY(entry.date)}</td>
                    <td>${entry.type}</td>
                    <td>‚Çπ ${entry.amount.toFixed(2)}</td>
                    <td>${entry.description}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteBankEntry(${index})">üóëÔ∏è</button></td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function deleteBankEntry(index) {
            mdmData.bankLedger.splice(index, 1);
            saveAllData();
            loadBankLedgerTable();
        }

        // ========== EXPENSE LEDGER FUNCTIONS ==========
        function saveExpenseEntry() {
            const entry = {
                date: document.getElementById('expenseDate').value,
                category: document.getElementById('expenseCategory').value,
                amount: parseFloat(document.getElementById('expenseAmount').value) || 0,
                description: document.getElementById('expenseDescription').value
            };

            mdmData.expenseLedger.push(entry);
            saveAllData();
            showAlert('Expense entry saved!', 'success');
            loadExpenseLedgerTable();
            clearExpenseEntry();
        }

        function clearExpenseEntry() {
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDescription').value = '';
        }

        function loadExpenseLedgerTable() {
            const tbody = document.getElementById('expenseLedgerTableBody');
            tbody.innerHTML = '';
            mdmData.expenseLedger.forEach((entry, index) => {
                const row = `<tr>
                    <td>${formatDateToDDMMYYYY(entry.date)}</td>
                    <td>${entry.category}</td>
                    <td>‚Çπ ${entry.amount.toFixed(2)}</td>
                    <td>${entry.description}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteExpenseEntry(${index})">üóëÔ∏è</button></td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function deleteExpenseEntry(index) {
            mdmData.expenseLedger.splice(index, 1);
            saveAllData();
            loadExpenseLedgerTable();
        }

        // ========== COOK & STAFF FUNCTIONS ==========
        function addCook() {
            const name = document.getElementById('cookName').value;
            const designation = document.getElementById('cookDesignation').value;
            const mobile = document.getElementById('cookMobile').value;
            const aadhar = document.getElementById('cookAadhar').value;

            if (!name || !designation) {
                showAlert('Please fill all cook details', 'error');
                return;
            }

            mdmData.cooks.push({ name, designation, mobile, aadhar });
            saveAllData();
            showAlert('Cook added!', 'success');
            loadCooksTable();
            populateCookDropdown();
            document.getElementById('cookName').value = '';
            document.getElementById('cookDesignation').value = '';
            document.getElementById('cookMobile').value = '';
            document.getElementById('cookAadhar').value = '';
        }

        function loadCooksTable() {
            const tbody = document.getElementById('cookTableBody');
            tbody.innerHTML = '';
            mdmData.cooks.forEach((cook, index) => {
                const row = `<tr>
                    <td>${cook.name}</td>
                    <td>${cook.designation}</td>
                    <td>${cook.mobile}</td>
                    <td>${cook.aadhar}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteCook(${index})">üóëÔ∏è</button></td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function deleteCook(index) {
            mdmData.cooks.splice(index, 1);
            saveAllData();
            loadCooksTable();
            populateCookDropdown();
        }

        function populateCookDropdown() {
            const select = document.getElementById('formCCook');
            if (select) {
                select.innerHTML = '<option value="">-- Select Cook --</option>';
                mdmData.cooks.forEach(cook => {
                    const option = document.createElement('option');
                    option.value = cook.name;
                    option.textContent = cook.name;
                    select.appendChild(option);
                });
            }
        }

        function addStaff() {
            const name = document.getElementById('staffName').value;
            const designation = document.getElementById('staffDesignation').value;
            const mobile = document.getElementById('staffMobile').value;
            const department = document.getElementById('staffDepartment').value;

            if (!name || !designation || !department) {
                showAlert('Please fill all staff details', 'error');
                return;
            }

            mdmData.staff.push({ name, designation, mobile, department });
            saveAllData();
            showAlert('Staff added!', 'success');
            loadStaffTable();
            document.getElementById('staffName').value = '';
            document.getElementById('staffDesignation').value = '';
            document.getElementById('staffMobile').value = '';
            document.getElementById('staffDepartment').value = '';
        }

        function loadStaffTable() {
            const tbody = document.getElementById('staffTableBody');
            tbody.innerHTML = '';
            mdmData.staff.forEach((staff, index) => {
                const row = `<tr>
                    <td>${staff.name}</td>
                    <td>${staff.designation}</td>
                    <td>${staff.mobile}</td>
                    <td>${staff.department}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteStaff(${index})">üóëÔ∏è</button></td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function deleteStaff(index) {
            mdmData.staff.splice(index, 1);
            saveAllData();
            loadStaffTable();
        }

        // ========== SETTINGS FUNCTIONS ==========
        function saveAllSettings() {
            console.log('üíæ Saving all settings...');
            
            // Show loading state
            const saveButton = event?.target;
            if (saveButton) {
                saveButton.disabled = true;
                saveButton.innerHTML = '‚è≥ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
                saveButton.style.opacity = '0.7';
            }
            
            try {
                // School Information
                mdmData.school.name = document.getElementById('settingsSchoolName')?.value || '';
                mdmData.school.location = document.getElementById('settingsLocation')?.value || '';
                mdmData.school.block = document.getElementById('settingsBlock')?.value || '';
                mdmData.school.dise = document.getElementById('settingsDISE')?.value || '';
                mdmData.school.hoi = document.getElementById('settingsHOI')?.value || '';
                mdmData.school.mdmic = document.getElementById('settingsMDMIC')?.value || '';
                
                // Additional school fields
                if (document.getElementById('settingsHOIDesignation'))
                    mdmData.school.hoiDesignation = document.getElementById('settingsHOIDesignation').value;
                if (document.getElementById('settingsHOIMobile'))
                    mdmData.school.hoiMobile = document.getElementById('settingsHOIMobile').value;
                if (document.getElementById('settingsMDMICMobile'))
                    mdmData.school.mdmicMobile = document.getElementById('settingsMDMICMobile').value;
                if (document.getElementById('settingsCategory'))
                    mdmData.school.category = document.getElementById('settingsCategory').value;
                
                // ‚úÖ NEW: District, Subdivision, GP/Ward, SHG fields - save to mdmData
                if (document.getElementById('settingsDistrict'))
                    mdmData.school.district = document.getElementById('settingsDistrict').value;
                if (document.getElementById('settingsSubdivision'))
                    mdmData.school.subdivision = document.getElementById('settingsSubdivision').value;
                if (document.getElementById('settingsGPWard'))
                    mdmData.school.gpWard = document.getElementById('settingsGPWard').value;
                if (document.getElementById('settingsSHGName'))
                    mdmData.school.shgName = document.getElementById('settingsSHGName').value;
                
                // ‚úÖ NEW: Bank and Contact details - save to mdmData
                if (document.getElementById('settingsBankName'))
                    mdmData.school.bankName = document.getElementById('settingsBankName').value;
                if (document.getElementById('settingsBankAccountNo'))
                    mdmData.school.bankAccountNo = document.getElementById('settingsBankAccountNo').value;
                if (document.getElementById('settingsContactNo'))
                    mdmData.school.contactNo = document.getElementById('settingsContactNo').value;

                // Enrollment
                mdmData.enrollment.V = parseInt(document.getElementById('enrollmentV')?.value) || 0;
                mdmData.enrollment.VI = parseInt(document.getElementById('enrollmentVI')?.value) || 0;
                mdmData.enrollment.VII = parseInt(document.getElementById('enrollmentVII')?.value) || 0;
                mdmData.enrollment.VIII = parseInt(document.getElementById('enrollmentVIII')?.value) || 0;

                // MDM Parameters (rice values are now in grams)
                const riceV = parseFloat(document.getElementById('riceClassV')?.value) || 100;
                mdmData.rice.V = riceV; // Rice in grams
                
                const riceVI = parseFloat(document.getElementById('riceClassVIVIIVIII')?.value) || 150;
                mdmData.rice.VI = riceVI;
                mdmData.rice.VII = riceVI;
                mdmData.rice.VIII = riceVI;

                mdmData.cost.V = parseFloat(document.getElementById('costClassV')?.value) || 6.78;
                const costVI = parseFloat(document.getElementById('costClassVIVIIVIII')?.value) || 10.17;
                mdmData.cost.VI = costVI;
                mdmData.cost.VII = costVI;
                mdmData.cost.VIII = costVI;

                // Additional MDM parameters
                if (document.getElementById('riceOpeningStock'))
                    mdmData.riceOpeningStock = parseFloat(document.getElementById('riceOpeningStock').value) || 0;
                if (document.getElementById('fundOpening'))
                    mdmData.fundOpening = parseFloat(document.getElementById('fundOpening').value) || 0;

                // Bank details
                if (document.getElementById('bankAccountName'))
                    mdmData.bank = {
                        accountName: document.getElementById('bankAccountName').value || '',
                        accountNumber: document.getElementById('bankAccountNumber')?.value || '',
                        branch: document.getElementById('bankBranch')?.value || '',
                        ifsc: document.getElementById('bankIFSC')?.value || ''
                    };

                // Other details
                if (document.getElementById('gpMunicipality'))
                    mdmData.gpMunicipality = document.getElementById('gpMunicipality').value;
                if (document.getElementById('yearEstablishment'))
                    mdmData.yearEstablishment = document.getElementById('yearEstablishment').value;

                // Weekly Menu
                if (document.getElementById('menuMon1')) {
                    mdmData.weeklyMenu = {
                        monday: [document.getElementById('menuMon1').value, document.getElementById('menuMon2').value],
                        tuesday: [document.getElementById('menuTue1').value, document.getElementById('menuTue2').value],
                        wednesday: [document.getElementById('menuWed1').value, document.getElementById('menuWed2').value],
                        thursday: [document.getElementById('menuThu1').value, document.getElementById('menuThu2').value],
                        friday: [document.getElementById('menuFri1').value, document.getElementById('menuFri2').value],
                        saturday: [document.getElementById('menuSat1').value, document.getElementById('menuSat2').value]
                    };
                }

                // Cook Details List
                if (document.getElementById('cookDetailsList'))
                    mdmData.cookDetailsList = document.getElementById('cookDetailsList').value;

                // Staff Management List
                if (document.getElementById('staffManagementList'))
                    mdmData.staffManagementList = document.getElementById('staffManagementList').value;

                // ‚úÖ Cooks and Staff are saved via their respective arrays in mdmData
                // No need to save separately as they're already part of mdmData

                // Save to localStorage
                saveAllData();
                
                // Update displays
                updateEnrollmentTotals();
                updateDashboard();
                refreshPreview(); // Update sidebar stats
                
                console.log('‚úÖ Settings saved successfully!');
                
                // Show success message
                showAlert('‚úÖ ‡¶∏‡¶¨ Settings ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
                
                // Visual feedback
                if (saveButton) {
                    saveButton.innerHTML = '‚úÖ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
                    saveButton.style.background = '#28a745';
                    saveButton.style.opacity = '1';
                    
                    // Reset button after 2 seconds
                    setTimeout(() => {
                        saveButton.disabled = false;
                        saveButton.innerHTML = 'üíæ Save';
                        saveButton.style.background = '#4A90E2';
                    }, 2000);
                }
                
            } catch (error) {
                console.error('‚ùå Error saving settings:', error);
                showAlert('‚ùå Settings ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'error');
                
                // Reset button on error
                if (saveButton) {
                    saveButton.disabled = false;
                    saveButton.innerHTML = 'üíæ Save';
                    saveButton.style.opacity = '1';
                }
            }
        }

        // Update enrollment totals display
        function updateEnrollmentTotals() {
            const v = parseInt(document.getElementById('enrollmentV')?.value) || 0;
            const vi = parseInt(document.getElementById('enrollmentVI')?.value) || 0;
            const vii = parseInt(document.getElementById('enrollmentVII')?.value) || 0;
            const viii = parseInt(document.getElementById('enrollmentVIII')?.value) || 0;

            const totalPrimary = v;
            const totalUpperPrimary = vi + vii + viii;

            if (document.getElementById('totalPrimaryDisplay'))
                document.getElementById('totalPrimaryDisplay').textContent = totalPrimary;
            if (document.getElementById('totalUpperPrimaryDisplay'))
                document.getElementById('totalUpperPrimaryDisplay').textContent = totalUpperPrimary;
        }

        // Auto-update totals when enrollment changes
        document.addEventListener('DOMContentLoaded', function() {
            const enrollmentInputs = ['enrollmentV', 'enrollmentVI', 'enrollmentVII', 'enrollmentVIII'];
            enrollmentInputs.forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    elem.addEventListener('input', updateEnrollmentTotals);
                    elem.addEventListener('change', updateEnrollmentTotals);
                }
            });
        });

        // Generate Reports function
        function generateReports() {
            showAlert('üìä Generating comprehensive reports...', 'success');
            setTimeout(() => {
                showAlert('Reports generated successfully!', 'success');
            }, 1000);
        }

        // Change Theme function
        function changeTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            showAlert('üé® Theme changed!', 'success');
        }

        // Lock System function
        function lockSystem() {
            const pin = localStorage.getItem('mdmPIN') || '1234';
            const enteredPIN = prompt('Enter PIN to lock the system:');
            if (enteredPIN === pin) {
                showAlert('üîí System locked!', 'success');
                // In a real app, this would redirect or hide content
            } else {
                showAlert('‚ùå Incorrect PIN!', 'error');
            }
        }

        // Apply PIN function
        function applyPIN() {
            const newPIN = document.getElementById('changePIN')?.value;
            const confirmPIN = document.getElementById('confirmPIN')?.value;
            
            if (!newPIN || !confirmPIN) {
                showAlert('‚ö†Ô∏è Please enter both PIN fields', 'error');
                return;
            }
            
            if (newPIN.length !== 4 || confirmPIN.length !== 4) {
                showAlert('‚ö†Ô∏è PIN must be 4 digits', 'error');
                return;
            }
            
            if (newPIN !== confirmPIN) {
                showAlert('‚ùå PINs do not match!', 'error');
                return;
            }
            
            localStorage.setItem('mdmPIN', newPIN);
            document.getElementById('changePIN').value = '';
            document.getElementById('confirmPIN').value = '';
            showAlert('‚úì PIN updated successfully!', 'success');
        }

        // Load Settings function
        function loadSettings() {
            loadAllData();
            showAlert('üìÇ Settings loaded from storage!', 'success');
            location.reload();
        }

        // Reset Settings function
        function resetSettings() {
            if (confirm('‚ö†Ô∏è Are you sure you want to reset all settings to default? This cannot be undone!')) {
                localStorage.clear();
                showAlert('‚Üª Settings reset! Reloading...', 'success');
                setTimeout(() => location.reload(), 1000);
            }
        }

        // Generate UC function
        function generateUC() {
            showAlert('üìÑ Generating Utilization Certificate...', 'success');
            setTimeout(() => {
                showAlert('‚úì UC generated successfully!', 'success');
            }, 1500);
        }

        // Refresh Preview function
        function refreshPreview() {
            // Update school info
            const schoolName = document.getElementById('settingsSchoolName')?.value || 'Ramnagar High School';
            const dise = document.getElementById('settingsDISE')?.value || '19090306103';
            const mdmic = document.getElementById('settingsMDMIC')?.value || 'Tapas Mahata';
            
            if (document.getElementById('previewSchoolName')) {
                document.getElementById('previewSchoolName').textContent = schoolName;
            }
            if (document.getElementById('previewDISE')) {
                document.getElementById('previewDISE').textContent = 'DISE: ' + dise;
            }
            if (document.getElementById('previewMDMIC')) {
                document.getElementById('previewMDMIC').textContent = mdmic;
            }
            
            // Update enrollment
            const v = parseInt(document.getElementById('enrollmentV')?.value) || 0;
            const vi = parseInt(document.getElementById('enrollmentVI')?.value) || 0;
            const vii = parseInt(document.getElementById('enrollmentVII')?.value) || 0;
            const viii = parseInt(document.getElementById('enrollmentVIII')?.value) || 0;
            const total = v + vi + vii + viii;
            
            if (document.getElementById('previewTotalEnrollment')) {
                document.getElementById('previewTotalEnrollment').textContent = total;
            }
            
            // Update rice and cost
            const riceV = parseFloat(document.getElementById('riceClassV')?.value) || 100;
            const riceVIVIIVIII = parseFloat(document.getElementById('riceClassVIVIIVIII')?.value) || 150;
            const costV = parseFloat(document.getElementById('costClassV')?.value) || 6.78;
            const costVIVIIVIII = parseFloat(document.getElementById('costClassVIVIIVIII')?.value) || 10.17;
            
            if (document.getElementById('previewRicePerMeal')) {
                document.getElementById('previewRicePerMeal').textContent = `${riceV}g V | ${riceVIVIIVIII}g VI-VIII`;
            }
            if (document.getElementById('previewCostPerMeal')) {
                document.getElementById('previewCostPerMeal').textContent = `‚Çπ${costV} V | ‚Çπ${costVIVIIVIII} VI-VIII`;
            }
            
            // Update quick stats
            if (document.getElementById('previewFormCCount')) {
                document.getElementById('previewFormCCount').textContent = mdmData.formC?.length || 0;
            }
            if (document.getElementById('statsCoooksCount')) {
                document.getElementById('statsCoooksCount').textContent = mdmData.cooks?.length || 0;
            }
            if (document.getElementById('statsStaffCount')) {
                document.getElementById('statsStaffCount').textContent = mdmData.staff?.length || 0;
            }
            if (document.getElementById('statsRiceCount')) {
                document.getElementById('statsRiceCount').textContent = mdmData.riceLedger?.length || 0;
            }
            if (document.getElementById('statsBankCount')) {
                document.getElementById('statsBankCount').textContent = mdmData.bankLedger?.length || 0;
            }
            
            // Calculate and update storage
            const storageSize = new Blob([JSON.stringify(mdmData)]).size;
            const storageMB = (storageSize / (1024 * 1024)).toFixed(2);
            const storagePercent = Math.min((storageSize / (5 * 1024 * 1024)) * 100, 100); // Assume 5MB limit
            
            if (document.getElementById('storageUsed')) {
                document.getElementById('storageUsed').textContent = `${storageMB} MB`;
            }
            if (document.getElementById('storageBar')) {
                document.getElementById('storageBar').style.width = `${storagePercent}%`;
            }
            
            updateEnrollmentTotals();
            showAlert('üîÑ Preview refreshed!', 'success');
        }
        
        // Update Sidebar Statistics
        function updateSidebarStats() {
            if (document.getElementById('sidebarFormCCount')) {
                document.getElementById('sidebarFormCCount').textContent = mdmData.formC?.length || 0;
            }
            if (document.getElementById('sidebarExpenseCount')) {
                document.getElementById('sidebarExpenseCount').textContent = mdmData.expenseLedger?.length || 0;
            }
            if (document.getElementById('sidebarRiceCount')) {
                document.getElementById('sidebarRiceCount').textContent = mdmData.riceLedger?.length || 0;
            }
            if (document.getElementById('sidebarBankCount')) {
                document.getElementById('sidebarBankCount').textContent = mdmData.bankLedger?.length || 0;
            }
        }
        
        // Auto-update sidebar stats every 5 seconds
        setInterval(updateSidebarStats, 5000);

        // ========== DATA MANAGEMENT ==========
        function saveAllData() {
            localStorage.setItem('mdmData', JSON.stringify(mdmData));
        }

        function loadAllData() {
            const saved = localStorage.getItem('mdmData');
            if (saved) {
                Object.assign(mdmData, JSON.parse(saved));
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(mdmData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `MDM_Data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showAlert('Data exported!', 'success');
        }

        function importData() {
            const file = document.getElementById('importInput').files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    Object.assign(mdmData, imported);
                    saveAllData();
                    location.reload();
                    showAlert('Data imported successfully!', 'success');
                } catch (error) {
                    showAlert('Error importing data: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        // ========== LOGO UPLOAD FUNCTIONS ==========
        function uploadHeaderLogo() {
            const file = document.getElementById('headerLogoInput').files[0];
            if (!file) {
                showAlert('üì§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø logo file ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            // Validate file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                showAlert('‚ùå File size ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¨‡¶°‡¶º! Maximum 2MB ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const logoData = e.target.result;
                localStorage.setItem('headerLogo', logoData);
                
                // Update header logo in main header
                const headerLogo = document.getElementById('headerLogoImg');
                if (headerLogo) {
                    headerLogo.src = logoData;
                }
                
                // Update preview in settings
                const headerPreview = document.getElementById('headerLogoPreview');
                const headerPlaceholder = document.getElementById('headerLogoPlaceholder');
                if (headerPreview && headerPlaceholder) {
                    headerPreview.src = logoData;
                    headerPreview.style.display = 'block';
                    headerPlaceholder.style.display = 'none';
                }
                
                showAlert('‚úÖ Header logo ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
                document.getElementById('headerLogoInput').value = '';
            };
            reader.readAsDataURL(file);
        }

        function uploadFooterLogo() {
            const file = document.getElementById('footerLogoInput').files[0];
            if (!file) {
                showAlert('üì§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø logo file ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            // Validate file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                showAlert('‚ùå File size ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¨‡¶°‡¶º! Maximum 2MB ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const logoData = e.target.result;
                localStorage.setItem('footerLogo', logoData);
                
                // Update footer logo in main footer
                const footerLogo = document.getElementById('footerLogoImg');
                if (footerLogo) {
                    footerLogo.src = logoData;
                }
                
                // Update preview in settings
                const footerPreview = document.getElementById('footerLogoPreview');
                const footerPlaceholder = document.getElementById('footerLogoPlaceholder');
                if (footerPreview && footerPlaceholder) {
                    footerPreview.src = logoData;
                    footerPreview.style.display = 'block';
                    footerPlaceholder.style.display = 'none';
                }
                
                showAlert('‚úÖ Footer logo ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
                document.getElementById('footerLogoInput').value = '';
            };
            reader.readAsDataURL(file);
        }

        function loadLogos() {
            const headerLogo = localStorage.getItem('headerLogo');
            const footerLogo = localStorage.getItem('footerLogo');
            
            // Update header logo in header section
            if (headerLogo) {
                const headerImg = document.getElementById('headerLogoImg');
                if (headerImg) {
                    headerImg.src = headerLogo;
                    console.log('Header logo loaded from localStorage');
                }
                
                // Update preview in settings
                const headerPreview = document.getElementById('headerLogoPreview');
                const headerPlaceholder = document.getElementById('headerLogoPlaceholder');
                if (headerPreview && headerPlaceholder) {
                    headerPreview.src = headerLogo;
                    headerPreview.style.display = 'block';
                    headerPlaceholder.style.display = 'none';
                }
            }
            
            // Update footer logo in footer section
            if (footerLogo) {
                const footerImg = document.getElementById('footerLogoImg');
                if (footerImg) {
                    footerImg.src = footerLogo;
                    console.log('Footer logo loaded from localStorage');
                }
                
                // Update preview in settings
                const footerPreview = document.getElementById('footerLogoPreview');
                const footerPlaceholder = document.getElementById('footerLogoPlaceholder');
                if (footerPreview && footerPlaceholder) {
                    footerPreview.src = footerLogo;
                    footerPreview.style.display = 'block';
                    footerPlaceholder.style.display = 'none';
                }
            }
        }

        // ========== ALERTS ==========
        function showAlert(message, type) {
            const alertEl = type === 'success' ? document.getElementById('alertSuccess') : document.getElementById('alertError');
            alertEl.textContent = message;
            alertEl.classList.add('show');
            setTimeout(() => alertEl.classList.remove('show'), 3000);
        }

        // ========== PDF GENERATION FUNCTIONS ==========
        
        // Helper: Signature section for all PDFs
        function createSignatureSection() {
            return `
                <div class="signature-section" style="margin-top: 60px; display: flex; justify-content: space-between; padding: 0 40px;">
                    <div style="text-align: center;">
                        <div style="border-bottom: 2px solid #000; width: 200px; margin: 0 auto 10px;"></div>
                        <p style="font-weight: bold; margin: 0; font-size: 14px;">MDM In-Charge</p>
                        <p style="font-size: 12px; margin: 5px 0 0 0;">${mdmData.school.mdmic}</p>
                    </div>
                    <div style="text-align: center;">
                        <div style="border-bottom: 2px solid #000; width: 200px; margin: 0 auto 10px;"></div>
                        <p style="font-weight: bold; margin: 0; font-size: 14px;">Head of Institution</p>
                        <p style="font-size: 12px; margin: 5px 0 0 0;">${mdmData.school.hoi}</p>
                    </div>
                </div>
            `;
        }
        
        // Generate Form-C PDF Download
        function generateFormCPDF() {
            console.log('üìã Form-C PDF button clicked');
            console.log('Form-C data:', mdmData.formC);
            
            if (!mdmData.formC || mdmData.formC.length === 0) {
                alert('‚ùå No Form-C data found! Please add entries first in the Form-C tab.');
                showAlert('‚ùå No Form-C data found! Please add entries first.', 'error');
                return;
            }
            
            console.log('‚úÖ Form-C data exists, generating PDF...');
            
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            // Build table rows
            let tableRows = '';
            let totalCP = 0, totalMT = 0, totalRice = 0, totalCost = 0;
            
            mdmData.formC.forEach((entry, idx) => {
                const cpV = parseInt(entry.cpV || 0);
                const cpVI = parseInt(entry.cpVI || 0);
                const cpVII = parseInt(entry.cpVII || 0);
                const cpVIII = parseInt(entry.cpVIII || 0);
                const mtV = parseInt(entry.mtV || 0);
                const mtVI = parseInt(entry.mtVI || 0);
                const mtVII = parseInt(entry.mtVII || 0);
                const mtVIII = parseInt(entry.mtVIII || 0);
                
                const cpTotal = cpV + cpVI + cpVII + cpVIII;
                const mtTotal = mtV + mtVI + mtVII + mtVIII;
                const rice = ((mtV * mdmData.rice.V) + (mtVI * mdmData.rice.VI) + 
                             (mtVII * mdmData.rice.VII) + (mtVIII * mdmData.rice.VIII)) / 1000;
                const cost = (mtV * mdmData.cost.V) + (mtVI * mdmData.cost.VI) + 
                            (mtVII * mdmData.cost.VII) + (mtVIII * mdmData.cost.VIII);
                
                totalCP += cpTotal;
                totalMT += mtTotal;
                totalRice += rice;
                totalCost += cost;
                
                tableRows += `
                    <tr>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${idx + 1}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${entry.date}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${cpV}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${mtV}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${cpVI}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${mtVI}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${cpVII}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${mtVII}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${cpVIII}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${mtVIII}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000; font-weight: 600;">${cpTotal}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000; font-weight: 600;">${mtTotal}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000;">${rice.toFixed(2)}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000;">‚Çπ${cost.toFixed(2)}</td>
                        <td style="padding: 8px; border: 1px solid #000; font-size: 10px;">${entry.menu || '-'}</td>
                    </tr>
                `;
            });
            
            const formHTML = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Form-C Report - ${month} ${year}</title>
<style>
    @page { size: A4 landscape; margin: 10mm; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; padding: 15px; font-size: 10px; line-height: 1.3; }
    .header { text-align: center; border: 2px solid #000; padding: 10px; margin-bottom: 12px; background: #f0f0f0; }
    .header h1 { font-size: 14px; color: #000; margin: 4px 0; font-weight: 700; }
    .header p { font-size: 11px; margin: 2px 0; }
    .info-section { margin: 8px 0; font-size: 10px; }
    .info-section strong { display: inline-block; width: 120px; }
    table { width: 100%; border-collapse: collapse; margin: 8px 0; font-size: 9px; }
    table th { background: #d0d0d0; font-weight: bold; text-align: center; padding: 6px 3px; border: 1px solid #000; font-size: 9px; }
    table td { border: 1px solid #000; padding: 5px 3px; }
    .total-row { background: #f5f5f5; font-weight: bold; }
    .signature { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 30px; text-align: center; }
    .signature-line { border-top: 1px solid #000; padding-top: 6px; margin-top: 30px; font-weight: 600; font-size: 10px; }
    .btn-print { position: fixed; top: 15px; right: 15px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; z-index: 1000; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
    .btn-print:hover { background: #45a049; }
    @media print { .btn-print { display: none !important; } body { padding: 0; } }
</style></head>
<body>
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    
    <div class="header">
        <h1>üìã FORM-C DAILY ATTENDANCE & MEAL COVERAGE REPORT</h1>
        <p><strong>${mdmData.school.name.toUpperCase()}</strong></p>
        <p>${mdmData.school.location} | Block: ${mdmData.school.block} | DISE: ${mdmData.school.dise}</p>
        <p>Month: ${month} ${year} | Generated: ${currentDate.toLocaleDateString('en-GB')}</p>
    </div>
    
    <div class="info-section">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px;">
            <div><strong>District:</strong> ${mdmData.school.district}</div>
            <div><strong>Subdivision:</strong> ${mdmData.school.subdivision}</div>
            <div><strong>GP/Ward:</strong> ${mdmData.school.gpWard}</div>
            <div><strong>Total Working Days:</strong> ${mdmData.formC.length} days</div>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th rowspan="3" style="width: 30px;">Sl.<br>No.</th>
                <th rowspan="3" style="width: 70px;">Date</th>
                <th colspan="8">No. of Children Provided CMDM and Present</th>
                <th rowspan="3" style="width: 40px;">Total<br>CP</th>
                <th rowspan="3" style="width: 40px;">Total<br>MT</th>
                <th rowspan="3" style="width: 50px;">Rice<br>Used<br>(Kg)</th>
                <th rowspan="3" style="width: 55px;">Cost<br>(‚Çπ)</th>
                <th rowspan="3" style="width: 80px;">Menu</th>
            </tr>
            <tr>
                <th colspan="2">Class V</th>
                <th colspan="2">Class VI</th>
                <th colspan="2">Class VII</th>
                <th colspan="2">Class VIII</th>
            </tr>
            <tr>
                <th style="width: 35px;">CP</th><th style="width: 35px;">MT</th>
                <th style="width: 35px;">CP</th><th style="width: 35px;">MT</th>
                <th style="width: 35px;">CP</th><th style="width: 35px;">MT</th>
                <th style="width: 35px;">CP</th><th style="width: 35px;">MT</th>
            </tr>
        </thead>
        <tbody>
            ${tableRows}
            <tr class="total-row">
                <td colspan="10" style="text-align: right; padding: 8px; font-size: 10px;"><strong>MONTH TOTAL:</strong></td>
                <td style="text-align: center; padding: 8px; font-size: 10px;"><strong>${totalCP}</strong></td>
                <td style="text-align: center; padding: 8px; font-size: 10px;"><strong>${totalMT}</strong></td>
                <td style="text-align: right; padding: 8px; font-size: 10px;"><strong>${totalRice.toFixed(2)}</strong></td>
                <td style="text-align: right; padding: 8px; font-size: 10px;"><strong>‚Çπ${totalCost.toFixed(2)}</strong></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    
    <div style="background: #e3f2fd; border-left: 3px solid #2196f3; padding: 8px; margin-top: 10px; font-size: 9px;">
        <strong>üìä Summary:</strong> Total ${totalMT} meals served to ${totalCP} children over ${mdmData.formC.length} days. 
        Rice consumed: ${totalRice.toFixed(2)} Kg. Total cooking cost: ‚Çπ${totalCost.toFixed(2)}
    </div>
    
    <div class="signature">
        <div>
            <div class="signature-line">MDM In-Charge<br>${mdmData.school.mdmic}</div>
        </div>
        <div>
            <div class="signature-line">Head Teacher<br>${mdmData.school.hoi}</div>
        </div>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, `Form-C Report - ${month} ${year}`);
            showAlert('‚úÖ Form-C Report opened! Click Print to save as PDF.', 'success');
        }
        
        // Generate Rice Ledger PDF Download
        function generateRicePDF() {
            console.log('üçö Rice Ledger PDF button clicked');
            console.log('Rice Ledger data:', mdmData.riceLedger);
            
            if (!mdmData.riceLedger || mdmData.riceLedger.length === 0) {
                alert('‚ùå No Rice Ledger data found! Please add entries in the Rice Ledger tab first.');
                showAlert('‚ùå No Rice Ledger data found! Please add entries first.', 'error');
                return;
            }
            
            console.log('‚úÖ Rice Ledger data exists, generating PDF...');
            
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            // Build table rows
            let tableRows = '';
            let runningBalance = mdmData.riceOpeningStock || 0;
            let totalReceived = 0, totalConsumed = 0;
            
            mdmData.riceLedger.forEach((entry, idx) => {
                const opening = idx === 0 ? mdmData.riceOpeningStock : runningBalance;
                const received = parseFloat(entry.received || 0);
                const consumed = parseFloat(entry.consumed || 0);
                const closing = opening + received - consumed;
                runningBalance = closing;
                
                totalReceived += received;
                totalConsumed += consumed;
                
                tableRows += `
                    <tr>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${idx + 1}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${entry.date}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000;">${opening.toFixed(2)}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000;">${received.toFixed(2)}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000; font-weight: 600;">${(opening + received).toFixed(2)}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000;">${consumed.toFixed(2)}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000; font-weight: 600; background: #f0f0f0;">${closing.toFixed(2)}</td>
                        <td style="padding: 8px; border: 1px solid #000; font-size: 10px;">${entry.remarks || '-'}</td>
                    </tr>
                `;
            });
            
            const formHTML = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Rice Ledger Report - ${month} ${year}</title>
<style>
    @page { size: A4 landscape; margin: 10mm; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; padding: 15px; font-size: 10px; line-height: 1.4; }
    .header { text-align: center; border: 2px solid #000; padding: 10px; margin-bottom: 12px; background: #f0f0f0; }
    .header h1 { font-size: 14px; color: #000; margin: 4px 0; font-weight: 700; }
    .header p { font-size: 11px; margin: 2px 0; }
    .info-section { margin: 10px 0; font-size: 10px; background: #f9f9f9; padding: 10px; border-left: 3px solid #28a745; }
    .info-section strong { display: inline-block; width: 140px; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 9px; }
    table th { background: #28a745; color: white; font-weight: bold; text-align: center; padding: 7px 4px; border: 1px solid #000; font-size: 9px; }
    table td { border: 1px solid #000; padding: 6px 4px; }
    .total-row { background: #e8f5e9; font-weight: bold; font-size: 10px; }
    .signature { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; margin-top: 35px; text-align: center; }
    .signature-line { border-top: 1px solid #000; padding-top: 6px; margin-top: 30px; font-weight: 600; font-size: 10px; }
    .btn-print { position: fixed; top: 15px; right: 15px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; z-index: 1000; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
    .btn-print:hover { background: #218838; }
    @media print { .btn-print { display: none !important; } body { padding: 0; } }
</style></head>
<body>
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    
    <div class="header">
        <h1>üçö RICE STOCK REGISTER (‡§ö‡§æ‡§µ‡§≤ ‡§≠‡§Ç‡§°‡§æ‡§∞ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞)</h1>
        <p><strong>${mdmData.school.name.toUpperCase()}</strong></p>
        <p>DISE: ${mdmData.school.dise} | Block: ${mdmData.school.block} | District: ${mdmData.school.district}</p>
        <p>Month: ${month} ${year} | Generated: ${currentDate.toLocaleDateString('en-GB')}</p>
    </div>
    
    <div class="info-section">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div><strong>Opening Stock:</strong> ${mdmData.riceOpeningStock?.toFixed(2) || '0.00'} Kg</div>
            <div><strong>Total Received:</strong> ${totalReceived.toFixed(2)} Kg</div>
            <div><strong>Total Consumed:</strong> ${totalConsumed.toFixed(2)} Kg</div>
            <div><strong>Closing Balance:</strong> ${runningBalance.toFixed(2)} Kg</div>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th style="width: 35px;">Sl.<br>No.</th>
                <th style="width: 70px;">Date<br>(‡§§‡§æ‡§∞‡•Ä‡§ñ)</th>
                <th style="width: 70px;">Opening<br>(Kg)<br>(‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï)</th>
                <th style="width: 70px;">Received<br>(Kg)<br>(‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§)</th>
                <th style="width: 70px;">Total<br>(Kg)<br>(‡§ï‡•Å‡§≤)</th>
                <th style="width: 70px;">Consumed<br>(Kg)<br>(‡§ñ‡§∞‡•ç‡§ö)</th>
                <th style="width: 70px;">Closing<br>(Kg)<br>(‡§∂‡•á‡§∑)</th>
                <th>Remarks<br>(‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä)</th>
            </tr>
        </thead>
        <tbody>
            ${tableRows}
            <tr class="total-row">
                <td colspan="3" style="text-align: right; padding: 8px;"><strong>MONTH TOTAL:</strong></td>
                <td style="text-align: right; padding: 8px;"><strong>${totalReceived.toFixed(2)}</strong></td>
                <td></td>
                <td style="text-align: right; padding: 8px;"><strong>${totalConsumed.toFixed(2)}</strong></td>
                <td style="text-align: right; padding: 8px;"><strong>${runningBalance.toFixed(2)}</strong></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    
    <div style="background: #e8f5e9; border-left: 3px solid #28a745; padding: 8px; margin-top: 10px; font-size: 9px;">
        <strong>üìä Rice Summary:</strong> Opening: ${mdmData.riceOpeningStock?.toFixed(2) || '0.00'} Kg + Received: ${totalReceived.toFixed(2)} Kg - Consumed: ${totalConsumed.toFixed(2)} Kg = Closing: ${runningBalance.toFixed(2)} Kg
    </div>
    
    <div class="signature">
        <div>
            <div class="signature-line">MDM In-Charge<br>${mdmData.school.mdmic}</div>
        </div>
        <div>
            <div class="signature-line">Head Teacher<br>${mdmData.school.hoi}</div>
        </div>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, `Rice Ledger Report - ${month} ${year}`);
            showAlert('‚úÖ Rice Ledger Report opened! Click Print to save as PDF.', 'success');
        }
        
        // Generate Bank Ledger PDF Download
        function generateBankPDF() {
            console.log('üè¶ Bank Ledger PDF button clicked');
            console.log('Bank Ledger data:', mdmData.bankLedger);
            
            if (!mdmData.bankLedger || mdmData.bankLedger.length === 0) {
                alert('‚ùå No Bank Ledger data found!\n\nPlease add transactions in the Bank Ledger tab first.\n\nGo to: Dashboard ‚Üí Bank Ledger ‚Üí Add Transaction');
                showAlert('‚ùå No Bank Ledger data found! Please add transactions first.', 'error');
                return;
            }
            
            console.log('‚úÖ Bank Ledger data exists, generating PDF...');
            
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            // Calculate totals
            const openingBalance = parseFloat(mdmData.fundOpening) || 0;
            let totalCredit = 0, totalDebit = 0;
            let runningBalance = openingBalance;
            
            // Build table rows
            let tableRows = '';
            
            // Add opening balance row if exists
            if (openingBalance > 0) {
                tableRows += `
                    <tr style="background: #fffbeb; font-weight: 600;">
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">-</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">-</td>
                        <td style="padding: 8px; border: 1px solid #000; font-size: 9px;"><strong>Opening Balance (B/F)</strong></td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000;">-</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000;">-</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000; font-weight: 600; background: #fef3c7;">${runningBalance >= 0 ? '‚Çπ' + runningBalance.toFixed(2) + ' Cr' : '‚Çπ' + Math.abs(runningBalance).toFixed(2) + ' Dr'}</td>
                        <td style="padding: 8px; border: 1px solid #000; font-size: 9px;">Balance from previous month</td>
                    </tr>
                `;
            }
            
            mdmData.bankLedger.forEach((entry, idx) => {
                const credit = parseFloat(entry.credit || 0);
                const debit = parseFloat(entry.debit || 0);
                runningBalance = runningBalance + credit - debit;
                
                totalCredit += credit;
                totalDebit += debit;
                
                tableRows += `
                    <tr>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${idx + 1}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${entry.date}</td>
                        <td style="padding: 8px; border: 1px solid #000; font-size: 9px;">${entry.particulars || '-'}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000; color: #059669;">${credit > 0 ? '‚Çπ' + credit.toFixed(2) : '-'}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000; color: #dc2626;">${debit > 0 ? '‚Çπ' + debit.toFixed(2) : '-'}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000; font-weight: 600; background: #f9fafb;">${runningBalance >= 0 ? '‚Çπ' + runningBalance.toFixed(2) + ' Cr' : '‚Çπ' + Math.abs(runningBalance).toFixed(2) + ' Dr'}</td>
                        <td style="padding: 8px; border: 1px solid #000; font-size: 9px;">${entry.remarks || '-'}</td>
                    </tr>
                `;
            });
            
            const formHTML = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Bank Ledger - ${month} ${year}</title>
<style>
    @page { size: A4 landscape; margin: 10mm; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; padding: 15px; font-size: 10px; line-height: 1.3; }
    .header { text-align: center; border: 2px solid #000; padding: 10px; margin-bottom: 12px; background: #f0f0f0; }
    .header h1 { font-size: 14px; color: #000; margin: 4px 0; font-weight: 700; }
    .header p { font-size: 11px; margin: 2px 0; }
    .info-section { margin: 8px 0; font-size: 10px; background: #fffbeb; padding: 10px; border-left: 3px solid #f59e0b; }
    .info-section strong { display: inline-block; width: 140px; }
    table { width: 100%; border-collapse: collapse; margin: 8px 0; font-size: 9px; }
    table th { background: #f59e0b; color: white; font-weight: bold; text-align: center; padding: 7px 4px; border: 1px solid #000; font-size: 9px; }
    table td { border: 1px solid #000; padding: 6px 4px; }
    .total-row { background: #fef3c7; font-weight: bold; font-size: 10px; }
    .signature { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; margin-top: 35px; text-align: center; }
    .signature-line { border-top: 1px solid #000; padding-top: 6px; margin-top: 30px; font-weight: 600; font-size: 10px; }
    .btn-print { position: fixed; top: 15px; right: 15px; padding: 10px 20px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; z-index: 1000; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
    .btn-print:hover { background: #d97706; }
    @media print { .btn-print { display: none !important; } body { padding: 0; } }
</style></head>
<body>
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    
    <div class="header">
        <h1>üè¶ BANK LEDGER / CASH BOOK (‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï ‡¶ñ‡¶§‡¶ø‡¶Ø‡¶º‡¶æ‡¶®)</h1>
        <p><strong>${mdmData.school.name.toUpperCase()}</strong></p>
        <p>DISE: ${mdmData.school.dise} | Block: ${mdmData.school.block} | District: ${mdmData.school.district}</p>
        <p>Month: ${month} ${year} | Generated: ${currentDate.toLocaleDateString('en-GB')}</p>
    </div>
    
    <div class="info-section">
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
            <div><strong>Bank:</strong> ${mdmData.bank?.branch || 'N/A'}</div>
            <div><strong>Account:</strong> ${mdmData.bank?.accountNumber || 'N/A'}</div>
            <div><strong>IFSC:</strong> ${mdmData.bank?.ifsc || 'N/A'}</div>
            <div style="color: #2563eb;"><strong>Opening Balance:</strong> ‚Çπ${openingBalance.toFixed(2)}</div>
            <div style="color: #059669;"><strong>Total Credit (Dr):</strong> ‚Çπ${totalCredit.toFixed(2)}</div>
            <div style="color: #dc2626;"><strong>Total Debit (Cr):</strong> ‚Çπ${totalDebit.toFixed(2)}</div>
            <div style="font-weight: 700; color: #7c3aed;"><strong>Closing Balance:</strong> ${runningBalance >= 0 ? '‚Çπ' + runningBalance.toFixed(2) + ' Cr' : '‚Çπ' + Math.abs(runningBalance).toFixed(2) + ' Dr'}</div>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th style="width: 35px;">Sl.<br>No.</th>
                <th style="width: 70px;">Date<br>(‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ)</th>
                <th style="width: 180px;">Particulars<br>(‡¶¨‡¶ø‡¶¨‡¶∞‡¶£)</th>
                <th style="width: 80px;">Credit/Receipt<br>(Dr) ‚Çπ<br>(‡¶ú‡¶Æ‡¶æ)</th>
                <th style="width: 80px;">Debit/Payment<br>(Cr) ‚Çπ<br>(‡¶ñ‡¶∞‡¶ö)</th>
                <th style="width: 90px;">Balance<br>‚Çπ<br>(‡¶ú‡ßá‡¶∞)</th>
                <th>Remarks<br>(‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø)</th>
            </tr>
        </thead>
        <tbody>
            ${tableRows}
            <tr class="total-row">
                <td colspan="3" style="text-align: right; padding: 8px;"><strong>MONTH TOTAL:</strong></td>
                <td style="text-align: right; padding: 8px; color: #059669;"><strong>‚Çπ${totalCredit.toFixed(2)}</strong></td>
                <td style="text-align: right; padding: 8px; color: #dc2626;"><strong>‚Çπ${totalDebit.toFixed(2)}</strong></td>
                <td style="text-align: right; padding: 8px;"><strong>${runningBalance >= 0 ? '‚Çπ' + runningBalance.toFixed(2) + ' Cr' : '‚Çπ' + Math.abs(runningBalance).toFixed(2) + ' Dr'}</strong></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    
    <div style="background: #fef3c7; border-left: 3px solid #f59e0b; padding: 8px; margin-top: 10px; font-size: 9px;">
        <strong>üìä Financial Summary:</strong> Total Receipts: ‚Çπ${totalCredit.toFixed(2)} | Total Payments: ‚Çπ${totalDebit.toFixed(2)} | Net Balance: ${runningBalance >= 0 ? '‚Çπ' + runningBalance.toFixed(2) + ' (Credit)' : '‚Çπ' + Math.abs(runningBalance).toFixed(2) + ' (Debit)'}
    </div>
    
    <div class="signature">
        <div>
            <div class="signature-line">MDM In-Charge<br>${mdmData.school.mdmic}</div>
        </div>
        <div>
            <div class="signature-line">Head Teacher<br>${mdmData.school.hoi}</div>
        </div>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, `Bank Ledger - ${month} ${year}`);
            showAlert('‚úÖ Bank Ledger Report opened! Click Print to save as PDF.', 'success');
        }
        
        // Generate Expense Ledger PDF Download
        function generateExpensePDF() {
            console.log('üí∞ Expense Ledger PDF button clicked');
            console.log('Expense Ledger data:', mdmData.expenseLedger);
            
            if (!mdmData.expenseLedger || mdmData.expenseLedger.length === 0) {
                alert('‚ùå No Expense Ledger data found!\n\nPlease add expenses in the Expense Ledger tab first.\n\nGo to: Dashboard ‚Üí Expense Ledger ‚Üí Add Expense');
                showAlert('‚ùå No Expense Ledger data found! Please add expenses first.', 'error');
                return;
            }
            
            console.log('‚úÖ Expense Ledger data exists, generating PDF...');
            
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            // Calculate totals by category
            const categoryTotals = {};
            let grandTotal = 0;
            
            // Build table rows
            let tableRows = '';
            mdmData.expenseLedger.forEach((entry, idx) => {
                const amount = parseFloat(entry.amount || 0);
                const category = entry.category || 'Other';
                
                categoryTotals[category] = (categoryTotals[category] || 0) + amount;
                grandTotal += amount;
                
                tableRows += `
                    <tr>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${idx + 1}</td>
                        <td style="text-align: center; padding: 8px; border: 1px solid #000;">${entry.date}</td>
                        <td style="padding: 8px; border: 1px solid #000;">${category}</td>
                        <td style="padding: 8px; border: 1px solid #000; font-size: 9px;">${entry.particulars || '-'}</td>
                        <td style="text-align: right; padding: 8px; border: 1px solid #000; font-weight: 600;">‚Çπ${amount.toFixed(2)}</td>
                        <td style="padding: 8px; border: 1px solid #000; font-size: 9px;">${entry.remarks || '-'}</td>
                    </tr>
                `;
            });
            
            // Create category breakdown
            let categoryBreakdown = '';
            Object.entries(categoryTotals).sort((a, b) => b[1] - a[1]).forEach(([cat, amt]) => {
                const percentage = ((amt / grandTotal) * 100).toFixed(1);
                categoryBreakdown += `<div style="margin: 4px 0;"><strong>${cat}:</strong> ‚Çπ${amt.toFixed(2)} (${percentage}%)</div>`;
            });
            
            const formHTML = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Expense Ledger - ${month} ${year}</title>
<style>
    @page { size: A4 landscape; margin: 10mm; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; padding: 15px; font-size: 10px; line-height: 1.3; }
    .header { text-align: center; border: 2px solid #000; padding: 10px; margin-bottom: 12px; background: #f0f0f0; }
    .header h1 { font-size: 14px; color: #000; margin: 4px 0; font-weight: 700; }
    .header p { font-size: 11px; margin: 2px 0; }
    .info-section { margin: 8px 0; font-size: 9px; background: #fee2e2; padding: 10px; border-left: 3px solid #dc2626; }
    table { width: 100%; border-collapse: collapse; margin: 8px 0; font-size: 9px; }
    table th { background: #dc2626; color: white; font-weight: bold; text-align: center; padding: 7px 4px; border: 1px solid #000; font-size: 9px; }
    table td { border: 1px solid #000; padding: 6px 4px; }
    .total-row { background: #fecaca; font-weight: bold; font-size: 10px; }
    .signature { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; margin-top: 35px; text-align: center; }
    .signature-line { border-top: 1px solid #000; padding-top: 6px; margin-top: 30px; font-weight: 600; font-size: 10px; }
    .btn-print { position: fixed; top: 15px; right: 15px; padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; z-index: 1000; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
    .btn-print:hover { background: #b91c1c; }
    @media print { .btn-print { display: none !important; } body { padding: 0; } }
</style></head>
<body>
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    
    <div class="header">
        <h1>üí∞ EXPENSE LEDGER (‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º ‡¶ñ‡¶§‡¶ø‡¶Ø‡¶º‡¶æ‡¶®)</h1>
        <p><strong>${mdmData.school.name.toUpperCase()}</strong></p>
        <p>DISE: ${mdmData.school.dise} | Block: ${mdmData.school.block} | District: ${mdmData.school.district}</p>
        <p>Month: ${month} ${year} | Generated: ${currentDate.toLocaleDateString('en-GB')}</p>
    </div>
    
    <div class="info-section">
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px;">
            <div style="border-right: 2px solid #dc2626; padding-right: 15px;">
                <div style="font-weight: 700; margin-bottom: 5px; font-size: 10px;">Total Expenses:</div>
                <div style="font-size: 16px; font-weight: 700; color: #dc2626;">‚Çπ${grandTotal.toFixed(2)}</div>
                <div style="margin-top: 5px; color: #666;">Total Entries: ${mdmData.expenseLedger.length}</div>
            </div>
            <div>
                <div style="font-weight: 700; margin-bottom: 5px; font-size: 10px;">Category-wise Breakdown:</div>
                ${categoryBreakdown}
            </div>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th style="width: 35px;">Sl.<br>No.</th>
                <th style="width: 70px;">Date<br>(‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ)</th>
                <th style="width: 100px;">Category<br>(‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ)</th>
                <th>Particulars<br>(‡¶¨‡¶ø‡¶¨‡¶∞‡¶£)</th>
                <th style="width: 80px;">Amount<br>‚Çπ<br>(‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£)</th>
                <th style="width: 120px;">Remarks<br>(‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø)</th>
            </tr>
        </thead>
        <tbody>
            ${tableRows}
            <tr class="total-row">
                <td colspan="4" style="text-align: right; padding: 8px;"><strong>TOTAL EXPENSES:</strong></td>
                <td style="text-align: right; padding: 8px;"><strong>‚Çπ${grandTotal.toFixed(2)}</strong></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    
    <div style="background: #fecaca; border-left: 3px solid #dc2626; padding: 8px; margin-top: 10px; font-size: 9px;">
        <strong>üí° Expense Summary:</strong> Total ${mdmData.expenseLedger.length} transactions recorded with total expenditure of ‚Çπ${grandTotal.toFixed(2)} across ${Object.keys(categoryTotals).length} categories.
    </div>
    
    <div class="signature">
        <div>
            <div class="signature-line">MDM In-Charge<br>${mdmData.school.mdmic}</div>
        </div>
        <div>
            <div class="signature-line">Head Teacher<br>${mdmData.school.hoi}</div>
        </div>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, `Expense Ledger - ${month} ${year}`);
            showAlert('‚úÖ Expense Ledger Report opened! Click Print to save as PDF.', 'success');
        }
        
        // Generate Monthly Summary PDF Download
        function generateMonthlySummaryPDF() {
            console.log('üìä Monthly Summary PDF button clicked');
            console.log('Available data:', {
                formC: mdmData.formC?.length || 0,
                bankLedger: mdmData.bankLedger?.length || 0,
                expenseLedger: mdmData.expenseLedger?.length || 0,
                cooks: mdmData.cooks?.length || 0
            });
            
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            // Calculate Form-C totals
            let totalMeals = 0, totalRice = 0, totalCost = 0, workingDays = 0;
            if (mdmData.formC && mdmData.formC.length > 0) {
                workingDays = mdmData.formC.length;
                mdmData.formC.forEach(entry => {
                    const mt = (parseInt(entry.mtV || 0) + parseInt(entry.mtVI || 0) + 
                               parseInt(entry.mtVII || 0) + parseInt(entry.mtVIII || 0));
                    totalMeals += mt;
                    
                    const rice = ((parseInt(entry.mtV || 0) * mdmData.rice.V) + 
                                 (parseInt(entry.mtVI || 0) * mdmData.rice.VI) + 
                                 (parseInt(entry.mtVII || 0) * mdmData.rice.VII) + 
                                 (parseInt(entry.mtVIII || 0) * mdmData.rice.VIII)) / 1000;
                    totalRice += rice;
                    
                    const cost = (parseInt(entry.mtV || 0) * mdmData.cost.V) + 
                                (parseInt(entry.mtVI || 0) * mdmData.cost.VI) + 
                                (parseInt(entry.mtVII || 0) * mdmData.cost.VII) + 
                                (parseInt(entry.mtVIII || 0) * mdmData.cost.VIII);
                    totalCost += cost;
                });
            }
            
            // Calculate enrollment
            const totalEnrollment = (mdmData.enrollment.V || 0) + (mdmData.enrollment.VI || 0) + 
                                   (mdmData.enrollment.VII || 0) + (mdmData.enrollment.VIII || 0);
            
            // Calculate attendance percentage
            const avgAttendance = totalEnrollment > 0 && workingDays > 0 
                ? ((totalMeals / (totalEnrollment * workingDays)) * 100).toFixed(1) 
                : 0;
            
            // Calculate bank totals
            let bankCredit = 0, bankDebit = 0;
            if (mdmData.bankLedger && mdmData.bankLedger.length > 0) {
                mdmData.bankLedger.forEach(entry => {
                    bankCredit += parseFloat(entry.credit || 0);
                    bankDebit += parseFloat(entry.debit || 0);
                });
            }
            const bankBalance = bankCredit - bankDebit;
            
            // Calculate expenses
            let totalExpenses = 0;
            if (mdmData.expenseLedger && mdmData.expenseLedger.length > 0) {
                mdmData.expenseLedger.forEach(entry => {
                    totalExpenses += parseFloat(entry.amount || 0);
                });
            }
            
            // Cook details
            const totalCooks = mdmData.cooks?.length || 0;
            const totalCookWages = mdmData.cooks?.reduce((sum, cook) => sum + (parseFloat(cook.amount) || 0), 0) || 0;
            
            const formHTML = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Monthly Summary - ${month} ${year}</title>
<style>
    @page { size: A4 portrait; margin: 10mm; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; padding: 15px; font-size: 10px; line-height: 1.4; }
    .header { text-align: center; border: 2px solid #000; padding: 10px; margin-bottom: 12px; background: #f0f0f0; }
    .header h1 { font-size: 14px; color: #000; margin: 4px 0; font-weight: 700; }
    .header p { font-size: 11px; margin: 2px 0; }
    .section { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; }
    .section-title { font-size: 11px; font-weight: 700; color: #0066cc; margin-bottom: 8px; border-bottom: 2px solid #0066cc; padding-bottom: 3px; }
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
    .stat-box { background: white; border: 1px solid #ddd; padding: 8px; border-radius: 4px; }
    .stat-label { font-size: 9px; color: #666; margin-bottom: 3px; }
    .stat-value { font-size: 13px; font-weight: 700; color: #000; }
    .highlight-box { background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%); border: 2px solid #0066cc; padding: 12px; margin: 10px 0; border-radius: 6px; text-align: center; }
    .highlight-title { font-size: 10px; color: #0066cc; font-weight: 600; margin-bottom: 5px; }
    .highlight-value { font-size: 18px; font-weight: 700; color: #0066cc; }
    table { width: 100%; border-collapse: collapse; margin: 8px 0; font-size: 9px; }
    table th { background: #0066cc; color: white; padding: 6px 4px; border: 1px solid #000; font-size: 9px; }
    table td { border: 1px solid #ddd; padding: 5px 4px; text-align: center; }
    .signature { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 30px; text-align: center; }
    .signature-line { border-top: 1px solid #000; padding-top: 6px; margin-top: 25px; font-weight: 600; font-size: 10px; }
    .btn-print { position: fixed; top: 15px; right: 15px; padding: 10px 20px; background: #0066cc; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; z-index: 1000; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
    .btn-print:hover { background: #0052a3; }
    @media print { .btn-print { display: none !important; } body { padding: 0; } }
</style></head>
<body>
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    
    <div class="header">
        <h1>üìä MONTHLY SUMMARY REPORT (‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™)</h1>
        <p><strong>${mdmData.school.name.toUpperCase()}</strong></p>
        <p>DISE: ${mdmData.school.dise} | Block: ${mdmData.school.block} | District: ${mdmData.school.district}</p>
        <p>Month: ${month} ${year} | Generated: ${currentDate.toLocaleDateString('en-GB')}</p>
    </div>
    
    <div class="highlight-box">
        <div class="highlight-title">üìà OVERALL ATTENDANCE RATE</div>
        <div class="highlight-value">${avgAttendance}%</div>
        <div style="font-size: 9px; color: #666; margin-top: 5px;">${totalMeals} meals served over ${workingDays} working days</div>
    </div>
    
    <div class="section">
        <div class="section-title">üë• ENROLLMENT SUMMARY</div>
        <table>
            <tr>
                <th>Class V</th>
                <th>Class VI</th>
                <th>Class VII</th>
                <th>Class VIII</th>
                <th>TOTAL</th>
            </tr>
            <tr>
                <td style="font-weight: 600;">${mdmData.enrollment.V || 0}</td>
                <td style="font-weight: 600;">${mdmData.enrollment.VI || 0}</td>
                <td style="font-weight: 600;">${mdmData.enrollment.VII || 0}</td>
                <td style="font-weight: 600;">${mdmData.enrollment.VIII || 0}</td>
                <td style="font-weight: 700; background: #e0f2fe;">${totalEnrollment}</td>
            </tr>
        </table>
    </div>
    
    <div class="section">
        <div class="section-title">üçö MEAL & RICE STATISTICS</div>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">Total Meals Served</div>
                <div class="stat-value" style="color: #059669;">${totalMeals}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Working Days</div>
                <div class="stat-value" style="color: #0066cc;">${workingDays}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Rice Consumed (Kg)</div>
                <div class="stat-value" style="color: #dc2626;">${totalRice.toFixed(2)}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Avg Meals/Day</div>
                <div class="stat-value" style="color: #7c3aed;">${workingDays > 0 ? (totalMeals / workingDays).toFixed(0) : 0}</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <div class="section-title">üí∞ FINANCIAL SUMMARY</div>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">Food Cost</div>
                <div class="stat-value" style="color: #059669;">‚Çπ${totalCost.toFixed(2)}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Cook Wages (${totalCooks} cooks)</div>
                <div class="stat-value" style="color: #f59e0b;">‚Çπ${totalCookWages.toFixed(2)}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Bank Receipts</div>
                <div class="stat-value" style="color: #059669;">‚Çπ${bankCredit.toFixed(2)}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Bank Payments</div>
                <div class="stat-value" style="color: #dc2626;">‚Çπ${bankDebit.toFixed(2)}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total Expenses</div>
                <div class="stat-value" style="color: #dc2626;">‚Çπ${totalExpenses.toFixed(2)}</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Bank Balance</div>
                <div class="stat-value" style="color: ${bankBalance >= 0 ? '#059669' : '#dc2626'};">${bankBalance >= 0 ? '‚Çπ' + bankBalance.toFixed(2) : '-‚Çπ' + Math.abs(bankBalance).toFixed(2)}</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <div class="section-title">üçö RICE ALLOCATION (gm per student)</div>
        <table>
            <tr>
                <th>Class V</th>
                <th>Class VI</th>
                <th>Class VII</th>
                <th>Class VIII</th>
            </tr>
            <tr>
                <td style="font-weight: 600;">${mdmData.rice.V}g</td>
                <td style="font-weight: 600;">${mdmData.rice.VI}g</td>
                <td style="font-weight: 600;">${mdmData.rice.VII}g</td>
                <td style="font-weight: 600;">${mdmData.rice.VIII}g</td>
            </tr>
        </table>
    </div>
    
    <div class="section">
        <div class="section-title">üíµ COOKING COST PER STUDENT (‚Çπ)</div>
        <table>
            <tr>
                <th>Class V</th>
                <th>Class VI</th>
                <th>Class VII</th>
                <th>Class VIII</th>
            </tr>
            <tr>
                <td style="font-weight: 600;">‚Çπ${mdmData.cost.V}</td>
                <td style="font-weight: 600;">‚Çπ${mdmData.cost.VI}</td>
                <td style="font-weight: 600;">‚Çπ${mdmData.cost.VII}</td>
                <td style="font-weight: 600;">‚Çπ${mdmData.cost.VIII}</td>
            </tr>
        </table>
    </div>
    
    <div style="background: #dbeafe; border-left: 3px solid #0066cc; padding: 8px; margin-top: 10px; font-size: 9px;">
        <strong>üìå Summary:</strong> ${totalMeals} meals served to students over ${workingDays} working days with ${avgAttendance}% attendance rate. 
        Total expenditure: ‚Çπ${(totalCost + totalCookWages).toFixed(2)} (Food: ‚Çπ${totalCost.toFixed(2)} + Cook Wages: ‚Çπ${totalCookWages.toFixed(2)})
    </div>
    
    <div class="signature">
        <div>
            <div class="signature-line">MDM In-Charge<br>${mdmData.school.mdmic}</div>
        </div>
        <div>
            <div class="signature-line">Head Teacher<br>${mdmData.school.hoi}</div>
        </div>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, `Monthly Summary - ${month} ${year}`);
            showAlert('‚úÖ Monthly Summary Report opened! Click Print to save as PDF.', 'success');
        }
        
        // Generate Staff Details PDF Download
        function generateStaffPDF() {
            const date = new Date().toLocaleDateString('en-GB');
            const filename = `Staff_Details_${new Date().toISOString().split('T')[0]}.pdf`;
            
            const staffHTML = `
                <div style="padding: 10px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h1 style="margin: 5px 0; color: #003d7a;">üë• STAFF DETAILS REPORT</h1>
                        <p style="margin: 3px 0; font-weight: bold;">${mdmData.school.name}</p>
                        <p style="margin: 3px 0; font-size: 12px;">${mdmData.school.location}</p>
                        <p style="margin: 3px 0; font-size: 11px;">Generated: ${date}</p>
                    </div>
                    
                    <h3 style="color: #003d7a; margin-top: 15px; border-bottom: 2px solid #003d7a; padding-bottom: 5px;">üìã ADMINISTRATIVE STAFF</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                        <tr style="background-color: #e0e7ff;">
                            <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold; width: 40%;">Position</td>
                            <td style="border: 1px solid #ddd; padding: 8px; font-weight: bold;">Name</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">Head of Institution (HOI)</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">${mdmData.school.hoi}</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 8px;">MDM Incharge</td>
                            <td style="border: 1px solid #ddd; padding: 8px;">${mdmData.school.mdmic}</td>
                        </tr>
                    </table>
                    
                    <h3 style="color: #003d7a; margin-top: 20px; border-bottom: 2px solid #003d7a; padding-bottom: 5px;">üë®‚Äçüç≥ COOK DETAILS</h3>
                    <p style="font-size: 12px; color: #666; margin: 10px 0;">Cook information from the management system</p>
                </div>
            `;
            
            const opt = {
                margin: 10,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            
            html2pdf().set(opt).from(staffHTML).save();
            showAlert('‚úÖ Staff Details PDF downloaded successfully!', 'success');
        }
        
        // ========== NEW EXTERNAL PDF REPORTS (AUTO-FETCH FROM FORM C & MASTER DATA) ==========
        
        // 1. Generate Daily Attendance Register PDF
        function generateAttendancePDF() {
            const date = new Date().toLocaleDateString('en-GB');
            const filename = `Daily_Attendance_Register_${new Date().toISOString().split('T')[0]}.pdf`;
            
            // Auto-fetch latest Form C data
            let attendanceRows = '';
            if (mdmData.formC && mdmData.formC.length > 0) {
                mdmData.formC.slice(-10).forEach((entry, idx) => {
                    const totalPresent = parseInt(entry.mtV || 0) + parseInt(entry.mtVI || 0) + 
                                       parseInt(entry.mtVII || 0) + parseInt(entry.mtVIII || 0);
                    const totalEnrollment = mdmData.enrollment.V + mdmData.enrollment.VI + 
                                          mdmData.enrollment.VII + mdmData.enrollment.VIII;
                    const percentage = ((totalPresent / totalEnrollment) * 100).toFixed(1);
                    
                    attendanceRows += `
                        <tr style="${idx % 2 === 0 ? 'background-color: #f9f9f9;' : ''}">
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.date || 'N/A'}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.mtV || 0}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.mtVI || 0}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.mtVII || 0}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.mtVIII || 0}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${totalPresent}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; color: ${percentage >= 85 ? '#4caf50' : '#ff5722'};">${percentage}%</td>
                        </tr>
                    `;
                });
            } else {
                attendanceRows = '<tr><td colspan="7" style="border: 1px solid #ddd; padding: 15px; text-align: center; color: #999;">No Form-C data available</td></tr>';
            }
            
            const attendanceHTML = `
                <div style="padding: 10px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #ff5722; padding-bottom: 10px;">
                        <h1 style="margin: 5px 0; color: #ff5722;">üìÖ DAILY ATTENDANCE REGISTER</h1>
                        <p style="margin: 3px 0; font-weight: bold; font-size: 14px;">${mdmData.school.name}</p>
                        <p style="margin: 3px 0; font-size: 12px;">${mdmData.school.location} ‚Ä¢ Block: ${mdmData.school.block}</p>
                        <p style="margin: 3px 0; font-size: 11px;">DISE: ${mdmData.school.dise} ‚Ä¢ Generated: ${date}</p>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                        <h3 style="color: #ff5722; margin: 5px 0;">üìä Enrollment Summary</h3>
                        <p style="margin: 3px 0; font-size: 12px;"><strong>Class V:</strong> ${mdmData.enrollment.V} | <strong>Class VI:</strong> ${mdmData.enrollment.VI} | <strong>Class VII:</strong> ${mdmData.enrollment.VII} | <strong>Class VIII:</strong> ${mdmData.enrollment.VIII}</p>
                        <p style="margin: 3px 0; font-size: 12px;"><strong>Total Enrollment:</strong> ${mdmData.enrollment.V + mdmData.enrollment.VI + mdmData.enrollment.VII + mdmData.enrollment.VIII} students</p>
                    </div>
                    
                    <h3 style="color: #ff5722; margin-top: 15px; border-bottom: 2px solid #ff5722; padding-bottom: 5px;">üìã Attendance Records (Recent)</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                        <tr style="background-color: #ff5722; color: white;">
                            <th style="border: 1px solid #ddd; padding: 10px;">Date</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Class V</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Class VI</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Class VII</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Class VIII</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Total</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">%</th>
                        </tr>
                        ${attendanceRows}
                    </table>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-left: 4px solid #ff5722;">
                        <p style="margin: 3px 0; font-size: 11px; color: #666;"><strong>Note:</strong> Data auto-fetched from Form-C entries. Attendance percentage calculated based on total enrollment.</p>
                    </div>
                </div>
            `;
            
            const opt = {
                margin: 10,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            
            html2pdf().set(opt).from(attendanceHTML).save();
            showAlert('‚úÖ Daily Attendance Register PDF downloaded successfully!', 'success');
        }
        
        // 2. Generate Monthly Utilization Certificate PDF
        function generateUCPDF() {
            const date = new Date().toLocaleDateString('en-GB');
            const month = new Date().toLocaleDateString('en-GB', { month: 'long', year: 'numeric' });
            const filename = `Monthly_UC_${new Date().toISOString().split('T')[0]}.pdf`;
            
            // Auto-calculate totals from Form C
            let totalDays = mdmData.formC.length;
            let totalStudents = mdmData.enrollment.V + mdmData.enrollment.VI + mdmData.enrollment.VII + mdmData.enrollment.VIII;
            let totalRiceUsed = 0;
            let totalExpenditure = 0;
            
            mdmData.formC.forEach(entry => {
                const presentTotal = parseInt(entry.mtV || 0) + parseInt(entry.mtVI || 0) + 
                                   parseInt(entry.mtVII || 0) + parseInt(entry.mtVIII || 0);
                totalRiceUsed += (presentTotal * 100) / 1000; // 100g per meal, convert to KG
                
                // Calculate cost per meal per student
                const costV = parseInt(entry.mtV || 0) * mdmData.cost.V;
                const costVI = parseInt(entry.mtVI || 0) * mdmData.cost.VI;
                const costVII = parseInt(entry.mtVII || 0) * mdmData.cost.VII;
                const costVIII = parseInt(entry.mtVIII || 0) * mdmData.cost.VIII;
                totalExpenditure += costV + costVI + costVII + costVIII;
            });
            
            const ucHTML = `
                <div style="padding: 10px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; margin-bottom: 20px; border: 3px solid #4caf50; padding: 15px;">
                        <h1 style="margin: 5px 0; color: #4caf50;">üìú MONTHLY UTILIZATION CERTIFICATE</h1>
                        <h2 style="margin: 5px 0; color: #333; font-size: 16px;">MID-DAY MEAL SCHEME</h2>
                        <p style="margin: 3px 0; font-weight: bold; font-size: 14px;">${mdmData.school.name}</p>
                        <p style="margin: 3px 0; font-size: 12px;">${mdmData.school.location}</p>
                        <p style="margin: 3px 0; font-size: 11px;">Block: ${mdmData.school.block} ‚Ä¢ DISE: ${mdmData.school.dise}</p>
                    </div>
                    
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h3 style="color: #4caf50; margin: 5px 0 10px 0;">üìä CERTIFICATE DETAILS</h3>
                        <p style="margin: 5px 0; font-size: 13px;"><strong>Month & Year:</strong> ${month}</p>
                        <p style="margin: 5px 0; font-size: 13px;"><strong>Certificate Date:</strong> ${date}</p>
                        <p style="margin: 5px 0; font-size: 13px;"><strong>HOI Name:</strong> ${mdmData.school.hoi}</p>
                        <p style="margin: 5px 0; font-size: 13px;"><strong>MDM Incharge:</strong> ${mdmData.school.mdmic}</p>
                    </div>
                    
                    <h3 style="color: #4caf50; border-bottom: 2px solid #4caf50; padding-bottom: 5px;">üìã UTILIZATION SUMMARY (Auto-Calculated)</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <tr style="background-color: #4caf50; color: white;">
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Particulars</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: right;">Details</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;">Total Working Days</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right; font-weight: bold;">${totalDays} days</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 10px;">Total Enrolled Students</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right; font-weight: bold;">${totalStudents}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;">Total Rice Utilized</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right; font-weight: bold;">${totalRiceUsed.toFixed(2)} KG</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 10px;">Total Expenditure</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right; font-weight: bold; color: #4caf50;">‚Çπ ${totalExpenditure.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;">Fund Allocated (Class V)</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">‚Çπ ${mdmData.cost.V} per meal</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 10px;">Fund Allocated (Class VI-VIII)</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">‚Çπ ${mdmData.cost.VI} per meal</td>
                        </tr>
                    </table>
                    
                    <div style="border: 2px solid #4caf50; padding: 15px; margin-top: 20px;">
                        <h3 style="color: #4caf50; margin: 0 0 10px 0;">‚úÖ CERTIFICATION</h3>
                        <p style="margin: 5px 0; font-size: 12px; line-height: 1.6;">I hereby certify that the funds received under the Mid-Day Meal Scheme have been utilized for the intended purpose during the month of <strong>${month}</strong>. All records and vouchers are maintained properly and are available for inspection.</p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                        <div style="text-align: center;">
                            <div style="border-top: 1px solid #333; width: 150px; margin-top: 40px;"></div>
                            <p style="margin: 5px 0; font-size: 11px; font-weight: bold;">MDM Incharge</p>
                            <p style="margin: 0; font-size: 10px;">${mdmData.school.mdmic}</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-top: 1px solid #333; width: 150px; margin-top: 40px;"></div>
                            <p style="margin: 5px 0; font-size: 11px; font-weight: bold;">Head of Institution</p>
                            <p style="margin: 0; font-size: 10px;">${mdmData.school.hoi}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-left: 4px solid #4caf50;">
                        <p style="margin: 3px 0; font-size: 10px; color: #666;"><strong>Auto-Generated Report:</strong> Data auto-fetched from Form-C entries and master data. Generated on ${date}</p>
                    </div>
                </div>
            `;
            
            const opt = {
                margin: 10,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            
            html2pdf().set(opt).from(ucHTML).save();
            showAlert('‚úÖ Monthly Utilization Certificate PDF downloaded successfully!', 'success');
        }
        
        // 3. Generate Stock Register Report PDF
        function generateStockPDF() {
            const date = new Date().toLocaleDateString('en-GB');
            const filename = `Stock_Register_${new Date().toISOString().split('T')[0]}.pdf`;
            
            // Auto-calculate stock from rice ledger
            let openingStock = 0;
            let received = 0;
            let consumed = 0;
            
            if (mdmData.riceLedger && mdmData.riceLedger.length > 0) {
                mdmData.riceLedger.forEach(entry => {
                    received += parseFloat(entry.received || 0);
                    consumed += parseFloat(entry.consumed || 0);
                });
                if (mdmData.riceLedger[0]) {
                    openingStock = parseFloat(mdmData.riceLedger[0].opening || 0);
                }
            }
            
            const closingStock = openingStock + received - consumed;
            
            // Calculate monthly requirements
            const totalEnrollment = mdmData.enrollment.V + mdmData.enrollment.VI + mdmData.enrollment.VII + mdmData.enrollment.VIII;
            const dailyRequirement = (totalEnrollment * 100) / 1000; // 100g per student in KG
            const monthlyRequirement = dailyRequirement * 22; // Assuming 22 working days
            
            let stockRows = '';
            if (mdmData.riceLedger && mdmData.riceLedger.length > 0) {
                mdmData.riceLedger.slice(-10).forEach((entry, idx) => {
                    stockRows += `
                        <tr style="${idx % 2 === 0 ? 'background-color: #f9f9f9;' : ''}">
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.date || 'N/A'}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.opening || 0}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.received || 0}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${entry.consumed || 0}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${entry.closing || 0}</td>
                        </tr>
                    `;
                });
            } else {
                stockRows = '<tr><td colspan="5" style="border: 1px solid #ddd; padding: 15px; text-align: center; color: #999;">No rice ledger data available</td></tr>';
            }
            
            const stockHTML = `
                <div style="padding: 10px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #2196f3; padding-bottom: 10px;">
                        <h1 style="margin: 5px 0; color: #2196f3;">üì¶ STOCK REGISTER REPORT</h1>
                        <p style="margin: 3px 0; font-weight: bold; font-size: 14px;">${mdmData.school.name}</p>
                        <p style="margin: 3px 0; font-size: 12px;">${mdmData.school.location} ‚Ä¢ DISE: ${mdmData.school.dise}</p>
                        <p style="margin: 3px 0; font-size: 11px;">Generated: ${date}</p>
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                        <h3 style="color: #2196f3; margin: 5px 0;">üìä STOCK SUMMARY (Auto-Calculated)</h3>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 5px; font-size: 12px;"><strong>Opening Stock:</strong></td>
                                <td style="padding: 5px; font-size: 12px; text-align: right;">${openingStock.toFixed(2)} KG</td>
                                <td style="padding: 5px; font-size: 12px;"><strong>Total Received:</strong></td>
                                <td style="padding: 5px; font-size: 12px; text-align: right;">${received.toFixed(2)} KG</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; font-size: 12px;"><strong>Total Consumed:</strong></td>
                                <td style="padding: 5px; font-size: 12px; text-align: right;">${consumed.toFixed(2)} KG</td>
                                <td style="padding: 5px; font-size: 12px;"><strong>Closing Stock:</strong></td>
                                <td style="padding: 5px; font-size: 12px; text-align: right; font-weight: bold; color: ${closingStock >= monthlyRequirement ? '#4caf50' : '#ff5722'};">${closingStock.toFixed(2)} KG</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                        <h3 style="color: #ff9800; margin: 5px 0;">üìà REQUIREMENT ANALYSIS</h3>
                        <p style="margin: 3px 0; font-size: 12px;"><strong>Daily Requirement:</strong> ${dailyRequirement.toFixed(2)} KG (${totalEnrollment} students √ó 100g)</p>
                        <p style="margin: 3px 0; font-size: 12px;"><strong>Monthly Requirement:</strong> ${monthlyRequirement.toFixed(2)} KG (22 working days)</p>
                        <p style="margin: 3px 0; font-size: 12px;"><strong>Stock Status:</strong> <span style="color: ${closingStock >= monthlyRequirement ? '#4caf50' : '#ff5722'}; font-weight: bold;">${closingStock >= monthlyRequirement ? 'Sufficient' : 'Need Replenishment'}</span></p>
                    </div>
                    
                    <h3 style="color: #2196f3; margin-top: 15px; border-bottom: 2px solid #2196f3; padding-bottom: 5px;">üìã STOCK MOVEMENT (Recent Transactions)</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                        <tr style="background-color: #2196f3; color: white;">
                            <th style="border: 1px solid #ddd; padding: 10px;">Date</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Opening (KG)</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Received (KG)</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Consumed (KG)</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Closing (KG)</th>
                        </tr>
                        ${stockRows}
                    </table>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-left: 4px solid #2196f3;">
                        <p style="margin: 3px 0; font-size: 11px; color: #666;"><strong>Note:</strong> Stock data auto-fetched from Rice Ledger entries. All figures in KG.</p>
                    </div>
                </div>
            `;
            
            const opt = {
                margin: 10,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            
            html2pdf().set(opt).from(stockHTML).save();
            showAlert('‚úÖ Stock Register Report PDF downloaded successfully!', 'success');
        }
        
        // 4. Generate Student Beneficiary List PDF
        function generateBeneficiaryPDF() {
            const date = new Date().toLocaleDateString('en-GB');
            const filename = `Student_Beneficiary_List_${new Date().toISOString().split('T')[0]}.pdf`;
            
            const totalStudents = mdmData.enrollment.V + mdmData.enrollment.VI + mdmData.enrollment.VII + mdmData.enrollment.VIII;
            
            const beneficiaryHTML = `
                <div style="padding: 10px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; margin-bottom: 20px; border: 3px solid #9c27b0; padding: 15px;">
                        <h1 style="margin: 5px 0; color: #9c27b0;">üìã STUDENT BENEFICIARY LIST</h1>
                        <h2 style="margin: 5px 0; color: #333; font-size: 16px;">MID-DAY MEAL SCHEME</h2>
                        <p style="margin: 3px 0; font-weight: bold; font-size: 14px;">${mdmData.school.name}</p>
                        <p style="margin: 3px 0; font-size: 12px;">${mdmData.school.location}</p>
                        <p style="margin: 3px 0; font-size: 11px;">Block: ${mdmData.school.block} ‚Ä¢ DISE: ${mdmData.school.dise}</p>
                        <p style="margin: 3px 0; font-size: 11px;">Generated: ${date}</p>
                    </div>
                    
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h3 style="color: #9c27b0; margin: 5px 0 10px 0;">üìä BENEFICIARY SUMMARY</h3>
                        <p style="margin: 5px 0; font-size: 13px;"><strong>Total Beneficiaries:</strong> ${totalStudents} students</p>
                        <p style="margin: 5px 0; font-size: 13px;"><strong>Classes Covered:</strong> V, VI, VII, VIII (Upper Primary)</p>
                        <p style="margin: 5px 0; font-size: 13px;"><strong>HOI:</strong> ${mdmData.school.hoi}</p>
                        <p style="margin: 5px 0; font-size: 13px;"><strong>MDM Incharge:</strong> ${mdmData.school.mdmic}</p>
                    </div>
                    
                    <h3 style="color: #9c27b0; border-bottom: 2px solid #9c27b0; padding-bottom: 5px;">üìö CLASS-WISE ENROLLMENT DETAILS</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <tr style="background-color: #9c27b0; color: white;">
                            <th style="border: 1px solid #ddd; padding: 12px;">Class</th>
                            <th style="border: 1px solid #ddd; padding: 12px;">Total Enrolled</th>
                            <th style="border: 1px solid #ddd; padding: 12px;">Rice Allocation (KG/day)</th>
                            <th style="border: 1px solid #ddd; padding: 12px;">Fund per Student</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Class V</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center; font-weight: bold;">${mdmData.enrollment.V}</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">${mdmData.rice.V} g</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">‚Çπ ${mdmData.cost.V}</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Class VI</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center; font-weight: bold;">${mdmData.enrollment.VI}</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">${mdmData.rice.VI} g</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">‚Çπ ${mdmData.cost.VI}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Class VII</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center; font-weight: bold;">${mdmData.enrollment.VII}</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">${mdmData.rice.VII} g</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">‚Çπ ${mdmData.cost.VII}</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Class VIII</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center; font-weight: bold;">${mdmData.enrollment.VIII}</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">${mdmData.rice.VIII} g</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: center;">‚Çπ ${mdmData.cost.VIII}</td>
                        </tr>
                        <tr style="background-color: #9c27b0; color: white;">
                            <td style="border: 1px solid #ddd; padding: 12px; font-weight: bold;">TOTAL</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center; font-weight: bold; font-size: 16px;">${totalStudents}</td>
                            <td style="border: 1px solid #ddd; padding: 12px; text-align: center;" colspan="2">All Students Beneficiary</td>
                        </tr>
                    </table>
                    
                    <div style="background: #fff9e6; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h3 style="color: #ff9800; margin: 5px 0;">üí∞ FINANCIAL ALLOCATION</h3>
                        <p style="margin: 5px 0; font-size: 12px;">Class V allocation: <strong>‚Çπ ${mdmData.cost.V}</strong> per student per meal</p>
                        <p style="margin: 5px 0; font-size: 12px;">Class VI-VIII allocation: <strong>‚Çπ ${mdmData.cost.VI}</strong> per student per meal</p>
                        <p style="margin: 5px 0; font-size: 12px;">Daily fund requirement (approx): <strong>‚Çπ ${(mdmData.enrollment.V * mdmData.cost.V + (mdmData.enrollment.VI + mdmData.enrollment.VII + mdmData.enrollment.VIII) * mdmData.cost.VI).toFixed(2)}</strong></p>
                    </div>
                    
                    <div style="border: 2px solid #9c27b0; padding: 15px; margin-top: 20px;">
                        <h3 style="color: #9c27b0; margin: 0 0 10px 0;">‚úÖ DECLARATION</h3>
                        <p style="margin: 5px 0; font-size: 12px; line-height: 1.6;">This is to certify that the above-mentioned students are enrolled in the school and are beneficiaries of the Mid-Day Meal Scheme. All records are maintained as per government guidelines.</p>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                        <div style="text-align: center;">
                            <div style="border-top: 1px solid #333; width: 150px; margin-top: 40px;"></div>
                            <p style="margin: 5px 0; font-size: 11px; font-weight: bold;">MDM Incharge</p>
                            <p style="margin: 0; font-size: 10px;">${mdmData.school.mdmic}</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-top: 1px solid #333; width: 150px; margin-top: 40px;"></div>
                            <p style="margin: 5px 0; font-size: 11px; font-weight: bold;">Head of Institution</p>
                            <p style="margin: 0; font-size: 10px;">${mdmData.school.hoi}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-left: 4px solid #9c27b0;">
                        <p style="margin: 3px 0; font-size: 10px; color: #666;"><strong>Auto-Generated Report:</strong> Enrollment data fetched from master data. Generated on ${date}</p>
                    </div>
                </div>
            `;
            
            const opt = {
                margin: 10,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            
            html2pdf().set(opt).from(beneficiaryHTML).save();
            showAlert('‚úÖ Student Beneficiary List PDF downloaded successfully!', 'success');
        }
        
        // 5. Generate Monthly Monitoring Report PDF
        function generateMonitoringPDF() {
            const date = new Date().toLocaleDateString('en-GB');
            const month = new Date().toLocaleDateString('en-GB', { month: 'long', year: 'numeric' });
            const filename = `Monthly_Monitoring_Report_${new Date().toISOString().split('T')[0]}.pdf`;
            
            // Auto-calculate comprehensive metrics
            let totalDays = mdmData.formC.length;
            let totalAttendance = 0;
            let totalMealsServed = 0;
            
            mdmData.formC.forEach(entry => {
                const dailyTotal = parseInt(entry.mtV || 0) + parseInt(entry.mtVI || 0) + 
                                 parseInt(entry.mtVII || 0) + parseInt(entry.mtVIII || 0);
                totalAttendance += dailyTotal;
                totalMealsServed += dailyTotal;
            });
            
            const totalEnrollment = mdmData.enrollment.V + mdmData.enrollment.VI + mdmData.enrollment.VII + mdmData.enrollment.VIII;
            const avgAttendance = totalDays > 0 ? (totalAttendance / (totalEnrollment * totalDays) * 100).toFixed(2) : 0;
            
            // Calculate expenditure
            let totalExpenditure = 0;
            mdmData.expenseLedger.forEach(entry => {
                totalExpenditure += parseFloat(entry.amount || 0);
            });
            
            // Calculate rice consumption
            let totalRiceConsumed = 0;
            mdmData.riceLedger.forEach(entry => {
                totalRiceConsumed += parseFloat(entry.consumed || 0);
            });
            
            const monitoringHTML = `
                <div style="padding: 10px; font-family: Arial, sans-serif;">
                    <div style="text-align: center; margin-bottom: 20px; border: 3px solid #ff9800; padding: 15px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);">
                        <h1 style="margin: 5px 0; color: #ff9800;">üìä MONTHLY MONITORING REPORT</h1>
                        <h2 style="margin: 5px 0; color: #333; font-size: 16px;">MID-DAY MEAL SCHEME - COMPREHENSIVE ANALYSIS</h2>
                        <p style="margin: 3px 0; font-weight: bold; font-size: 14px;">${mdmData.school.name}</p>
                        <p style="margin: 3px 0; font-size: 12px;">${mdmData.school.location} ‚Ä¢ Block: ${mdmData.school.block}</p>
                        <p style="margin: 3px 0; font-size: 11px;">DISE: ${mdmData.school.dise} ‚Ä¢ Report Month: ${month}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 5px; border-left: 4px solid #2196f3;">
                            <h4 style="color: #2196f3; margin: 0 0 10px 0;">üë• ENROLLMENT</h4>
                            <p style="margin: 3px 0; font-size: 24px; font-weight: bold; color: #2196f3;">${totalEnrollment}</p>
                            <p style="margin: 0; font-size: 11px; color: #666;">Total Students</p>
                        </div>
                        <div style="background: #f3e5f5; padding: 15px; border-radius: 5px; border-left: 4px solid #9c27b0;">
                            <h4 style="color: #9c27b0; margin: 0 0 10px 0;">üìÖ WORKING DAYS</h4>
                            <p style="margin: 3px 0; font-size: 24px; font-weight: bold; color: #9c27b0;">${totalDays}</p>
                            <p style="margin: 0; font-size: 11px; color: #666;">Days Operated</p>
                        </div>
                        <div style="background: #e8f5e9; padding: 15px; border-radius: 5px; border-left: 4px solid #4caf50;">
                            <h4 style="color: #4caf50; margin: 0 0 10px 0;">üìà ATTENDANCE</h4>
                            <p style="margin: 3px 0; font-size: 24px; font-weight: bold; color: #4caf50;">${avgAttendance}%</p>
                            <p style="margin: 0; font-size: 11px; color: #666;">Average %</p>
                        </div>
                        <div style="background: #fff3e0; padding: 15px; border-radius: 5px; border-left: 4px solid #ff9800;">
                            <h4 style="color: #ff9800; margin: 0 0 10px 0;">üçΩÔ∏è MEALS SERVED</h4>
                            <p style="margin: 3px 0; font-size: 24px; font-weight: bold; color: #ff9800;">${totalMealsServed}</p>
                            <p style="margin: 0; font-size: 11px; color: #666;">Total Meals</p>
                        </div>
                    </div>
                    
                    <h3 style="color: #ff9800; border-bottom: 2px solid #ff9800; padding-bottom: 5px;">üìä CLASS-WISE ENROLLMENT SNAPSHOT</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <tr style="background-color: #ff9800; color: white;">
                            <th style="border: 1px solid #ddd; padding: 10px;">Class</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Enrollment</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">% of Total</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">Class V</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${mdmData.enrollment.V}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${((mdmData.enrollment.V / totalEnrollment) * 100).toFixed(1)}%</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 8px;">Class VI</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${mdmData.enrollment.VI}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${((mdmData.enrollment.VI / totalEnrollment) * 100).toFixed(1)}%</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 8px;">Class VII</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${mdmData.enrollment.VII}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${((mdmData.enrollment.VII / totalEnrollment) * 100).toFixed(1)}%</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 8px;">Class VIII</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${mdmData.enrollment.VIII}</td>
                            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${((mdmData.enrollment.VIII / totalEnrollment) * 100).toFixed(1)}%</td>
                        </tr>
                    </table>
                    
                    <h3 style="color: #ff9800; border-bottom: 2px solid #ff9800; padding-bottom: 5px;">üí∞ FINANCIAL SUMMARY</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <tr style="background-color: #fff3e0;">
                            <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Total Expenditure</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right; font-weight: bold; color: #ff9800; font-size: 16px;">‚Çπ ${totalExpenditure.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;">Class V Fund Rate</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">‚Çπ ${mdmData.cost.V} per meal</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 10px;">Class VI-VIII Fund Rate</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">‚Çπ ${mdmData.cost.VI} per meal</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;">Average Cost per Meal</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">‚Çπ ${totalMealsServed > 0 ? (totalExpenditure / totalMealsServed).toFixed(2) : 0}</td>
                        </tr>
                    </table>
                    
                    <h3 style="color: #ff9800; border-bottom: 2px solid #ff9800; padding-bottom: 5px;">üçö RICE CONSUMPTION</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <tr style="background-color: #fff3e0;">
                            <td style="border: 1px solid #ddd; padding: 10px; font-weight: bold;">Total Rice Consumed</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right; font-weight: bold; color: #ff9800; font-size: 16px;">${totalRiceConsumed.toFixed(2)} KG</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;">Average per Meal</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">${totalMealsServed > 0 ? ((totalRiceConsumed * 1000) / totalMealsServed).toFixed(0) : 0} grams</td>
                        </tr>
                        <tr style="background-color: #f9f9f9;">
                            <td style="border: 1px solid #ddd; padding: 10px;">Daily Average Consumption</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right;">${totalDays > 0 ? (totalRiceConsumed / totalDays).toFixed(2) : 0} KG</td>
                        </tr>
                    </table>
                    
                    <div style="border: 2px solid #4caf50; background: #e8f5e9; padding: 15px; margin-top: 20px; border-radius: 5px;">
                        <h3 style="color: #4caf50; margin: 0 0 10px 0;">‚úÖ MONITORING OBSERVATIONS</h3>
                        <ul style="margin: 5px 0; padding-left: 20px; font-size: 12px; line-height: 1.8;">
                            <li>Attendance rate: ${avgAttendance >= 85 ? '<strong style="color: #4caf50;">EXCELLENT (Above 85%)</strong>' : avgAttendance >= 75 ? '<strong style="color: #ff9800;">GOOD (75-85%)</strong>' : '<strong style="color: #ff5722;">NEEDS IMPROVEMENT (Below 75%)</strong>'}</li>
                            <li>All ${totalMealsServed} meals served during ${totalDays} working days</li>
                            <li>Quality norms as per Government of West Bengal guidelines maintained</li>
                            <li>Regular monitoring by MDM Incharge: ${mdmData.school.mdmic}</li>
                        </ul>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                        <div style="text-align: center;">
                            <div style="border-top: 1px solid #333; width: 150px; margin-top: 40px;"></div>
                            <p style="margin: 5px 0; font-size: 11px; font-weight: bold;">MDM Incharge</p>
                            <p style="margin: 0; font-size: 10px;">${mdmData.school.mdmic}</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-top: 1px solid #333; width: 150px; margin-top: 40px;"></div>
                            <p style="margin: 5px 0; font-size: 11px; font-weight: bold;">Head of Institution</p>
                            <p style="margin: 0; font-size: 10px;">${mdmData.school.hoi}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-left: 4px solid #ff9800;">
                        <p style="margin: 3px 0; font-size: 10px; color: #666;"><strong>Comprehensive Auto-Generated Report:</strong> All data auto-fetched from Form-C, Rice Ledger, Expense Ledger, and Master Data. Generated on ${date}</p>
                    </div>
                </div>
            `;
            
            const opt = {
                margin: 10,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
            };
            
            html2pdf().set(opt).from(monitoringHTML).save();
            showAlert('‚úÖ Monthly Monitoring Report PDF downloaded successfully!', 'success');
        }
        
        // ========== GOVERNMENT FORMS GENERATION (LIVE DATA) ==========
        
        // Function to open government form in new window with live data
        function openGovernmentForm(formHTML, formTitle) {
            // Open preview window
            const newWindow = window.open('', '_blank');
            newWindow.document.write(formHTML);
            newWindow.document.close();
            newWindow.document.title = formTitle;
            
            // Show success message
            showAlert(`‚úÖ ${formTitle} preview opened! PDF is downloading...`, 'success');
            
            // Auto-download PDF after a short delay
            setTimeout(() => {
                // Generate safe filename from title
                const safeFilename = formTitle
                    .replace(/[^a-zA-Z0-9\s\-_()]/g, '')
                    .replace(/\s+/g, '_')
                    .substring(0, 100) + '.pdf';
                
                // Trigger auto-download
                if (typeof autoDownloadPDF === 'function') {
                    autoDownloadPDF(formHTML, safeFilename);
                } else {
                    console.warn('autoDownloadPDF function not found');
                }
            }, 1000);
        }
        
        // 1. Generate Form K - ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Ü‡¶Ø‡¶º ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨
        function generateGovFormK(type = 'UP') {
            const isPrimary = type === 'P';
            const formLabel = isPrimary ? 'FORM K (P)' : 'FORM K (UP)';
            const categoryLabel = isPrimary ? 'Primary (Class V)' : 'Upper Primary (Class VI-VIII)';
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            // Calculate totals from mdmData - FIXED: using correct field names mtV/mtVI
            let totalWorkingDays = mdmData.formC.length;
            let totalMTClassV = 0;  // Total MT for Class V (Primary)
            let totalMTVI_VIII = 0; // Total MT for Class VI-VIII (Upper Primary)
            let totalRiceConsumedP = 0;  // Primary
            let totalRiceConsumedUP = 0; // Upper Primary
            let totalCookingCostP = 0;   // Primary
            let totalCookingCostUP = 0;  // Upper Primary
            
            // Calculate from Form C entries - FIXED field names
            mdmData.formC.forEach(entry => {
                const mtV = parseInt(entry.mtV || 0);
                const mtVI = parseInt(entry.mtVI || 0);
                const mtVII = parseInt(entry.mtVII || 0);
                const mtVIII = parseInt(entry.mtVIII || 0);
                
                totalMTClassV += mtV;
                totalMTVI_VIII += mtVI + mtVII + mtVIII;
                
                // Rice calculation per Excel formula: MT * rice_per_student / 1000
                const riceV = (mtV * mdmData.rice.V) / 1000;
                const riceVI = (mtVI * mdmData.rice.VI) / 1000;
                const riceVII = (mtVII * mdmData.rice.VII) / 1000;
                const riceVIII = (mtVIII * mdmData.rice.VIII) / 1000;
                totalRiceConsumedP += riceV;
                totalRiceConsumedUP += riceVI + riceVII + riceVIII;
                
                // Cost calculation per Excel: MT * cost_per_student
                totalCookingCostP += (mtV * mdmData.cost.V);
                totalCookingCostUP += (mtVI * mdmData.cost.VI) + (mtVII * mdmData.cost.VII) + (mtVIII * mdmData.cost.VIII);
            });
            
            // Select data based on form type
            const totalMealsServed = isPrimary ? totalMTClassV : totalMTVI_VIII;
            const totalRiceConsumed = isPrimary ? totalRiceConsumedP : totalRiceConsumedUP;
            const totalCookingCost = isPrimary ? totalCookingCostP : totalCookingCostUP;
            
            // Calculate Cook Cum Helper wages from Settings (Excel: MDCF!J11 or cooks array)
            const cookCumHelperWages = mdmData.cooks.reduce((sum, cook) => sum + (cook.amount || 0), 0) || 10000;
            
            // Get Rice opening/received from MDCF settings or riceLedger
            const riceOpening = parseFloat(document.getElementById('riceOpeningStock')?.value) || 524.01;
            const riceReceived = parseFloat(document.getElementById('riceReceivedStock')?.value) || 0;
            
            // Rice in quintals (per Excel: divide by 100)
            const riceOpeningQtl = riceOpening / 100;
            const riceReceivedQtl = riceReceived / 100;
            const riceConsumedQtl = totalRiceConsumed / 100;
            const riceClosingQtl = riceOpeningQtl + riceReceivedQtl - riceConsumedQtl;
            
            // Expense breakdown per Excel formula ratios (uses TOTAL food cost, not including cook wages)
            // Excel: W55 = L55+L56 (food cost only)
            const foodExpenseBase = totalCookingCost;
            const vegExpense = (foodExpenseBase / 7) * 2;      // ‡¶∏‡¶¨‡ßç‡¶ú‡¶ø
            const eggExpense = (foodExpenseBase / 7) * 1.75;   // ‡¶°‡¶ø‡¶Æ
            const dalExpense = (foodExpenseBase / 7) * 1.5;    // ‡¶°‡¶æ‡¶≤
            const oilExpense = (foodExpenseBase / 7) * 0.3;    // ‡¶§‡ßá‡¶≤
            const spiceExpense = (foodExpenseBase / 7) * 0.5;  // ‡¶Æ‡¶∂‡¶≤‡¶æ
            const soyaExpense = (foodExpenseBase / 7) * 0.2;   // ‡¶∏‡ßã‡¶Ø‡¶º‡¶æ‡¶¨‡¶ø‡¶®
            const fuelExpense = (foodExpenseBase / 7) * 0.75;  // ‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶®‡¶ø
            
            // Total Expenditure per Excel: W56 = L55+L56+L57 (food cost + cook wages)
            const totalExpenditure = totalCookingCost + cookCumHelperWages;
            
            const formHTML = `<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Form K - ${month} ${year}</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script>
    <style>
        @page { size: A4; margin: 8mm; }
        body { font-family: 'Noto Sans Bengali', Arial; padding: 10px; font-size: 10px; }
        .header { text-align: center; border: 2px solid #000; padding: 8px; margin-bottom: 8px; }
        .header h1 { font-size: 13px; margin: 2px 0; }
        .header h2 { font-size: 11px; margin: 2px 0; }
        .header .note { color: red; font-size: 9px; font-weight: bold; margin-top: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 5px 0; font-size: 9px; }
        table th, table td { border: 1px solid #000; padding: 3px; }
        table th { background: #e0e0e0; font-weight: bold; text-align: center; }
        .total-row { background: #f9f9f9; font-weight: bold; }
        .info-table td { padding: 4px 8px; border: none; font-size: 10px; }
        .info-table .label { width: 45%; }
        .section-title { background: #d0d0d0; padding: 4px; text-align: center; font-weight: bold; border: 1px solid #000; margin: 8px 0 0 0; }
        .btn-download { position: fixed; top: 10px; right: 10px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; z-index: 1000; }
        @media print { .btn-download { display: none !important; } }
    </style>
</head>
<body>
    <button class="btn-download" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    
    <div class="header" style="position: relative; display: flex; align-items: center; gap: 15px;">
        <img src="${mdmLogoDataUrl}" style="width: 60px; height: 60px; object-fit: contain;" alt="MDM Logo">
        <div style="flex: 1; text-align: center;">
            <h1>‡¶¶‡ßç‡¶¨‡¶ø‡¶™‡ßç‡¶∞‡¶æ‡¶π‡¶∞‡¶ø‡¶ï ‡¶Ü‡¶π‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™ (Cooked Mid-Day-Meal Programme)</h1>
            <h2>‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ ‡¶¶‡¶™‡ßç‡¶§‡¶∞ (Programme School Education)</h2>
            <h2>‡¶™‡¶∂‡ßç‡¶ö‡¶ø‡¶Æ‡¶¨‡¶ô‡ßç‡¶ó ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞ (Government of West Bengal)</h2>
            <h1>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶Ü‡¶Ø‡¶º ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Month Wise Utilization)</h1>
            <div class="note"># ‡¶¨‡¶ø. ‡¶¶‡ßç‡¶∞. : ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶ø‡¶≤ ‡¶ú‡¶Æ‡¶æ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§ #</div>
        </div>
        <div style="position: absolute; top: 5px; right: 15px; font-weight: bold;">${formLabel}</div>
    </div>
    
    <table class="info-table" style="border: none;">
        <tr><td class="label"><strong>1. ‡¶Æ‡¶æ‡¶∏ (Month):</strong></td><td>${month}</td><td><strong>2. ‡¶¨‡¶õ‡¶∞ (Year):</strong></td><td>${year}</td></tr>
        <tr><td class="label"><strong>3. ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤ (School):</strong></td><td colspan="3">${mdmData.school.name.toUpperCase()}</td></tr>
        <tr><td class="label"><strong>4. ‡¶ú‡ßá‡¶≤‡¶æ (District):</strong></td><td>${document.getElementById('settingsDistrict')?.value || mdmData.school.district}</td><td><strong>5. ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶™‡¶û‡ßç‡¶ö‡¶æ‡¶Ø‡¶º‡ßá‡¶§ (G.P.):</strong></td><td>${document.getElementById('settingsGPWard')?.value || mdmData.school.gpWard}</td></tr>
        <tr><td class="label"><strong>6. ‡¶¨‡ßç‡¶≤‡¶ï (Block):</strong></td><td>${mdmData.school.block.toUpperCase()}</td><td><strong>7. ‡¶Æ‡¶π‡¶ï‡ßÅ‡¶Æ‡¶æ (Subdivision):</strong></td><td>${document.getElementById('settingsSubdivision')?.value || mdmData.school.subdivision}</td></tr>
        <tr><td class="label"><strong>8. ‡¶ï‡¶§‡¶ú‡¶® ‡¶Æ‡¶ø‡¶°-‡¶°‡ßá-‡¶Æ‡¶ø‡¶≤ ‡¶ñ‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá (MDM Takers):</strong></td><td>${totalMealsServed}</td><td><strong>9. ‡¶°‡¶æ‡¶á‡¶∏ ‡¶ï‡ßã‡¶° (DISE Code):</strong></td><td>${mdmData.school.dise}</td></tr>
        <tr><td class="label"><strong>10. ‡¶∞‡¶æ‡¶®‡ßç‡¶®‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ (No. of cooking days):</strong></td><td colspan="3">${totalWorkingDays}</td></tr>
        <tr><td class="label"><strong>11. ‡¶∏‡ßç‡¶¨‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞ ‡¶¶‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ (SHG's Name):</strong></td><td colspan="3">${document.getElementById('settingsSHGName')?.value || mdmData.school.shgName}</td></tr>
        <tr><td class="label"><strong>12. ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ (Bank Name):</strong></td><td colspan="3">${mdmData.school.bankName}</td></tr>
        <tr><td class="label"><strong>13. ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶è‡¶ï‡¶æ‡¶â‡¶£‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (Bank a/c No.):</strong></td><td colspan="3">${mdmData.school.bankAccountNo}</td></tr>
    </table>
    
    <div class="section-title">‡¶ö‡¶æ‡¶≤‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Food Grain Utilization) (In Quintals)</div>
    <table>
        <tr>
            <th>Category</th>
            <th>Food Item</th>
            <th>Opening Balance</th>
            <th>Received during the month</th>
            <th>Consumption during the month</th>
            <th>Closing Balance</th>
        </tr>
        <tr>
            <td>${categoryLabel}</td>
            <td>Rice</td>
            <td>${isPrimary ? '' : riceOpeningQtl.toFixed(4)}</td>
            <td>${isPrimary ? '' : riceReceivedQtl.toFixed(4)}</td>
            <td>${riceConsumedQtl.toFixed(4)}</td>
            <td>${isPrimary ? '' : riceClosingQtl.toFixed(4)}</td>
        </tr>
    </table>
    
    <div class="section-title">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Other Expenditure)</div>
    <table>
        <tr><th style="text-align: left;">Particulars</th><th>Unit</th><th>Qty</th><th style="text-align: right;">‡¶ü‡¶æ‡¶ï‡¶æ</th></tr>
        <tr><td>‡¶∏‡¶¨‡ßç‡¶ú‡¶ø ‡¶¨‡¶æ‡¶¨‡¶¶ (Vegetable)</td><td>‡¶ï‡ßá‡¶ú‡¶ø (Kg.)</td><td>${(vegExpense / 50).toFixed(2)}</td><td style="text-align: right;">${vegExpense.toFixed(2)}</td></tr>
        <tr><td>‡¶°‡¶ø‡¶Æ ‡¶¨‡¶æ‡¶¨‡¶¶ (Egg)</td><td>‡¶ü‡¶ø (pcs)</td><td>${(eggExpense / 7).toFixed(0)}</td><td style="text-align: right;">${eggExpense.toFixed(2)}</td></tr>
        <tr><td>‡¶°‡¶æ‡¶≤ ‡¶¨‡¶æ‡¶¨‡¶¶ (Pulse)</td><td>‡¶ï‡ßá‡¶ú‡¶ø (Kg.)</td><td>${(dalExpense / 80).toFixed(2)}</td><td style="text-align: right;">${dalExpense.toFixed(2)}</td></tr>
        <tr><td>‡¶§‡ßá‡¶≤ ‡¶¨‡¶æ‡¶¨‡¶¶ (Oil)</td><td>‡¶ï‡ßá‡¶ú‡¶ø (Kg.)</td><td>${(oilExpense / 150).toFixed(2)}</td><td style="text-align: right;">${oilExpense.toFixed(2)}</td></tr>
        <tr><td>‡¶Æ‡¶∂‡¶≤‡¶æ‡¶™‡¶æ‡¶§‡¶ø ‡¶ì ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø (Spice and Other)</td><td>‡¶ï‡ßá‡¶ú‡¶ø (Kg.)</td><td>${(spiceExpense / 100).toFixed(2)}</td><td style="text-align: right;">${spiceExpense.toFixed(2)}</td></tr>
        <tr><td>‡¶∏‡ßã‡¶Ø‡¶º‡¶æ‡¶¨‡¶ø‡¶® (Soyabean)</td><td>‡¶ï‡ßá‡¶ú‡¶ø (Kg.)</td><td>${(soyaExpense / 60).toFixed(2)}</td><td style="text-align: right;">${soyaExpense.toFixed(2)}</td></tr>
        <tr><td>‡¶ú‡ßç‡¶¨‡¶æ‡¶≤‡¶æ‡¶®‡¶ø ‡¶¨‡¶æ‡¶¨‡¶¶ (Fuel)</td><td>‡¶ï‡ßá‡¶ú‡¶ø (Kg.)</td><td>${(fuelExpense / 30).toFixed(2)}</td><td style="text-align: right;">${fuelExpense.toFixed(2)}</td></tr>
        <tr><td>‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø (Other)</td><td></td><td></td><td style="text-align: right;">-</td></tr>
        <tr style="background: #f0f0f0;"><td colspan="3" style="text-align: right; padding-right: 10px;"><strong>‡¶ñ‡¶æ‡¶¶‡ßç‡¶Ø ‡¶∏‡¶æ‡¶Æ‡¶ó‡ßç‡¶∞‡ßÄ ‡¶Æ‡ßã‡¶ü (Food Items Total):</strong></td><td style="text-align: right;"><strong>${totalCookingCost.toFixed(2)}</strong></td></tr>
        <tr style="background: #fffde7;"><td><strong>‡¶∞‡¶æ‡¶®‡ßç‡¶®‡¶æ‡¶∞ ‡¶Æ‡¶ú‡ßÅ‡¶∞‡ßÄ ‡¶¨‡¶æ‡¶¨‡¶¶ (Cook Cum Helper Wages)</strong></td><td colspan="2" style="font-size: 8px; color: #666;">${mdmData.cooks.length} cooks @ ‚Çπ${cookCumHelperWages.toFixed(2)}</td><td style="text-align: right;"><strong>${cookCumHelperWages.toFixed(2)}</strong></td></tr>
        <tr class="total-row" style="background: #e8f5e9;"><td><strong>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶Ø‡¶º (Total Expenditure)</strong></td><td colspan="2" style="font-size: 8px; color: #059669;">Food + Cook Wages</td><td style="text-align: right;"><strong>‚Çπ${totalExpenditure.toFixed(2)}</strong></td></tr>
    </table>
    
    <div style="background: #fff9e6; border: 2px solid #000; padding: 8px; margin-top: 10px; text-align: left; font-size: 10px;">
        ‡¶Ö‡¶§‡¶è‡¶¨, ‡¶Æ‡¶π‡¶æ‡¶∂‡¶Ø‡¶º ‡¶â‡¶™‡¶∞‡ßã‡¶ï‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶¨‡¶æ‡¶¨‡¶¶ ‡¶Æ‡ßã‡¶ü <strong>${Math.round(totalExpenditure)}</strong> ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡¶§ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶£‡ßç‡¶ü‡ßá ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶¨‡¶æ‡¶ß‡¶ø‡¶§ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®‡•§
    </div>
    
    <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 10px; margin-top: 12px; font-size: 9px;">
        <strong>üìä Calculation Formula (Excel Compatible):</strong><br>
        ‚Ä¢ Food Expenses = ‚Çπ${totalCookingCost.toFixed(2)} (Auto-calculated from Form-C: MT √ó Cost per student)<br>
        ‚Ä¢ Cook Wages = ‚Çπ${cookCumHelperWages.toFixed(2)} (From Settings ‚Üí Cook Details)<br>
        ‚Ä¢ <strong>Total Expenditure = Food + Cook Wages = ‚Çπ${totalExpenditure.toFixed(2)}</strong><br>
        ‚Ä¢ Expense Breakdown: Veg(2/7), Egg(1.75/7), Dal(1.5/7), Oil(0.3/7), Spice(0.5/7), Soya(0.2/7), Fuel(0.75/7)
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 30px; text-align: center; font-size: 9px;">
        <div><div style="border-top: 1px solid #000; margin-top: 35px; padding-top: 5px;">Guardian Signature</div></div>
        <div><div style="border-top: 1px solid #000; margin-top: 35px; padding-top: 5px;">Head/TIC Signature with Seal<br><strong>${mdmData.school.hoi}</strong></div></div>
        <div><div style="border-top: 1px solid #000; margin-top: 35px; padding-top: 5px;">SHGs Member Signature with Seal</div></div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 30px; text-align: center; font-size: 9px;">
        <div><div style="border-top: 1px solid #000; margin-top: 25px; padding-top: 5px;">Office-in-charge<br>Asst. of PM Poshan</div></div>
        <div><div style="border-top: 1px solid #000; margin-top: 25px; padding-top: 5px;">Block Development Officer</div></div>
        <div><div style="border-top: 1px solid #000; margin-top: 25px; padding-top: 5px;">Jt. Block Dev. Officer</div></div>
    </div>
</body>
</html>`;
            
            openGovernmentForm(formHTML, `${formLabel} - ${month} ${year}`);
        }
        
        // 2. Generate Form C - Monthly Coverage Report
        function generateGovFormC(type = 'UP') {
            const isPrimary = type === 'P';
            const formLabel = isPrimary ? 'FORM C (P)' : 'FORM C (UP)';
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            // Build form C rows from data - FIXED: using correct field names
            let formCRows = '';
            let totalCPV = 0, totalMTV = 0;
            let totalCPVI = 0, totalMTVI = 0;
            let totalCPVII = 0, totalMTVII = 0;
            let totalCPVIII = 0, totalMTVIII = 0;
            let totalRice = 0, totalCost = 0;
            
            mdmData.formC.forEach((entry, idx) => {
                // FIXED: Using correct field names cpV/mtV instead of presentV
                const cpV = parseInt(entry.cpV || 0);
                const mtV = parseInt(entry.mtV || 0);
                const cpVI = parseInt(entry.cpVI || 0);
                const mtVI = parseInt(entry.mtVI || 0);
                const cpVII = parseInt(entry.cpVII || 0);
                const mtVII = parseInt(entry.mtVII || 0);
                const cpVIII = parseInt(entry.cpVIII || 0);
                const mtVIII = parseInt(entry.mtVIII || 0);
                
                // Rice calculation per Excel: MT * rice_per_student / 1000
                const rice = (mtV * mdmData.rice.V + mtVI * mdmData.rice.VI + 
                             mtVII * mdmData.rice.VII + mtVIII * mdmData.rice.VIII) / 1000;
                
                // Cost calculation per Excel: MT * cost_per_student
                const cost = (mtV * mdmData.cost.V) + (mtVI * mdmData.cost.VI) + 
                            (mtVII * mdmData.cost.VII) + (mtVIII * mdmData.cost.VIII);
                
                // Accumulate totals
                totalCPV += cpV; totalMTV += mtV;
                totalCPVI += cpVI; totalMTVI += mtVI;
                totalCPVII += cpVII; totalMTVII += mtVII;
                totalCPVIII += cpVIII; totalMTVIII += mtVIII;
                totalRice += rice;
                totalCost += cost;
                
                // Get day name from date for menu
                let dayName = '';
                let menuItem = entry.menu || '';
                try {
                    const dateObj = new Date(entry.date.split('-').reverse().join('-'));
                    dayName = dateObj.toLocaleDateString('en-US', { weekday: 'long' });
                } catch (e) { dayName = ''; }
                
                // Generate row based on form type
                if (isPrimary) {
                    // Primary form - only Class V data (matching Excel FORM C (P))
                    const riceP = (mtV * mdmData.rice.V) / 1000;
                    const costP = mtV * mdmData.cost.V;
                    formCRows += `<tr>
                        <td>${idx + 1}</td>
                        <td>${entry.date || ''}</td>
                        <td>${cpV}</td><td>${mtV}</td>
                        <td>${riceP.toFixed(2)}</td>
                        <td>${costP.toFixed(2)}</td>
                        <td style="font-size: 7px;">${menuItem}</td>
                    </tr>`;
                } else {
                    // Upper Primary form - Class V to VIII data (matching Excel FORM C (UP))
                    const riceUP = (mtV * mdmData.rice.V + mtVI * mdmData.rice.VI + mtVII * mdmData.rice.VII + mtVIII * mdmData.rice.VIII) / 1000;
                    const costUP = (mtV * mdmData.cost.V) + (mtVI * mdmData.cost.VI) + (mtVII * mdmData.cost.VII) + (mtVIII * mdmData.cost.VIII);
                    formCRows += `<tr>
                        <td>${idx + 1}</td>
                        <td>${entry.date || ''}</td>
                        <td>${cpV}</td><td>${mtV}</td>
                        <td>${cpVI}</td><td>${mtVI}</td>
                        <td>${cpVII}</td><td>${mtVII}</td>
                        <td>${cpVIII}</td><td>${mtVIII}</td>
                        <td>${riceUP.toFixed(2)}</td>
                        <td>${costUP.toFixed(2)}</td>
                        <td style="font-size: 7px;">${menuItem}</td>
                    </tr>`;
                }
            });
            
            const totalCP = totalCPV + totalCPVI + totalCPVII + totalCPVIII;
            const totalMT = totalMTV + totalMTVI + totalMTVII + totalMTVIII;
            
            const formHTML = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Form C - ${month} ${year}</title>
<style>
    @page { size: A4 landscape; margin: 5mm; }
    body { font-family: Arial; padding: 5px; font-size: 8px; }
    .header { text-align: center; border: 2px solid #000; padding: 5px; margin-bottom: 5px; }
    .header h1 { font-size: 12px; margin: 2px 0; }
    .header h2 { font-size: 10px; margin: 2px 0; }
    table { width: 100%; border-collapse: collapse; margin: 3px 0; font-size: 7px; }
    table th, table td { border: 1px solid #000; padding: 2px; text-align: center; }
    table th { background: #d0d0d0; font-weight: bold; }
    .total { background: #f0f0f0; font-weight: bold; }
    .info-row { display: flex; gap: 20px; font-size: 8px; margin: 3px 0; }
    .btn-download { position: fixed; top: 10px; right: 10px; padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; z-index: 1000; }
    @media print { .btn-download { display: none !important; } }
</style></head>
<body>
    <button class="btn-download" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    
    <div class="header" style="position: relative; display: flex; align-items: center; gap: 12px;">
        <img src="${mdmLogoDataUrl}" style="width: 50px; height: 50px; object-fit: contain;" alt="MDM Logo">
        <div style="flex: 1; text-align: center;">
            <h1>Cooked Mid-Day-Meal Programme | School Education Department | Government of West Bengal</h1>
            <h2>Mid-Day-Meal Information System</h2>
            <h2>MONTHLY COVERAGE REPORT OF COOKED MID DAY MEAL PROGRAMME (Form-C)</h2>
            <div style="font-size: 8px; color: #666;">[To be filled up in English Block Capitals only]</div>
        </div>
        <div style="position: absolute; top: 5px; right: 15px; font-weight: bold;">${formLabel}</div>
    </div>
    
    <div class="info-row">
        <span><strong>For the Month:</strong> ${month}</span>
        <span><strong>Year:</strong> ${year}</span>
        <span><strong>District:</strong> ${document.getElementById('settingsDistrict')?.value || mdmData.school.district}</span>
        <span><strong>Subdivision:</strong> ${document.getElementById('settingsSubdivision')?.value || mdmData.school.subdivision}</span>
    </div>
    <div class="info-row">
        <span><strong>Block/Municipality:</strong> ${mdmData.school.block.toUpperCase()}</span>
        <span><strong>Name of G.P./Ward:</strong> ${document.getElementById('settingsGPWard')?.value || mdmData.school.gpWard}</span>
    </div>
    <div class="info-row">
        <span><strong>Name of School:</strong> ${mdmData.school.name.toUpperCase()}</span>
        <span><strong>Contact No:</strong> ${mdmData.school.contactNo}</span>
        <span><strong>DISE Code:</strong> ${mdmData.school.dise}</span>
    </div>
    <div class="info-row">
        <span><strong>Enrolled Class V:</strong> ${mdmData.enrollment.V}</span>
        <span><strong>Class VI:</strong> ${mdmData.enrollment.VI}</span>
        <span><strong>Class VII:</strong> ${mdmData.enrollment.VII}</span>
        <span><strong>Class VIII:</strong> ${mdmData.enrollment.VIII}</span>
    </div>
    
    <table>
        ${isPrimary ? `
        <tr>
            <th rowspan="2" style="width: 25px;">Sl No</th>
            <th rowspan="2" style="width: 70px;">CMDM Serving Date</th>
            <th colspan="2">Class V (Primary)</th>
            <th rowspan="2" style="width: 45px;">Rice Utilized (in Kg)</th>
            <th rowspan="2" style="width: 50px;">Cooking cost Utilized (in Rs)</th>
            <th rowspan="2" style="width: 100px;">Menu</th>
        </tr>
        <tr>
            <th>CP</th><th>MT</th>
        </tr>
        ` : `
        <tr>
            <th rowspan="3" style="width: 25px;">Sl No</th>
            <th rowspan="3" style="width: 70px;">CMDM Serving Date</th>
            <th colspan="8">No. of Children Provided CMDM and Present for Upper Primary</th>
            <th rowspan="3" style="width: 45px;">Rice Utilized (in Kg)</th>
            <th rowspan="3" style="width: 50px;">Cooking cost Utilized (in Rs)</th>
            <th rowspan="3" style="width: 80px;">Menu</th>
        </tr>
        <tr>
            <th colspan="2">Class V</th>
            <th colspan="2">Class VI</th>
            <th colspan="2">Class VII</th>
            <th colspan="2">Class VIII</th>
        </tr>
        <tr>
            <th>CP</th><th>MT</th>
            <th>CP</th><th>MT</th>
            <th>CP</th><th>MT</th>
            <th>CP</th><th>MT</th>
        </tr>
        `}
        ${formCRows}
        ${isPrimary ? `
        <tr class="total">
            <td colspan="2">Total</td>
            <td>${totalCPV}</td><td>${totalMTV}</td>
            <td>${(totalMTV * mdmData.rice.V / 1000).toFixed(2)}</td>
            <td>${(totalMTV * mdmData.cost.V).toFixed(2)}</td>
            <td></td>
        </tr>
        ` : `
        <tr class="total">
            <td colspan="2">Total</td>
            <td>${totalCPV}</td><td>${totalMTV}</td>
            <td>${totalCPVI}</td><td>${totalMTVI}</td>
            <td>${totalCPVII}</td><td>${totalMTVII}</td>
            <td>${totalCPVIII}</td><td>${totalMTVIII}</td>
            <td>${totalRice.toFixed(2)}</td>
            <td>${totalCost.toFixed(2)}</td>
            <td></td>
        </tr>
        `}
    </table>
    
    <div style="margin-top: 8px; font-size: 8px;">
        <div class="info-row">
            <span><strong>Total CP:</strong> ${totalCP}</span>
            <span><strong>Total MT Class V:</strong> ${totalMTV}</span>
            <span><strong>Total MT VI to VIII:</strong> ${totalMTVI + totalMTVII + totalMTVIII}</span>
        </div>
    </div>
    
    <div style="margin-top: 8px; font-size: 8px; border: 1px solid #000; padding: 5px;">
        <strong>Fund Details (in Rs) ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Cash Utilization)</strong>
        <table style="margin-top: 5px;">
            <tr><th>Component</th><th>Opening Balance</th><th>Received during month</th><th>Expenditure during month</th><th>Closing Balance</th></tr>
            <tr><td>Cooking Cost - V</td><td></td><td></td><td>${(totalMTV * mdmData.cost.V).toFixed(2)}</td><td></td></tr>
            <tr><td>Cooking Cost - VI to VIII</td><td></td><td></td><td>${((totalMTVI + totalMTVII + totalMTVIII) * mdmData.cost.VI).toFixed(2)}</td><td></td></tr>
            <tr><td>Cook Cum Helper</td><td></td><td>10000</td><td>10000</td><td></td></tr>
        </table>
    </div>
    
    <div style="font-size: 7px; margin-top: 5px;"><strong>CP:</strong> Children Present | <strong>MT:</strong> MDM Takers</div>
    
    <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
        <div style="text-align: center; border-top: 1px solid #000; padding-top: 5px; width: 200px;">
            Signature of Head of the Institution with Seal<br><strong>${mdmData.school.hoi}</strong>
        </div>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, `${formLabel} - ${month} ${year}`);
        }
        
        // 3. Generate Master Data Entry Form
        function generateGovMasterForm() {
            // Get teachers data from mdmData.staff array - MAXIMUM 3 TEACHERS
            let teachersHTML = '';
            if (mdmData.staff && mdmData.staff.length > 0) {
                // Take first 3 teachers for MDCF form
                teachersHTML = mdmData.staff.slice(0, 3).map((teacher, index) => `
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <div class="row"><div class="label">Teacher ${index + 1}:</div><div class="value">${teacher.name.toUpperCase()}</div></div>
                        <div class="row"><div class="label">Designation:</div><div class="value">${teacher.designation.toUpperCase()}</div></div>
                        <div class="row"><div class="label">Mobile No.:</div><div class="value">+91-${teacher.mobile}</div></div>
                    </div>
                `).join('');
            } else {
                // Default fallback - 3 empty teacher slots
                teachersHTML = `
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <div class="row"><div class="label">Teacher 1:</div><div class="value">_______________________</div></div>
                        <div class="row"><div class="label">Designation:</div><div class="value">_______________________</div></div>
                        <div class="row"><div class="label">Mobile No.:</div><div class="value">_______________________</div></div>
                    </div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <div class="row"><div class="label">Teacher 2:</div><div class="value">_______________________</div></div>
                        <div class="row"><div class="label">Designation:</div><div class="value">_______________________</div></div>
                        <div class="row"><div class="label">Mobile No.:</div><div class="value">_______________________</div></div>
                    </div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <div class="row"><div class="label">Teacher 3:</div><div class="value">_______________________</div></div>
                        <div class="row"><div class="label">Designation:</div><div class="value">_______________________</div></div>
                        <div class="row"><div class="label">Mobile No.:</div><div class="value">_______________________</div></div>
                    </div>
                `;
            }
            
            const formHTML = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Master Data Entry Form</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial; padding: 15px; font-size: 11px; }
    .header { text-align: center; border: 3px solid #0066cc; padding: 10px; margin: 0 0 15px 0; background: #e3f2fd; box-sizing: border-box; }
    .header h1 { font-size: 18px; color: #0066cc; margin: 3px 0; }
    .header h2 { font-size: 14px; margin: 2px 0; }
    .header h3 { font-size: 13px; color: #ff6600; margin: 2px 0; }
    .section { margin: 15px 0; border: 2px solid #0066cc; padding: 10px; background: #f8f9fa; box-sizing: border-box; }
    .section-title { background: #0066cc; color: white; padding: 6px; font-weight: bold; margin: -10px -10px 10px -10px; }
    .row { display: grid; grid-template-columns: 150px 1fr; margin: 8px 0; }
    .label { font-weight: bold; }
    .value { border-bottom: 1px solid #000; padding: 3px 5px; }
    .checkbox-group { display: flex; gap: 15px; margin: 10px 0; flex-wrap: wrap; }
    .checkbox-item { display: flex; align-items: center; gap: 6px; }
    .checkbox { width: 14px; height: 14px; border: 2px solid #000; display: inline-block; text-align: center; line-height: 14px; font-size: 10px; }
    .btn-download { position: fixed; top: 10px; right: 10px; padding: 12px 24px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); transition: all 0.3s ease; z-index: 1000; }
    .btn-download:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4); }
    @media print { .btn-download { display: none !important; } * { margin: 0; padding: 0; } }
</style></head>
<body>
    <button class="btn-download" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    <div class="header" style="display: flex; align-items: center; gap: 15px;">
        <img src="${mdmLogoDataUrl}" style="width: 55px; height: 55px; object-fit: contain;" alt="MDM Logo">
        <div style="flex: 1; text-align: center;">
            <h1>Cooked Mid-Day Meal Project</h1>
            <h2 style="font-size: 14px; margin: 2px 0;">School Education Department - Government of West Bengal</h2>
            <h3 style="font-size: 13px; color: #ff6600;">School wise Information regarding</h3>
        </div>
    </div>
    
    <div class="section">
        <div class="section-title">SCHOOL DETAILS *</div>
        <div class="row"><div class="label">School Name:</div><div class="value">${mdmData.school.name.toUpperCase()}</div></div>
        <div class="row"><div class="label">DISE Code:</div><div class="value">${mdmData.school.dise}</div></div>
        <div class="row"><div class="label">District:</div><div class="value">${mdmData.school.district}</div></div>
        <div class="row"><div class="label">Block:</div><div class="value">${mdmData.school.block.toUpperCase()}</div></div>
        <div class="row"><div class="label">Subdivision:</div><div class="value">${mdmData.school.subdivision}</div></div>
        <div class="row"><div class="label">GP/Ward:</div><div class="value">${mdmData.school.gpWard}</div></div>
        
        <div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid #ddd;">
            <div class="checkbox-group">
                <strong style="min-width: 90px;">Type:</strong>
                <div class="checkbox-item"><span class="checkbox">‚úì</span> Government</div>
                <div class="checkbox-item"><span class="checkbox"></span> Aided</div>
                <div class="checkbox-item"><span class="checkbox"></span> Unaided</div>
            </div>
            <div class="checkbox-group">
                <strong style="min-width: 90px;">Category:</strong>
                <div class="checkbox-item"><span class="checkbox"></span> Primary</div>
                <div class="checkbox-item"><span class="checkbox"></span> Upper Primary</div>
                <div class="checkbox-item"><span class="checkbox">‚úì</span> Primary with Upper Primary</div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <div class="section-title">CONTACT DETAILS *</div>
        <div class="row"><div class="label">MDM In-Charge:</div><div class="value">${mdmData.school.mdmic.toUpperCase()}</div></div>
        <div class="row"><div class="label">Contact No.:</div><div class="value">${mdmData.school.contactNo || '+91-9679699886'}</div></div>
        
        ${teachersHTML}
    </div>
    
    <div class="section">
        <div class="section-title">ENROLMENT DETAILS *</div>
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
            <tr style="background: #e0e0e0; font-weight: bold;">
                <td style="border: 1px solid #000; padding: 5px; text-align: center;">Class V</td>
                <td style="border: 1px solid #000; padding: 5px; text-align: center;">${mdmData.enrollment.V}</td>
                <td style="border: 1px solid #000; padding: 5px; text-align: center;">Class VI</td>
                <td style="border: 1px solid #000; padding: 5px; text-align: center;">${mdmData.enrollment.VI}</td>
            </tr>
            <tr style="background: #e0e0e0; font-weight: bold;">
                <td style="border: 1px solid #000; padding: 5px; text-align: center;">Class VII</td>
                <td style="border: 1px solid #000; padding: 5px; text-align: center;">${mdmData.enrollment.VII}</td>
                <td style="border: 1px solid #000; padding: 5px; text-align: center;">Class VIII</td>
                <td style="border: 1px solid #000; padding: 5px; text-align: center;">${mdmData.enrollment.VIII}</td>
            </tr>
        </table>
    </div>
    
    <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 12px; margin-top: 15px; border-radius: 5px;">
        <p style="margin: 0; font-size: 10px; color: #2e7d32;">
            <strong>üìå Auto-Generated Form:</strong> First 3 teacher details auto-populated from Settings ‚Üí Staff & Management section. 
            Add teachers in Settings tab to see them here automatically. MDCF form shows maximum 3 teachers only.
        </p>
    </div>
    
    <div style="margin-top: 40px; text-align: right; padding-right: 50px;">
        <div style="border-top: 1px solid #000; width: 200px; margin-left: auto; margin-top: 30px; padding-top: 5px; text-align: center;">
            (Signature with stamp of HOI)<br><strong>${mdmData.school.hoi}</strong>
        </div>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, 'Master Data Entry Form');
        }
        
        // 4. Generate PM POSHAN Form
        function generateGovPMPOSHAN() {
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            let totalWorkingDays = mdmData.formC.length;
            let totalMealsV = 0, totalMealsVI_VIII = 0;
            let totalRiceConsumed = 0, totalCookingCost = 0;
            
            // Calculate from Form C entries using correct field names
            mdmData.formC.forEach(entry => {
                const mtV = parseInt(entry.mtV || 0);
                const mtVI = parseInt(entry.mtVI || 0);
                const mtVII = parseInt(entry.mtVII || 0);
                const mtVIII = parseInt(entry.mtVIII || 0);
                
                totalMealsV += mtV;
                totalMealsVI_VIII += mtVI + mtVII + mtVIII;
                
                // Rice calculation per Excel
                totalRiceConsumed += (mtV * mdmData.rice.V + mtVI * mdmData.rice.VI + 
                                     mtVII * mdmData.rice.VII + mtVIII * mdmData.rice.VIII) / 1000;
                
                // Cooking cost calculation per Excel
                totalCookingCost += (mtV * mdmData.cost.V) + (mtVI * mdmData.cost.VI) + 
                                   (mtVII * mdmData.cost.VII) + (mtVIII * mdmData.cost.VIII);
            });
            
            const totalExpenditure = totalCookingCost;
            
            // Cook Payment Details HTML - auto-populated from Settings
            let cookDetailsHTML = '';
            if (mdmData.cooks && mdmData.cooks.length > 0) {
                cookDetailsHTML = mdmData.cooks.map((cook, index) => `
                    <tr>
                        <td style="text-align: center;">${index + 1}</td>
                        <td>${cook.name}</td>
                        <td style="text-align: center;">${cook.gender}</td>
                        <td style="text-align: center;">${cook.caste || 'GEN'}</td>
                        <td style="text-align: center;">${cook.paymentMode || 'Bank'}</td>
                        <td style="text-align: right;">‚Çπ${(cook.amount || 0).toFixed(2)}</td>
                    </tr>
                `).join('');
            } else {
                cookDetailsHTML = `
                    <tr><td style="text-align: center;">1</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td style="text-align: center;">2</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td style="text-align: center;">3</td><td></td><td></td><td></td><td></td><td></td></tr>
                    <tr><td style="text-align: center;">4</td><td></td><td></td><td></td><td></td><td></td></tr>
                `;
            }
            
            const totalCookPayment = mdmData.cooks.reduce((sum, cook) => sum + (cook.amount || 0), 0);
            
            const formHTML = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>PM POSHAN - ${month} ${year}</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; padding: 15px; font-size: 10px; background: #fff; }
    .header { text-align: center; border: 3px solid #0066cc; padding: 12px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); margin-bottom: 12px; }
    .header h1 { font-size: 18px; color: #0066cc; margin: 5px 0; font-weight: 700; }
    .header h2 { font-size: 14px; margin: 3px 0; color: #333; }
    .section { margin: 12px 0; border: 2px solid #0066cc; page-break-inside: avoid; }
    .section-title { background: #0066cc; color: white; padding: 8px 12px; font-weight: bold; font-size: 11px; }
    .section-content { padding: 12px; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 9px; }
    table th, table td { border: 1px solid #333; padding: 6px 4px; }
    table th { background: #e0e0e0; font-weight: bold; text-align: center; }
    .info-row { display: grid; grid-template-columns: 180px 1fr; gap: 10px; margin: 6px 0; align-items: center; }
    .info-label { font-weight: 600; color: #333; }
    .checkbox-group { display: flex; gap: 20px; margin: 10px 0; }
    .checkbox-item { display: flex; align-items: center; gap: 8px; }
    .checkbox { width: 16px; height: 16px; border: 2px solid #333; display: inline-block; }
    .signature-section { display: grid; grid-template-columns: 1fr 1fr; gap: 80px; margin-top: 40px; text-align: center; }
    .signature-line { border-top: 2px solid #000; margin-top: 50px; padding-top: 8px; font-weight: 600; }
    .btn-download { position: fixed; top: 15px; right: 15px; padding: 14px 28px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 15px; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4); transition: all 0.3s ease; z-index: 1000; }
    .btn-download:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5); }
    .instructions { background: #fffde7; border: 2px dashed #f57f17; padding: 10px; margin-bottom: 12px; border-radius: 6px; font-size: 9px; }
    @media print { 
        .btn-download { display: none !important; } 
        body { padding: 10px; }
        .section { page-break-inside: avoid; }
    }
</style></head>
<body>
    <button class="btn-download" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
    
    <div class="header" style="display: flex; align-items: center; gap: 15px;">
        <img src="${mdmLogoDataUrl}" style="width: 60px; height: 60px; object-fit: contain;" alt="PM POSHAN Logo">
        <div style="flex: 1; text-align: center;">
            <h1>Pradhan Mantri Poshan Shakti Nirman (PM POSHAN)</h1>
            <h2>School Monthly Data Capture Format (MDCF)</h2>
        </div>
    </div>
    
    <div class="instructions">
        <strong>üìã Instructions:</strong> Keep following registers at the time of filling the form:- 
        1) Enrolment Register. 2) Account 3) Bank Account Pass book. 4) Cooking cost details etc.
    </div>
    
    <!-- 1. School Details -->
    <div class="section">
        <div class="section-title">1. School Details</div>
        <div class="section-content">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <div class="info-row">
                    <span class="info-label">Month-Year:</span>
                    <span>${month} - ${year}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">UDISE Code:</span>
                    <span>${mdmData.school.dise}</span>
                </div>
                <div class="info-row" style="grid-column: span 2;">
                    <span class="info-label">School Name:</span>
                    <span>${mdmData.school.name.toUpperCase()}</span>
                </div>
            </div>
            
            <div class="checkbox-group" style="margin-top: 10px;">
                <strong>Type:</strong>
                <div class="checkbox-item"><span class="checkbox">‚úì</span> Government</div>
                <div class="checkbox-item"><span class="checkbox"></span> Local Body</div>
                <div class="checkbox-item"><span class="checkbox"></span> EGS/AIE Centers</div>
                <div class="checkbox-item"><span class="checkbox"></span> NCLP</div>
                <div class="checkbox-item"><span class="checkbox"></span> Madras / Maqtab</div>
            </div>
            
            <div class="checkbox-group">
                <strong>Category:</strong>
                <div class="checkbox-item"><span class="checkbox"></span> Primary</div>
                <div class="checkbox-item"><span class="checkbox"></span> Upper Primary</div>
                <div class="checkbox-item"><span class="checkbox">‚úì</span> Primary with Upper Primary</div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                <div class="info-row">
                    <span class="info-label">State / UT:</span>
                    <span>West Bengal</span>
                </div>
                <div class="info-row">
                    <span class="info-label">District:</span>
                    <span>${document.getElementById('settingsDistrict')?.value || mdmData.school.district}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Block/NP:</span>
                    <span>${mdmData.school.block.toUpperCase()}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Village/Ward:</span>
                    <span>${document.getElementById('settingsGPWard')?.value || mdmData.school.gpWard}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Kitchen Type:</span>
                    <span>SHG</span>
                </div>
                <div class="info-row">
                    <span class="info-label">NGO/SHG:</span>
                    <span>${document.getElementById('settingsSHGName')?.value || mdmData.school.shgName}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Enrolment:</span>
                    <span><strong>${mdmData.enrollment.V + mdmData.enrollment.VI + mdmData.enrollment.VII + mdmData.enrollment.VIII} students</strong></span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 2. Meals Availed Status -->
    <div class="section">
        <div class="section-title">2. Meals Availed Status</div>
        <div class="section-content">
            <table>
                <thead>
                    <tr>
                        <th style="width: 40%;">Parameter</th>
                        <th>Bal Vatika</th>
                        <th>Primary</th>
                        <th>Upper Primary</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Number of School days during month</td>
                        <td style="text-align: center;">-</td>
                        <td style="text-align: center;">${totalWorkingDays || 0}</td>
                        <td style="text-align: center;">${totalWorkingDays || 0}</td>
                    </tr>
                    <tr>
                        <td>Actual number of days Mid Day Meal served</td>
                        <td style="text-align: center;">-</td>
                        <td style="text-align: center;">${totalWorkingDays || 0}</td>
                        <td style="text-align: center;">${totalWorkingDays || 0}</td>
                    </tr>
                    <tr>
                        <td><strong>Total Meals served during the month</strong></td>
                        <td style="text-align: center;"><strong>-</strong></td>
                        <td style="text-align: center;"><strong>${totalMealsV}</strong></td>
                        <td style="text-align: center;"><strong>${totalMealsVI_VIII}</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 3. Fund Details -->
    <div class="section">
        <div class="section-title">3. Fund Details (in Rs.)</div>
        <div class="section-content">
            <table>
                <thead>
                    <tr>
                        <th style="width: 30%;">Component</th>
                        <th>Opening Balance</th>
                        <th>Received during the Month</th>
                        <th>Expenditure during the Month</th>
                        <th>Closing Balance</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Cooking Cost - Bal Vatika</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                    </tr>
                    <tr>
                        <td>Cooking Cost - Primary</td>
                        <td style="text-align: right;">${mdmData.fundOpening ? mdmData.fundOpening.toFixed(2) : '-'}</td>
                        <td style="text-align: right;">${mdmData.cookingCostReceived ? mdmData.cookingCostReceived.toFixed(2) : '-'}</td>
                        <td style="text-align: right;">${totalExpenditure > 0 ? totalExpenditure.toFixed(2) : '-'}</td>
                        <td style="text-align: right;">${mdmData.fundOpening ? (mdmData.fundOpening + (mdmData.cookingCostReceived || 0) - totalExpenditure).toFixed(2) : '-'}</td>
                    </tr>
                    <tr>
                        <td>Cooking Cost - Upper Primary</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                    </tr>
                    <tr style="background: #f5f5f5;">
                        <td><strong>Cook Cum Helper</strong></td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;"><strong>‚Çπ${totalCookPayment.toFixed(2)}</strong></td>
                        <td style="text-align: right;">-</td>
                    </tr>
                    <tr>
                        <td>School Expenses : MME Expenses</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                    </tr>
                </tbody>
            </table>
            <div style="margin-top: 10px; display: flex; align-items: center; gap: 15px;">
                <strong>Whether the Sum of above Closing Balance matches with Bank Account Closing Balance:</strong>
                <div class="checkbox-item"><span class="checkbox">‚úì</span> Yes</div>
                <div class="checkbox-item"><span class="checkbox"></span> No</div>
            </div>
        </div>
    </div>
    
    <!-- 4. Cook Cum Helper Payment Details -->
    <div class="section">
        <div class="section-title">4. Cook Cum Helper Payment Details</div>
        <div class="section-content">
            <table>
                <thead>
                    <tr>
                        <th style="width: 8%;">S.No.</th>
                        <th style="width: 30%;">Cook Name</th>
                        <th style="width: 12%;">Gender<br>(M/F)</th>
                        <th style="width: 15%;">Category<br>(SC/ST/OBC/GEN)</th>
                        <th style="width: 15%;">Payment Mode<br>(Cash/Bank)</th>
                        <th style="width: 20%;">Amount Received during month (In Rs.)</th>
                    </tr>
                </thead>
                <tbody>
                    ${cookDetailsHTML}
                </tbody>
                <tfoot>
                    <tr style="background: #f0f0f0; font-weight: bold;">
                        <td colspan="5" style="text-align: right; padding-right: 15px;">TOTAL PAYMENT:</td>
                        <td style="text-align: right; font-size: 10px; color: #059669;">‚Çπ${totalCookPayment.toFixed(2)}</td>
                    </tr>
                </tfoot>
            </table>
            <p style="color: #059669; font-size: 9px; margin-top: 8px; font-style: italic;">
                ‚úÖ Cook details auto-populated from Settings section
            </p>
        </div>
    </div>
    
    <!-- 5. Food Grains Details -->
    <div class="section">
        <div class="section-title">5. Food Grains Details (in KG.)</div>
        <div class="section-content">
            <table>
                <thead>
                    <tr>
                        <th style="width: 18%;">Category</th>
                        <th style="width: 15%;">Food Item</th>
                        <th>Opening Balance</th>
                        <th>Received during the Month</th>
                        <th>Consumption during the Month</th>
                        <th>Closing Balance</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="2">Bal Vatika</td>
                        <td>Wheat</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                    </tr>
                    <tr>
                        <td>Rice</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                    </tr>
                    <tr>
                        <td rowspan="2">Primary</td>
                        <td>Wheat</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                    </tr>
                    <tr>
                        <td>Rice</td>
                        <td style="text-align: right;">${mdmData.riceOpeningStock ? (mdmData.riceOpeningStock * 0.2).toFixed(2) : '-'}</td>
                        <td style="text-align: right;">${mdmData.riceReceivedStock ? (mdmData.riceReceivedStock * 0.2).toFixed(2) : '0.00'}</td>
                        <td style="text-align: right;">${totalRiceConsumed > 0 ? (totalRiceConsumed * 0.2).toFixed(2) : '-'}</td>
                        <td style="text-align: right;">${mdmData.riceOpeningStock ? ((mdmData.riceOpeningStock * 0.2) + (mdmData.riceReceivedStock || 0) * 0.2 - (totalRiceConsumed * 0.2)).toFixed(2) : '-'}</td>
                    </tr>
                    <tr>
                        <td rowspan="2"><strong>Upper Primary</strong></td>
                        <td>Wheat</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                        <td style="text-align: right;">-</td>
                    </tr>
                    <tr>
                        <td><strong>Rice</strong></td>
                        <td style="text-align: right;"><strong>${mdmData.riceOpeningStock ? (mdmData.riceOpeningStock * 0.8).toFixed(2) : '-'}</strong></td>
                        <td style="text-align: right;"><strong>${mdmData.riceReceivedStock ? (mdmData.riceReceivedStock * 0.8).toFixed(2) : '0.00'}</strong></td>
                        <td style="text-align: right;"><strong>${totalRiceConsumed > 0 ? (totalRiceConsumed * 0.8).toFixed(2) : '-'}</strong></td>
                        <td style="text-align: right;"><strong>${mdmData.riceOpeningStock ? ((mdmData.riceOpeningStock * 0.8) + (mdmData.riceReceivedStock || 0) * 0.8 - (totalRiceConsumed * 0.8)).toFixed(2) : '-'}</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 6. Children Health Status -->
    <div class="section">
        <div class="section-title">6. Children Health Status</div>
        <div class="section-content">
            <table>
                <tbody>
                    <tr>
                        <td style="width: 70%;">No. of children from class 1 to 8 who had received 4 IFA tablets (Boys)</td>
                        <td style="text-align: center;">${mdmData.mdcf?.healthStatus?.ifaTabletsBoys || '-'}</td>
                    </tr>
                    <tr>
                        <td>No. of children from class 1 to 8 who had received 4 IFA tablets (Girls)</td>
                        <td style="text-align: center;">${mdmData.mdcf?.healthStatus?.ifaTabletsGirls || '-'}</td>
                    </tr>
                    <tr>
                        <td>No. of children screened by mobile health (RBSK) team</td>
                        <td style="text-align: center;">${mdmData.mdcf?.healthStatus?.rbskScreened || '-'}</td>
                    </tr>
                    <tr>
                        <td>No. of children referred by mobile health (RBSK) team</td>
                        <td style="text-align: center;">${mdmData.mdcf?.healthStatus?.rbskReferred || '-'}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 7. School Inspection -->
    <div class="section">
        <div class="section-title">7. School Inspection</div>
        <div class="section-content">
            <table>
                <thead>
                    <tr>
                        <th style="width: 70%;">School Inspection done during the month</th>
                        <th style="width: 15%;">Yes</th>
                        <th style="width: 15%;">No</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>By Members of Task Force</td>
                        <td style="text-align: center;"><span class="checkbox"></span></td>
                        <td style="text-align: center;"><span class="checkbox"></span></td>
                    </tr>
                    <tr>
                        <td>By District Officials</td>
                        <td style="text-align: center;"><span class="checkbox"></span></td>
                        <td style="text-align: center;"><span class="checkbox"></span></td>
                    </tr>
                    <tr>
                        <td>By Block/Taluka Level Officials</td>
                        <td style="text-align: center;"><span class="checkbox"></span></td>
                        <td style="text-align: center;"><span class="checkbox"></span></td>
                    </tr>
                    <tr>
                        <td>By SMC Members</td>
                        <td style="text-align: center;"><span class="checkbox"></span></td>
                        <td style="text-align: center;"><span class="checkbox"></span></td>
                    </tr>
                </tbody>
            </table>
            <div class="info-row" style="margin-top: 15px;">
                <span class="info-label">Number of Untoward Incidents Occurred:</span>
                <span>${mdmData.mdcf?.inspection?.untowardIncidents || '0'}</span>
            </div>
        </div>
    </div>
    
    <!-- Signatures -->
    <div class="signature-section">
        <div>
            <div class="signature-line">
                Signature of the SMC Chairperson / Gram Pradhan
            </div>
        </div>
        <div>
            <div class="signature-line">
                Signature of Head Teacher<br>
                <span style="font-size: 11px;">${mdmData.school.hoi}</span>
            </div>
        </div>
    </div>
    
    <div style="margin-top: 25px; padding: 12px; background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 5px;">
        <p style="margin: 0; font-size: 9px; color: #2e7d32;">
            <strong>üìå Auto-Generated Report:</strong> This PM POSHAN MDCF form is automatically populated from your MDM System data. 
            Cook payment details are from Settings ‚Üí Cook Details section. All calculations are based on Form-C daily entries.
        </p>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, `PM POSHAN MDCF - ${month} ${year}`);
        }
        
        // 5. Generate Rice Register - ‡¶ö‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨
        function generateGovRiceRegister(type = 'UP') {
            const isPrimary = type === 'P';
            const formLabel = isPrimary ? 'Rice Register (P)' : 'Rice Register (UP)';
            const categoryLabel = isPrimary ? 'Primary (Class V)' : 'Upper Primary (Class VI-VIII)';
            const currentDate = new Date();
            const month = currentDate.toLocaleDateString('en-GB', { month: 'long' }).toUpperCase();
            const year = currentDate.getFullYear();
            
            // Get rice opening balance from settings
            const riceOpening = parseFloat(document.getElementById('riceOpeningStock')?.value) || 524.01;
            const riceReceived = parseFloat(document.getElementById('riceReceivedStock')?.value) || 0;
            
            // Build rice register rows from Form C data - FIXED: using correct field names
            let riceRows = '';
            let runningBalance = riceOpening + riceReceived;
            let totalConsumed = 0, totalAttendance = 0, totalMT = 0;
            
            mdmData.formC.forEach((entry, idx) => {
                // FIXED: Using correct field names
                const cpV = parseInt(entry.cpV || 0);
                const cpVI = parseInt(entry.cpVI || 0);
                const cpVII = parseInt(entry.cpVII || 0);
                const cpVIII = parseInt(entry.cpVIII || 0);
                const mtV = parseInt(entry.mtV || 0);
                const mtVI = parseInt(entry.mtVI || 0);
                const mtVII = parseInt(entry.mtVII || 0);
                const mtVIII = parseInt(entry.mtVIII || 0);
                
                // Calculate based on type
                let totalCP, totalMTDaily, riceConsumed;
                if (isPrimary) {
                    totalCP = cpV;
                    totalMTDaily = mtV;
                    riceConsumed = (mtV * mdmData.rice.V) / 1000;
                } else {
                    totalCP = cpVI + cpVII + cpVIII;
                    totalMTDaily = mtVI + mtVII + mtVIII;
                    riceConsumed = (mtVI * mdmData.rice.VI + mtVII * mdmData.rice.VII + mtVIII * mdmData.rice.VIII) / 1000;
                }
                
                const openingForDay = idx === 0 ? riceOpening : runningBalance;
                const receivedForDay = idx === 0 ? riceReceived : 0;
                const totalForDay = openingForDay + receivedForDay;
                runningBalance = totalForDay - riceConsumed;
                
                totalConsumed += riceConsumed;
                totalAttendance += totalCP;
                totalMT += totalMTDaily;
                
                riceRows += `<tr>
                    <td>${idx + 1}</td>
                    <td>${entry.date || ''}</td>
                    <td>${openingForDay.toFixed(2)}</td>
                    <td>${receivedForDay.toFixed(2)}</td>
                    <td>${totalForDay.toFixed(2)}</td>
                    <td>${riceConsumed.toFixed(2)}</td>
                    <td>${runningBalance.toFixed(2)}</td>
                    <td>${totalCP}</td>
                    <td>${totalMTDaily}</td>
                    <td></td>
                </tr>`;
            });
            
            const totalEnrollment = isPrimary ? mdmData.enrollment.V : 
                                   (mdmData.enrollment.VI + mdmData.enrollment.VII + mdmData.enrollment.VIII);
            
            const formHTML = `<!DOCTYPE html>
<html lang="bn"><head><meta charset="UTF-8"><title>Rice Register - ${month} ${year}</title>
<style>
    @page { size: A4; margin: 8mm; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Noto Sans Bengali', Arial; padding: 10px; font-size: 10px; }
    .header { text-align: center; border: 2px solid #000; padding: 8px; margin: 0 0 8px 0; }
    .header h1 { font-size: 14px; margin: 3px 0; }
    .header h2 { font-size: 12px; margin: 2px 0; }
    .info-row { display: flex; justify-content: space-between; font-size: 9px; margin: 5px 0; padding: 3px; background: #f5f5f5; }
    table { width: 100%; border-collapse: collapse; margin: 5px 0; font-size: 9px; }
    table th, table td { border: 1px solid #000; padding: 4px; text-align: center; }
    table th { background: #d0d0d0; font-weight: bold; }
    .total { background: #ffffcc; font-weight: bold; }
    .btn-download { position: fixed; top: 10px; right: 10px; padding: 10px 20px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); z-index: 1000; }
    @media print { .btn-download { display: none !important; } }
</style></head>
<body>
    <button class="btn-download" onclick="window.print()">üñ®Ô∏è Print / Save PDF</button>
    
    <div class="header" style="display: flex; align-items: center; gap: 15px;">
        <img src="${mdmLogoDataUrl}" style="width: 55px; height: 55px; object-fit: contain;" alt="MDM Logo">
        <div style="flex: 1; text-align: center;">
            <h1>‡¶∞‡¶æ‡¶®‡ßç‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶Æ‡¶ß‡ßç‡¶Ø‡¶æ‡¶π‡ßç‡¶®‡¶ï‡¶æ‡¶≤‡ßÄ‡¶® ‡¶≠‡ßã‡¶ú‡¶® ‡¶™‡ßç‡¶∞‡¶ï‡¶≤‡ßç‡¶™</h1>
            <h2>‡¶ö‡¶æ‡¶≤ ‡¶ñ‡¶∞‡¶ö‡ßá‡¶∞ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</h2>
        </div>
    </div>
    
    <div class="info-row">
        <span><strong>‡¶¨‡ßç‡¶≤‡¶ï/‡¶™‡ßå‡¶∞‡¶∏‡¶≠‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ${mdmData.school.block.toUpperCase()}</span>
        <span><strong>‡¶ó‡ßç‡¶∞‡¶æ.‡¶™./‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°:</strong> ${document.getElementById('settingsGPWard')?.value || mdmData.school.gpWard}</span>
    </div>
    <div class="info-row">
        <span><strong>‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶æ‡¶≤‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ${mdmData.school.name.toUpperCase()}</span>
        <span><strong>‡¶ó‡ßã‡¶∑‡ßç‡¶†‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ${document.getElementById('settingsSHGName')?.value || mdmData.school.shgName}</span>
    </div>
    <div class="info-row">
        <span><strong>‡¶Æ‡¶æ‡¶∏:</strong> ${month}</span>
        <span><strong>‡¶¨‡ßé‡¶∏‡¶∞:</strong> ${year}</span>
        <span><strong>‡¶Æ‡ßã‡¶ü ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßÄ‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ:</strong> ${totalEnrollment}</span>
    </div>
    
    <table>
        <tr>
            <th>‡¶ï‡ßç‡¶∞‡¶Æ‡¶ø‡¶ï</th>
            <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
            <th>‡¶ï‡¶§ ‡¶ö‡¶æ‡¶≤ ‡¶π‡¶æ‡¶§‡ßá ‡¶Ü‡¶õ‡ßá</th>
            <th>‡¶Ö‡¶¶‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶ö‡¶æ‡¶≤‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶®</th>
            <th>‡¶Æ‡ßã‡¶ü ‡¶ö‡¶æ‡¶≤‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶®</th>
            <th>‡¶Ö‡¶¶‡ßç‡¶Ø ‡¶ï‡¶§ ‡¶ö‡¶æ‡¶≤ ‡¶∞‡¶æ‡¶®‡ßç‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</th>
            <th>‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü ‡¶ï‡¶§ ‡¶ö‡¶æ‡¶≤ ‡¶∞‡¶á‡¶≤</th>
            <th>‡¶Ö‡¶¶‡ßç‡¶Ø ‡¶â‡¶™‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø‡¶∞ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</th>
            <th>‡¶Ö‡¶¶‡ßç‡¶Ø ‡¶ï‡¶§‡¶ú‡¶® ‡¶Æ‡¶ø‡¶°-‡¶°‡ßá-‡¶Æ‡¶ø‡¶≤ ‡¶ñ‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá</th>
            <th>‡¶™‡¶∞‡¶ø‡¶¶‡¶∞‡ßç‡¶∂‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</th>
        </tr>
        ${riceRows}
        <tr class="total">
            <td colspan="2">‡¶Æ‡ßã‡¶ü</td>
            <td></td>
            <td></td>
            <td></td>
            <td>${totalConsumed.toFixed(2)}</td>
            <td>${runningBalance.toFixed(2)}</td>
            <td>${totalAttendance}</td>
            <td>${totalMT}</td>
            <td></td>
        </tr>
    </table>
    
    <div style="text-align: center; margin: 15px 0; font-weight: bold; font-size: 11px;">
        ‡¶∏‡¶Æ‡¶æ‡¶™‡¶® ‡¶∏‡ßç‡¶•‡¶ø‡¶§‡¶ø: <span style="border-bottom: 1px solid #000; padding: 0 20px;">${runningBalance.toFixed(2)}</span> ‡¶ï‡ßá‡¶ú‡¶ø
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 100px; margin-top: 35px; text-align: center;">
        <div><div style="border-top: 1px solid #000; margin-top: 35px; padding-top: 5px;">MDM-Incharge<br><strong>${mdmData.school.mdmic}</strong></div></div>
        <div><div style="border-top: 1px solid #000; margin-top: 35px; padding-top: 5px;">‡¶™‡ßç‡¶∞‡¶ß‡¶æ‡¶® ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï/‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ø‡¶ï‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞<br><strong>${mdmData.school.hoi}</strong></div></div>
    </div>
</body></html>`;
            
            openGovernmentForm(formHTML, `${formLabel} - ${month} ${year}`);
        }

        // ========== NEW SECURITY & AUTO LOGOUT FUNCTIONS ==========

        // Global variables for PIN and timeout
        let systemPIN = localStorage.getItem('mdm_pin') || '1234';
        let sessionTimeout = parseInt(localStorage.getItem('mdm_timeout')) || 1800000; // 30 min
        let warningTime = parseInt(localStorage.getItem('mdm_warningTime')) || 120000; // 2 min
        let idleTimer = null;
        let warningTimer = null;
        let lastActivity = Date.now();

        // PIN Lock Functions
        function setupPinInputNavigation() {
            const pinInputs = ['lockPin1', 'lockPin2', 'lockPin3', 'lockPin4'];
            pinInputs.forEach((id, index) => {
                const input = document.getElementById(id);
                if (!input) return;
                
                input.addEventListener('input', function() {
                    if (this.value.length === 1 && index < 3) {
                        document.getElementById(pinInputs[index + 1]).focus();
                    }
                });
                
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && this.value === '' && index > 0) {
                        document.getElementById(pinInputs[index - 1]).focus();
                    }
                });
            });
        }

        function showLockScreen() {
            saveAllData();
            document.getElementById('lockScreen').classList.add('active');
            document.getElementById('lockPin1').focus();
            ['lockPin1', 'lockPin2', 'lockPin3', 'lockPin4'].forEach(id => {
                document.getElementById(id).value = '';
            });
        }

        function unlockSystem() {
            const pin = ['lockPin1', 'lockPin2', 'lockPin3', 'lockPin4']
                .map(id => document.getElementById(id).value).join('');
            
            if (pin === systemPIN) {
                document.getElementById('lockScreen').classList.remove('active');
                document.getElementById('lockError').classList.remove('show');
                resetIdleTimer();
            } else {
                document.getElementById('lockError').classList.add('show');
                ['lockPin1', 'lockPin2', 'lockPin3', 'lockPin4'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                document.getElementById('lockPin1').focus();
                setTimeout(() => {
                    document.getElementById('lockError').classList.remove('show');
                }, 3000);
            }
        }

        function togglePinVisibility(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'üôà';
            } else {
                input.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        function applyPIN() {
            const newPin = document.getElementById('changePIN').value;
            const confirmPin = document.getElementById('confirmPIN').value;
            
            if (!newPin || !confirmPin) {
                showAlert('‚ùå Please enter both PIN fields', 'error');
                return;
            }
            
            if (newPin.length !== 4) {
                showAlert('‚ùå PIN must be exactly 4 digits', 'error');
                return;
            }
            
            if (!/^\d+$/.test(newPin)) {
                showAlert('‚ùå PIN must contain only numbers', 'error');
                return;
            }
            
            if (newPin !== confirmPin) {
                showAlert('‚ùå PINs do not match', 'error');
                return;
            }
            
            systemPIN = newPin;
            localStorage.setItem('mdm_pin', systemPIN);
            document.getElementById('pinStatusText').textContent = 'Custom PIN Active (****) ‚úÖ';
            document.getElementById('changePIN').value = '';
            document.getElementById('confirmPIN').value = '';
            showAlert('‚úÖ PIN changed successfully!', 'success');
        }

        // Auto Logout Functions
        function initActivityTracking() {
            const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
            events.forEach(event => {
                document.addEventListener(event, resetIdleTimer, true);
            });
            resetIdleTimer();
        }

        function resetIdleTimer() {
            lastActivity = Date.now();
            const activityEl = document.getElementById('activityText');
            if (activityEl) activityEl.textContent = 'Active';
            const warningEl = document.getElementById('timeoutWarning');
            if (warningEl) warningEl.classList.remove('active');
            
            clearTimeout(idleTimer);
            clearTimeout(warningTimer);
            
            warningTimer = setTimeout(showTimeoutWarning, sessionTimeout - warningTime);
            idleTimer = setTimeout(autoLogout, sessionTimeout);
        }

        function showTimeoutWarning() {
            const warningEl = document.getElementById('timeoutWarning');
            if (warningEl) warningEl.classList.add('active');
            const activityEl = document.getElementById('activityText');
            if (activityEl) activityEl.textContent = 'Idle';
            
            let remainingSeconds = Math.floor(warningTime / 1000);
            updateTimeoutTimer(remainingSeconds);
            
            const countdownInterval = setInterval(() => {
                remainingSeconds--;
                updateTimeoutTimer(remainingSeconds);
                if (remainingSeconds <= 0) clearInterval(countdownInterval);
            }, 1000);
        }

        function updateTimeoutTimer(seconds) {
            const timerEl = document.getElementById('timeoutTimer');
            if (timerEl) {
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                timerEl.textContent = `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
        }

        function extendSession() {
            showAlert('‚úÖ Session extended!', 'success');
            resetIdleTimer();
        }

        function forceLogout() {
            saveAllData();
            logout();
        }

        function autoLogout() {
            saveAllData();
            sessionStorage.setItem('logout_reason', 'Session expired due to inactivity');
            logout();
        }

        function updateTimeoutSetting() {
            sessionTimeout = parseInt(document.getElementById('settings_timeout').value);
            warningTime = parseInt(document.getElementById('settings_warningTime').value);
            localStorage.setItem('mdm_timeout', sessionTimeout);
            localStorage.setItem('mdm_warningTime', warningTime);
            resetIdleTimer();
            showAlert('‚è±Ô∏è Auto logout settings updated!', 'success');
        }

        // Settings Field Population
        function populateSettingsFields() {
            console.log('Populating settings fields...');
            
            // School info (COMPLETE)
            if (mdmData.school) {
                if (document.getElementById('settingsSchoolName'))
                    document.getElementById('settingsSchoolName').value = mdmData.school.name || '';
                if (document.getElementById('settingsLocation'))
                    document.getElementById('settingsLocation').value = mdmData.school.location || '';
                if (document.getElementById('settingsBlock'))
                    document.getElementById('settingsBlock').value = mdmData.school.block || '';
                if (document.getElementById('settingsDISE'))
                    document.getElementById('settingsDISE').value = mdmData.school.dise || '';
                if (document.getElementById('settingsHOI'))
                    document.getElementById('settingsHOI').value = mdmData.school.hoi || '';
                if (document.getElementById('settingsMDMIC'))
                    document.getElementById('settingsMDMIC').value = mdmData.school.mdmic || '';
                
                // ‚úÖ FIX: Populate missing school fields
                if (document.getElementById('settingsHOIDesignation'))
                    document.getElementById('settingsHOIDesignation').value = mdmData.school.hoiDesignation || '';
                if (document.getElementById('settingsHOIMobile'))
                    document.getElementById('settingsHOIMobile').value = mdmData.school.hoiMobile || '';
                if (document.getElementById('settingsMDMICMobile'))
                    document.getElementById('settingsMDMICMobile').value = mdmData.school.mdmicMobile || '';
                if (document.getElementById('settingsCategory'))
                    document.getElementById('settingsCategory').value = mdmData.school.category || '';
                
                // ‚úÖ NEW: Populate District, Subdivision, GP/Ward, SHG fields
                if (document.getElementById('settingsDistrict'))
                    document.getElementById('settingsDistrict').value = mdmData.school.district || 'PURBA BARDHAMAN';
                if (document.getElementById('settingsSubdivision'))
                    document.getElementById('settingsSubdivision').value = mdmData.school.subdivision || 'BARDHAMAN SADAR N';
                if (document.getElementById('settingsGPWard'))
                    document.getElementById('settingsGPWard').value = mdmData.school.gpWard || 'UTTAR RAMNAGAR';
                if (document.getElementById('settingsSHGName'))
                    document.getElementById('settingsSHGName').value = mdmData.school.shgName || 'MA MANASA MATA';
                
                // ‚úÖ NEW: Populate Bank Name, Account No, Contact No
                if (document.getElementById('settingsBankName'))
                    document.getElementById('settingsBankName').value = mdmData.school.bankName || 'UCO';
                if (document.getElementById('settingsBankAccountNo'))
                    document.getElementById('settingsBankAccountNo').value = mdmData.school.bankAccountNo || '11200110014752';
                if (document.getElementById('settingsContactNo'))
                    document.getElementById('settingsContactNo').value = mdmData.school.contactNo || '9679699886';
            }
            
            // Enrollment
            if (mdmData.enrollment) {
                if (document.getElementById('enrollmentV'))
                    document.getElementById('enrollmentV').value = mdmData.enrollment.V || 0;
                if (document.getElementById('enrollmentVI'))
                    document.getElementById('enrollmentVI').value = mdmData.enrollment.VI || 0;
                if (document.getElementById('enrollmentVII'))
                    document.getElementById('enrollmentVII').value = mdmData.enrollment.VII || 0;
                if (document.getElementById('enrollmentVIII'))
                    document.getElementById('enrollmentVIII').value = mdmData.enrollment.VIII || 0;
            }
            
            // ‚úÖ FIX: Populate Rice and Cost Parameters
            if (mdmData.rice) {
                if (document.getElementById('riceClassV'))
                    document.getElementById('riceClassV').value = mdmData.rice.V || 100;
                if (document.getElementById('riceClassVIVIIVIII'))
                    document.getElementById('riceClassVIVIIVIII').value = mdmData.rice.VI || 150;
            }
            
            if (mdmData.cost) {
                if (document.getElementById('costClassV'))
                    document.getElementById('costClassV').value = mdmData.cost.V || 6.78;
                if (document.getElementById('costClassVIVIIVIII'))
                    document.getElementById('costClassVIVIIVIII').value = mdmData.cost.VI || 10.04;
            }
            
            // ‚úÖ FIX: Populate Opening Stocks
            if (document.getElementById('riceOpeningStock'))
                document.getElementById('riceOpeningStock').value = mdmData.riceOpeningStock || 0;
            if (document.getElementById('fundOpening'))
                document.getElementById('fundOpening').value = mdmData.fundOpening || 0;
            
            // ‚úÖ FIX: Populate Bank Details
            if (mdmData.bank) {
                if (document.getElementById('bankAccountName'))
                    document.getElementById('bankAccountName').value = mdmData.bank.accountName || '';
                if (document.getElementById('bankAccountNumber'))
                    document.getElementById('bankAccountNumber').value = mdmData.bank.accountNumber || '';
                if (document.getElementById('bankBranch'))
                    document.getElementById('bankBranch').value = mdmData.bank.branch || '';
                if (document.getElementById('bankIFSC'))
                    document.getElementById('bankIFSC').value = mdmData.bank.ifsc || '';
            }
            
            // ‚úÖ FIX: Populate Other Details
            if (document.getElementById('gpMunicipality'))
                document.getElementById('gpMunicipality').value = mdmData.gpMunicipality || '';
            if (document.getElementById('yearEstablishment'))
                document.getElementById('yearEstablishment').value = mdmData.yearEstablishment || '';
            
            // ‚úÖ FIX: Populate Weekly Menu
            if (mdmData.weeklyMenu) {
                if (document.getElementById('menuMon1'))
                    document.getElementById('menuMon1').value = mdmData.weeklyMenu.monday?.[0] || '';
                if (document.getElementById('menuMon2'))
                    document.getElementById('menuMon2').value = mdmData.weeklyMenu.monday?.[1] || '';
                if (document.getElementById('menuTue1'))
                    document.getElementById('menuTue1').value = mdmData.weeklyMenu.tuesday?.[0] || '';
                if (document.getElementById('menuTue2'))
                    document.getElementById('menuTue2').value = mdmData.weeklyMenu.tuesday?.[1] || '';
                if (document.getElementById('menuWed1'))
                    document.getElementById('menuWed1').value = mdmData.weeklyMenu.wednesday?.[0] || '';
                if (document.getElementById('menuWed2'))
                    document.getElementById('menuWed2').value = mdmData.weeklyMenu.wednesday?.[1] || '';
                if (document.getElementById('menuThu1'))
                    document.getElementById('menuThu1').value = mdmData.weeklyMenu.thursday?.[0] || '';
                if (document.getElementById('menuThu2'))
                    document.getElementById('menuThu2').value = mdmData.weeklyMenu.thursday?.[1] || '';
                if (document.getElementById('menuFri1'))
                    document.getElementById('menuFri1').value = mdmData.weeklyMenu.friday?.[0] || '';
                if (document.getElementById('menuFri2'))
                    document.getElementById('menuFri2').value = mdmData.weeklyMenu.friday?.[1] || '';
                if (document.getElementById('menuSat1'))
                    document.getElementById('menuSat1').value = mdmData.weeklyMenu.saturday?.[0] || '';
                if (document.getElementById('menuSat2'))
                    document.getElementById('menuSat2').value = mdmData.weeklyMenu.saturday?.[1] || '';
            }
            
            // ‚úÖ Render dynamic cooks and staff lists
            renderCooksList();
            renderStaffList();
            
            // ‚úÖ Update enrollment totals display
            updateEnrollmentTotals();
            
            console.log('‚úÖ ALL settings fields populated successfully!');
        }

        // ========== DYNAMIC COOKS MANAGEMENT ==========
        function addNewCook() {
            const name = document.getElementById('newCookName').value.trim();
            const gender = document.getElementById('newCookGender').value;
            const caste = document.getElementById('newCookCaste').value;
            const paymentMode = document.getElementById('newCookPaymentMode').value;
            const amount = parseFloat(document.getElementById('newCookAmount').value);
            
            // ‚úÖ VALIDATION 1: Name check
            if (!name) {
                showAlert('‚ùå Please enter cook name', 'error');
                return;
            }
            
            // ‚úÖ VALIDATION 2: Duplicate name check
            const isDuplicate = mdmData.cooks.some(cook => cook.name.toLowerCase() === name.toLowerCase());
            if (isDuplicate) {
                showAlert('‚ùå A cook with this name already exists!', 'error');
                return;
            }
            
            // ‚úÖ VALIDATION 3: Minimum amount check (‚Çπ500)
            if (!amount || amount < 500) {
                showAlert('‚ùå Amount must be at least ‚Çπ500', 'error');
                return;
            }
            
            // ‚úÖ VALIDATION 4: Maximum amount check (‚Çπ50,000)
            if (amount > 50000) {
                showAlert('‚ùå Amount cannot exceed ‚Çπ50,000. Please check the value.', 'error');
                return;
            }
            
            mdmData.cooks.push({
                name: name,
                gender: gender,
                caste: caste,
                paymentMode: paymentMode,
                amount: amount
            });
            
            // Clear form
            document.getElementById('newCookName').value = '';
            document.getElementById('newCookGender').value = 'M';
            document.getElementById('newCookCaste').value = 'GEN';
            document.getElementById('newCookPaymentMode').value = 'Bank';
            document.getElementById('newCookAmount').value = '1500';
            
            renderCooksList();
            saveAllData();
            showAlert('‚úÖ Cook-cum-Helper added successfully!', 'success');
        }

        function deleteCook(index) {
            if (confirm('Are you sure you want to delete this cook?')) {
                mdmData.cooks.splice(index, 1);
                renderCooksList();
                saveAllData();
                showAlert('üóëÔ∏è Cook deleted', 'success');
            }
        }

        function renderCooksList() {
            const tbody = document.getElementById('cooksTableBody');
            const noMessage = document.getElementById('noCooksMessage');
            
            if (!tbody) return;
            
            if (mdmData.cooks.length === 0) {
                tbody.innerHTML = '';
                if (noMessage) noMessage.style.display = 'block';
                return;
            }
            
            if (noMessage) noMessage.style.display = 'none';
            
            tbody.innerHTML = mdmData.cooks.map((cook, index) => `
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; text-align: center;">${index + 1}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px;">${cook.name}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; text-align: center;">${cook.gender === 'M' ? 'Male' : 'Female'}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; text-align: center;">${cook.caste || 'GEN'}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; text-align: center;">${cook.paymentMode || 'Bank'}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px; text-align: right; font-weight: 600; color: #059669;">‚Çπ${(cook.amount || 0).toFixed(2)}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                        <button onclick="deleteCook(${index})" style="padding: 5px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            üóëÔ∏è Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // ========== DYNAMIC STAFF MANAGEMENT ==========
        function addNewStaff() {
            const name = document.getElementById('newStaffName').value.trim();
            const designation = document.getElementById('newStaffDesignation').value.trim();
            const mobile = document.getElementById('newStaffMobile').value.trim();
            
            if (!name || !designation || !mobile) {
                showAlert('‚ùå Please fill all staff fields', 'error');
                return;
            }
            
            if (mobile.length !== 10 || !/^\d+$/.test(mobile)) {
                showAlert('‚ùå Please enter valid 10-digit mobile number', 'error');
                return;
            }
            
            mdmData.staff.push({
                name: name,
                designation: designation,
                mobile: mobile
            });
            
            // Clear form
            document.getElementById('newStaffName').value = '';
            document.getElementById('newStaffDesignation').value = '';
            document.getElementById('newStaffMobile').value = '';
            
            renderStaffList();
            saveAllData();
            showAlert('‚úÖ Staff added successfully!', 'success');
        }

        function deleteStaff(index) {
            if (confirm('Are you sure you want to delete this staff member?')) {
                mdmData.staff.splice(index, 1);
                renderStaffList();
                saveAllData();
                showAlert('üóëÔ∏è Staff deleted', 'success');
            }
        }

        function renderStaffList() {
            const tbody = document.getElementById('staffTableBody');
            const noMessage = document.getElementById('noStaffMessage');
            
            if (!tbody) return;
            
            if (mdmData.staff.length === 0) {
                tbody.innerHTML = '';
                if (noMessage) noMessage.style.display = 'block';
                return;
            }
            
            if (noMessage) noMessage.style.display = 'none';
            
            tbody.innerHTML = mdmData.staff.map((staff, index) => `
                <tr>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px;">${index + 1}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px;">${staff.name}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px;">${staff.designation}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px;">${staff.mobile}</td>
                    <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                        <button onclick="deleteStaff(${index})" style="padding: 5px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            üóëÔ∏è Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // ========== NEW FEATURES SECTION ==========
        
        // Feature 1: TABLE SEARCH FUNCTIONALITY
        function addTableSearch(tableId, inputId) {
            const input = document.getElementById(inputId);
            const table = document.getElementById(tableId);
            
            if (!input || !table) return;
            
            input.addEventListener('keyup', function() {
                const filter = this.value.toUpperCase();
                const tbody = table.querySelector('tbody');
                const rows = tbody.getElementsByTagName('tr');
                
                let visibleCount = 0;
                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].getElementsByTagName('td');
                    let found = false;
                    
                    for (let j = 0; j < cells.length; j++) {
                        const cell = cells[j];
                        if (cell) {
                            const textValue = cell.textContent || cell.innerText;
                            if (textValue.toUpperCase().indexOf(filter) > -1) {
                                found = true;
                                break;
                            }
                        }
                    }
                    
                    rows[i].style.display = found ? '' : 'none';
                    if (found) visibleCount++;
                }
                
                // Show "no results" message if needed
                updateSearchResults(visibleCount, filter);
            });
        }

        function updateSearchResults(count, filter) {
            if (filter && count === 0) {
                showAlert('üîç No results found for "' + filter + '"', 'info');
            }
        }

        // Feature 2: KEYBOARD SHORTCUTS
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S = Save Settings
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                const currentTab = localStorage.getItem('activeTab');
                if (currentTab === 'settings') {
                    saveAllSettings();
                    showAlert('‚å®Ô∏è Keyboard shortcut: Settings saved!', 'success');
                }
            }
            
            // Ctrl/Cmd + L = Lock System
            if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                e.preventDefault();
                showLockScreen();
                showAlert('‚å®Ô∏è System locked via keyboard shortcut', 'info');
            }
            
            // Ctrl/Cmd + E = Export Data
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportData();
            }
            
            // Ctrl/Cmd + D = Go to Dashboard
            if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                e.preventDefault();
                switchTab('dashboard');
                showAlert('‚å®Ô∏è Switched to Dashboard', 'info');
            }
            
            // Escape = Close any modal/overlay
            if (e.key === 'Escape') {
                const lockScreen = document.getElementById('lockScreen');
                if (lockScreen && lockScreen.classList.contains('active')) {
                    // Don't allow escape from lock screen
                    e.preventDefault();
                }
            }
        });

        // Feature 3: AUTO-SAVE INDICATOR
        let autoSaveTimer;
        function showAutoSaveIndicator(message = 'üíæ Auto-saving...') {
            clearTimeout(autoSaveTimer);
            
            let indicator = document.getElementById('autoSaveIndicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'autoSaveIndicator';
                indicator.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 25px;
                    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
                    z-index: 9998;
                    font-size: 14px;
                    font-weight: 600;
                    display: none;
                    animation: slideInUp 0.3s;
                `;
                document.body.appendChild(indicator);
            }
            
            indicator.textContent = message;
            indicator.style.display = 'block';
            
            autoSaveTimer = setTimeout(() => {
                indicator.style.animation = 'slideInUp 0.3s reverse';
                setTimeout(() => indicator.style.display = 'none', 300);
            }, 2000);
        }

        // Feature 4: QUICK STATS CALCULATOR
        function calculateQuickStats() {
            const stats = {
                totalEntries: mdmData.formC.length,
                totalRiceConsumed: 0,
                totalCost: 0,
                avgAttendance: 0,
                thisMonthEntries: 0
            };
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            mdmData.formC.forEach(entry => {
                // Parse cost (remove ‚Çπ symbol)
                const cost = parseFloat(entry.cost?.toString().replace('‚Çπ', '') || 0);
                const rice = parseFloat(entry.rice || 0);
                
                stats.totalRiceConsumed += rice;
                stats.totalCost += cost;
                
                // Check if entry is from current month
                const entryDate = new Date(entry.date);
                if (entryDate.getMonth() === currentMonth && entryDate.getFullYear() === currentYear) {
                    stats.thisMonthEntries++;
                }
            });
            
            // Calculate average attendance
            if (stats.totalEntries > 0) {
                const totalEnrollment = mdmData.enrollment.V + mdmData.enrollment.VI + 
                                       mdmData.enrollment.VII + mdmData.enrollment.VIII;
                let totalPresent = 0;
                mdmData.formC.forEach(entry => {
                    totalPresent += (entry.mtV || 0) + (entry.mtVI || 0) + 
                                   (entry.mtVII || 0) + (entry.mtVIII || 0);
                });
                stats.avgAttendance = ((totalPresent / (totalEnrollment * stats.totalEntries)) * 100).toFixed(1);
            }
            
            return stats;
        }

        // Feature 5: EXPORT TO CSV
        function exportToCSV(tableId, filename) {
            const table = document.getElementById(tableId);
            if (!table) {
                showAlert('‚ùå Table not found', 'error');
                return;
            }
            
            let csv = [];
            const rows = table.querySelectorAll('tr');
            
            for (let row of rows) {
                const cells = row.querySelectorAll('td, th');
                const rowData = Array.from(cells).map(cell => {
                    let text = cell.textContent.trim();
                    // Escape quotes and commas
                    text = text.replace(/"/g, '""');
                    return `"${text}"`;
                });
                csv.push(rowData.join(','));
            }
            
            // Create download
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('üìä CSV exported successfully!', 'success');
        }

        // Feature 6: QUICK ACTIONS MENU
        function showQuickActionsMenu() {
            const menu = document.createElement('div');
            menu.id = 'quickActionsMenu';
            menu.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                z-index: 99999;
                min-width: 400px;
                animation: scaleIn 0.3s;
            `;
            
            menu.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #0052a3;">‚ö° Quick Actions</h3>
                    <button onclick="closeQuickActions()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">√ó</button>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <button onclick="quickAddEntry(); closeQuickActions();" class="quick-action-btn">
                        ‚ûï Quick Entry
                    </button>
                    <button onclick="exportData(); closeQuickActions();" class="quick-action-btn">
                        üì• Export Data
                    </button>
                    <button onclick="generateFormCPDF(); closeQuickActions();" class="quick-action-btn">
                        üìÑ Generate Report
                    </button>
                    <button onclick="showStats(); closeQuickActions();" class="quick-action-btn">
                        üìä View Statistics
                    </button>
                    <button onclick="switchTab('settings'); closeQuickActions();" class="quick-action-btn">
                        ‚öôÔ∏è Settings
                    </button>
                    <button onclick="showLockScreen(); closeQuickActions();" class="quick-action-btn">
                        üîí Lock System
                    </button>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: center;">
                    <p style="margin: 0; font-size: 12px; color: #666;">
                        <strong>Keyboard Shortcuts:</strong><br>
                        Ctrl+S: Save | Ctrl+E: Export | Ctrl+D: Dashboard | Ctrl+L: Lock
                    </p>
                </div>
            `;
            
            // Add backdrop
            const backdrop = document.createElement('div');
            backdrop.id = 'quickActionsBackdrop';
            backdrop.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 99998;
            `;
            backdrop.onclick = closeQuickActions;
            
            document.body.appendChild(backdrop);
            document.body.appendChild(menu);
            
            // Add styles for quick action buttons
            if (!document.getElementById('quickActionStyles')) {
                const style = document.createElement('style');
                style.id = 'quickActionStyles';
                style.textContent = `
                    .quick-action-btn {
                        padding: 15px 20px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: 600;
                        transition: all 0.3s;
                        text-align: left;
                    }
                    .quick-action-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
                    }
                    @keyframes slideInUp {
                        from { transform: translateY(20px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function closeQuickActions() {
            const menu = document.getElementById('quickActionsMenu');
            const backdrop = document.getElementById('quickActionsBackdrop');
            if (menu) document.body.removeChild(menu);
            if (backdrop) document.body.removeChild(backdrop);
        }

        function quickAddEntry() {
            switchTab('form-c');
            showAlert('üìù Quick Entry: Fill Form-C and save', 'info');
        }

        // Feature 7: SHOW STATISTICS DASHBOARD
        function showStats() {
            const stats = calculateQuickStats();
            
            const statsModal = document.createElement('div');
            statsModal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                z-index: 99999;
                min-width: 500px;
                max-width: 600px;
                animation: scaleIn 0.3s;
            `;
            
            statsModal.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="margin: 0; color: #0052a3;">üìä MDM Statistics</h3>
                    <button onclick="closeStatsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">√ó</button>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; color: white;">
                        <div style="font-size: 36px; font-weight: 700; margin-bottom: 5px;">${stats.totalEntries}</div>
                        <div style="font-size: 14px; opacity: 0.9;">Total Entries</div>
                    </div>
                    
                    <div style="padding: 20px; background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); border-radius: 10px; color: white;">
                        <div style="font-size: 36px; font-weight: 700; margin-bottom: 5px;">${stats.thisMonthEntries}</div>
                        <div style="font-size: 14px; opacity: 0.9;">This Month</div>
                    </div>
                    
                    <div style="padding: 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 10px; color: white;">
                        <div style="font-size: 36px; font-weight: 700; margin-bottom: 5px;">${stats.totalRiceConsumed.toFixed(1)}</div>
                        <div style="font-size: 14px; opacity: 0.9;">KG Rice Used</div>
                    </div>
                    
                    <div style="padding: 20px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); border-radius: 10px; color: white;">
                        <div style="font-size: 36px; font-weight: 700; margin-bottom: 5px;">‚Çπ${stats.totalCost.toFixed(0)}</div>
                        <div style="font-size: 14px; opacity: 0.9;">Total Cost</div>
                    </div>
                </div>
                
                <div style="padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                    <div style="font-size: 48px; font-weight: 700; color: #667eea; margin-bottom: 5px;">${stats.avgAttendance}%</div>
                    <div style="font-size: 16px; color: #666;">Average Attendance</div>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="exportToCSV('formCTable', 'MDM_FormC_Data'); closeStatsModal();" style="flex: 1; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üìä Export to CSV
                    </button>
                    <button onclick="generateFormCPDF(); closeStatsModal();" style="flex: 1; padding: 12px; background: #ff9800; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üìÑ Generate PDF
                    </button>
                </div>
            `;
            
            const backdrop = document.createElement('div');
            backdrop.id = 'statsBackdrop';
            backdrop.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 99998;
            `;
            backdrop.onclick = closeStatsModal;
            
            document.body.appendChild(backdrop);
            document.body.appendChild(statsModal);
            
            // Store reference for closing
            window.currentStatsModal = statsModal;
        }

        function closeStatsModal() {
            if (window.currentStatsModal) {
                document.body.removeChild(window.currentStatsModal);
                window.currentStatsModal = null;
            }
            const backdrop = document.getElementById('statsBackdrop');
            if (backdrop) document.body.removeChild(backdrop);
        }

        // Feature 8: NOTIFICATION CENTER
        let notifications = [];
        
        function addNotification(message, type = 'info') {
            const notification = {
                id: Date.now(),
                message: message,
                type: type,
                time: new Date().toLocaleTimeString()
            };
            
            notifications.unshift(notification);
            if (notifications.length > 10) notifications.pop();
            
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            let badge = document.getElementById('notificationBadge');
            if (!badge && notifications.length > 0) {
                badge = document.createElement('div');
                badge.id = 'notificationBadge';
                badge.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #dc3545;
                    color: white;
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 14px;
                    font-weight: 700;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
                    z-index: 9997;
                    animation: pulse 2s infinite;
                `;
                badge.onclick = showNotifications;
                document.body.appendChild(badge);
            }
            
            if (badge) {
                badge.textContent = notifications.length;
                if (notifications.length === 0) {
                    badge.style.display = 'none';
                } else {
                    badge.style.display = 'flex';
                }
            }
        }

        function showNotifications() {
            const panel = document.createElement('div');
            panel.style.cssText = `
                position: fixed;
                top: 60px;
                right: 20px;
                width: 350px;
                max-height: 500px;
                background: white;
                border-radius: 10px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                z-index: 99999;
                overflow: hidden;
                animation: slideInRight 0.3s;
            `;
            
            let notifHTML = `
                <div style="padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0;">üîî Notifications</h3>
                        <button onclick="closeNotifications()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">‚úï</button>
                    </div>
                </div>
                <div style="max-height: 400px; overflow-y: auto; padding: 10px;">
            `;
            
            if (notifications.length === 0) {
                notifHTML += '<p style="text-align: center; padding: 30px; color: #999;">No notifications</p>';
            } else {
                notifications.forEach(notif => {
                    const icon = notif.type === 'success' ? '‚úÖ' : notif.type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
                    notifHTML += `
                        <div style="padding: 15px; border-bottom: 1px solid #eee; background: ${notif.type === 'error' ? '#fee' : notif.type === 'success' ? '#efe' : '#f8f9fa'}; margin-bottom: 5px; border-radius: 5px;">
                            <div style="display: flex; gap: 10px;">
                                <span style="font-size: 20px;">${icon}</span>
                                <div style="flex: 1;">
                                    <p style="margin: 0 0 5px 0; font-size: 14px; color: #333;">${notif.message}</p>
                                    <p style="margin: 0; font-size: 12px; color: #999;">${notif.time}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
                notifHTML += `
                    <div style="padding: 10px; text-align: center;">
                        <button onclick="clearAllNotifications()" style="padding: 8px 15px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                            Clear All
                        </button>
                    </div>
                `;
            }
            
            notifHTML += '</div>';
            panel.innerHTML = notifHTML;
            
            // Remove any existing panel
            const existing = document.getElementById('notificationPanel');
            if (existing) document.body.removeChild(existing);
            
            panel.id = 'notificationPanel';
            document.body.appendChild(panel);
            
            // Add animation style
            if (!document.getElementById('notificationStyles')) {
                const style = document.createElement('style');
                style.id = 'notificationStyles';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes pulse {
                        0%, 100% { transform: scale(1); }
                        50% { transform: scale(1.1); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function closeNotifications() {
            const panel = document.getElementById('notificationPanel');
            if (panel) document.body.removeChild(panel);
        }

        function clearAllNotifications() {
            notifications = [];
            updateNotificationBadge();
            closeNotifications();
            showAlert('üóëÔ∏è All notifications cleared', 'success');
        }

        // Feature 9: ENHANCED FORM VALIDATION
        function validateFormCEntry() {
            const cpV = parseInt(document.getElementById('cpV')?.value) || 0;
            const mtV = parseInt(document.getElementById('mtV')?.value) || 0;
            const cpVI = parseInt(document.getElementById('cpVI')?.value) || 0;
            const mtVI = parseInt(document.getElementById('mtVI')?.value) || 0;
            const cpVII = parseInt(document.getElementById('cpVII')?.value) || 0;
            const mtVII = parseInt(document.getElementById('mtVII')?.value) || 0;
            const cpVIII = parseInt(document.getElementById('cpVIII')?.value) || 0;
            const mtVIII = parseInt(document.getElementById('mtVIII')?.value) || 0;
            
            const errors = [];
            
            // Check if MT exceeds CP for each class
            if (mtV > cpV) errors.push('Class V: MT cannot exceed CP');
            if (mtVI > cpVI) errors.push('Class VI: MT cannot exceed CP');
            if (mtVII > cpVII) errors.push('Class VII: MT cannot exceed CP');
            if (mtVIII > cpVIII) errors.push('Class VIII: MT cannot exceed CP');
            
            // Check if CP exceeds enrollment
            if (cpV > mdmData.enrollment.V) errors.push('Class V: CP exceeds enrollment');
            if (cpVI > mdmData.enrollment.VI) errors.push('Class VI: CP exceeds enrollment');
            if (cpVII > mdmData.enrollment.VII) errors.push('Class VII: CP exceeds enrollment');
            if (cpVIII > mdmData.enrollment.VIII) errors.push('Class VIII: CP exceeds enrollment');
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }

        // Feature 10: PRINT-FRIENDLY MODE
        function enablePrintMode() {
            window.print();
        }

        // Initialize new features on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Add notification for successful initialization
            setTimeout(() => {
                addNotification('üéâ MDM System loaded successfully!', 'success');
                addNotification('üí° Press Ctrl+Space for Quick Actions', 'info');
            }, 1000);
            
            // Add Ctrl+Space shortcut for quick actions
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === ' ') {
                    e.preventDefault();
                    showQuickActionsMenu();
                }
            });
            
            // Add Ctrl+M shortcut for tools menu
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'm') {
                    e.preventDefault();
                    switchTab('tools');
                }
            });
        });
        
        // ========== TOOLS TAB FUNCTIONS ==========
        function updateToolsSystemInfo() {
            // Count features
            let featuresLoaded = 0;
            if (typeof MDMSearch !== 'undefined') featuresLoaded++;
            if (typeof BulkFormC !== 'undefined') featuresLoaded++;
            if (typeof AdvancedExport !== 'undefined') featuresLoaded++;
            if (typeof MDMBackup !== 'undefined') featuresLoaded++;
            if (typeof ActivityLogger !== 'undefined') featuresLoaded++;
            
            const featuresCountEl = document.getElementById('features-count-tools');
            if (featuresCountEl) {
                featuresCountEl.textContent = `${featuresLoaded}/5`;
                featuresCountEl.style.color = featuresLoaded === 5 ? '#27ae60' : '#dc3545';
            }
            
            // Update status badges
            if (typeof MDMSearch === 'undefined') {
                const el = document.getElementById('search-status-tools');
                if (el) {
                    el.innerHTML = '‚ùå Not loaded';
                    el.style.background = '#f8d7da';
                    el.style.color = '#721c24';
                }
            }
            
            if (typeof BulkFormC === 'undefined') {
                const el = document.getElementById('bulk-status-tools');
                if (el) {
                    el.innerHTML = '‚ùå Not loaded';
                    el.style.background = '#f8d7da';
                    el.style.color = '#721c24';
                }
            }
            
            if (typeof AdvancedExport === 'undefined') {
                const el = document.getElementById('export-status-tools');
                if (el) {
                    el.innerHTML = '‚ùå Not loaded';
                    el.style.background = '#f8d7da';
                    el.style.color = '#721c24';
                }
            }
            
            // Last backup
            if (typeof MDMBackup !== 'undefined') {
                try {
                    const backups = MDMBackup.list ? MDMBackup.list() : [];
                    const lastBackupEl = document.getElementById('last-backup-tools');
                    if (lastBackupEl && backups && backups.length > 0) {
                        const lastBackup = backups[backups.length - 1];
                        lastBackupEl.textContent = lastBackup.date + ' ' + lastBackup.time;
                    }
                } catch(e) {}
            }
            
            // Activities count
            if (typeof ActivityLogger !== 'undefined') {
                const activitiesCountEl = document.getElementById('activities-count-tools');
                if (activitiesCountEl) {
                    try {
                        const activities = ActivityLogger.getRecent ? ActivityLogger.getRecent(1000) : [];
                        activitiesCountEl.textContent = activities.length || '0';
                    } catch(e) {
                        activitiesCountEl.textContent = '0';
                    }
                }
            }
        }
        
        function viewActivityLogInline() {
            if (typeof ActivityLogger === 'undefined') {
                alert('‚ùå Activity Logger not loaded!\n\nPlease ensure activity-logger.js is in the folder.');
                return;
            }
            
            const activities = ActivityLogger.getRecent ? ActivityLogger.getRecent(20) : [];
            
            if (!activities || activities.length === 0) {
                alert('‚ÑπÔ∏è No activities logged yet.\n\nActivity logging is enabled and will track future actions.');
                return;
            }
            
            const displayArea = document.getElementById('activity-log-display');
            if (!displayArea) return;
            
            let logHTML = `
                <div style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); padding: 20px; border-radius: 10px; margin-bottom: 15px; color: white;">
                    <h3 style="margin: 0 0 5px 0;">üìù Activity Log</h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 14px;">Recent system activities (Last 20)</p>
                </div>
                
                <div style="max-height: 500px; overflow: auto; background: #f8f9fa; padding: 15px; border-radius: 10px;">
            `;
            
            activities.forEach((activity, index) => {
                logHTML += `
                    <div style="background: white; padding: 12px; margin-bottom: 10px; border-radius: 6px; border-left: 3px solid #e74c3c; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 5px;">
                            <div style="color: #999; font-size: 12px; font-weight: bold;">#${index + 1}</div>
                            <div style="color: #999; font-size: 11px;">${activity.date} ${activity.time}</div>
                        </div>
                        <div style="color: #333; font-size: 14px; font-weight: bold; margin-bottom: 3px;">${activity.action}</div>
                        <div style="color: #666; font-size: 12px;">User: ${activity.user}</div>
                    </div>
                `;
            });
            
            logHTML += `
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-danger" onclick="exportActivityLogInline()">üì• Export to CSV</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('activity-log-display').style.display='none'">‚úï Close</button>
                </div>
            `;
            
            displayArea.innerHTML = logHTML;
            displayArea.style.display = 'block';
            
            // Hide sync status display if open
            document.getElementById('sync-status-display').style.display = 'none';
        }
        
        function exportActivityLogInline() {
            if (typeof ActivityLogger !== 'undefined' && ActivityLogger.exportCSV) {
                ActivityLogger.exportCSV();
                alert('‚úÖ Activity log exported!\n\nCSV file is downloading...');
            }
        }
        
        function showSyncStatusInline() {
            const displayArea = document.getElementById('sync-status-display');
            if (!displayArea) return;
            
            const statusHTML = `
                <div style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); padding: 20px; border-radius: 10px; margin-bottom: 15px; color: white;">
                    <h3 style="margin: 0 0 5px 0;">üîÑ MongoDB Sync Status</h3>
                    <p style="margin: 0; opacity: 0.9; font-size: 14px;">Real-time connection and synchronization information</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0;">
                            <strong>Connection Status:</strong>
                            <span style="background: #d4edda; color: #155724; padding: 5px 15px; border-radius: 15px; font-weight: bold;">‚úÖ Connected</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0;">
                            <strong>Auto-Sync:</strong>
                            <span style="background: #d4edda; color: #155724; padding: 5px 15px; border-radius: 15px; font-weight: bold;">‚úÖ Enabled (30s)</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0;">
                            <strong>Database:</strong>
                            <span style="color: #667eea; font-weight: bold;">mdm_system</span>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong>Last Sync:</strong>
                            <span id="last-sync-time-inline" style="color: #27ae60; font-weight: bold;">Just now</span>
                        </div>
                    </div>
                    
                    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <strong style="color: #856404;">‚ÑπÔ∏è Information:</strong>
                        <p style="color: #856404; margin: 10px 0 0 0; font-size: 13px; line-height: 1.5;">
                            Your data automatically syncs to MongoDB Atlas every 30 seconds. 
                            All changes are saved to the cloud in real-time!
                        </p>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-secondary" onclick="document.getElementById('sync-status-display').style.display='none'">‚úï Close</button>
                </div>
            `;
            
            displayArea.innerHTML = statusHTML;
            displayArea.style.display = 'block';
            
            // Hide activity log display if open
            document.getElementById('activity-log-display').style.display = 'none';
            
            // Update time every second
            const updateTime = setInterval(() => {
                const timeEl = document.getElementById('last-sync-time-inline');
                if (!timeEl || document.getElementById('sync-status-display').style.display === 'none') {
                    clearInterval(updateTime);
                    return;
                }
                timeEl.textContent = new Date().toLocaleTimeString('en-IN');
            }, 1000);
        }
    </script>
    

    <script>
    // ========================================
    // AUTO PDF DOWNLOAD FUNCTION
    // ========================================
    function autoDownloadPDF(htmlContent, filename) {
        // Check if html2pdf library is loaded
        if (typeof html2pdf === 'undefined') {
            console.error('html2pdf library not loaded!');
            showAlert('‚ö†Ô∏è PDF library not loaded. Please refresh the page and try again.', 'error');
            return;
        }
        
        // Show loading overlay
        const loadingOverlay = document.createElement('div');
        loadingOverlay.id = 'pdf-loading-overlay';
        loadingOverlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            backdrop-filter: blur(5px);
        `;
        loadingOverlay.innerHTML = `
            <div style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 40px 60px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                color: white;
            ">
                <div style="font-size: 60px; margin-bottom: 20px; animation: spin 2s linear infinite;">‚è≥</div>
                <h2 style="margin: 0 0 10px 0; font-size: 24px;">Generating PDF...</h2>
                <p style="margin: 0; opacity: 0.9; font-size: 16px;">Please wait, this may take a few seconds</p>
            </div>
            <style>
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            </style>
        `;
        document.body.appendChild(loadingOverlay);
        
        // Give browser time to render loading overlay
        setTimeout(() => {
            try {
                // Create temporary container
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.top = '0';
                document.body.appendChild(tempDiv);
                
                // PDF generation options
                const opt = {
                    margin: [8, 8, 8, 8],
                    filename: filename,
                    image: { 
                        type: 'jpeg', 
                        quality: 0.95 
                    },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        letterRendering: true,
                        allowTaint: true,
                        backgroundColor: '#ffffff'
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait',
                        compress: true
                    },
                    pagebreak: { 
                        mode: ['avoid-all', 'css', 'legacy'] 
                    }
                };
                
                // Generate and download PDF
                html2pdf().set(opt).from(tempDiv).save().then(() => {
                    // Clean up
                    try {
                        document.body.removeChild(tempDiv);
                    } catch (e) {}
                    try {
                        document.body.removeChild(loadingOverlay);
                    } catch (e) {}
                    
                    // Show success message
                    showAlert('‚úÖ PDF downloaded successfully! Check your Downloads folder.', 'success');
                }).catch(err => {
                    // Error handling
                    console.error('PDF Generation Error:', err);
                    try {
                        document.body.removeChild(tempDiv);
                    } catch (e) {}
                    try {
                        document.body.removeChild(loadingOverlay);
                    } catch (e) {}
                    showAlert('‚ö†Ô∏è PDF generation issue. Please use the Print button in the preview window to save as PDF.', 'warning');
                });
                
            } catch (error) {
                console.error('Auto-download Error:', error);
                try {
                    document.body.removeChild(loadingOverlay);
                } catch (e) {}
                showAlert('‚ö†Ô∏è Auto-download failed. Please use Print ‚Üí Save as PDF in the preview window.', 'warning');
            }
        }, 500);
    }
    <!-- MongoDB API Bridge - Auto-sync to cloud database -->
    <script src="api-bridge-simple.js"></script>
    
    <!-- Advanced Features -->
    <script src="search-system.js"></script>
    <script src="backup-system.js"></script>
    <script src="activity-logger.js"></script>
    <script src="bulk-formc-entry.js"></script>
    <script src="advanced-export.js"></script>
    
    <!-- Forgot Password System -->
    <script src="forgot-password-system.js"></script>
    
    <!-- Enhanced Form C System (All 12 Features) -->
    <script src="enhanced-formc-system.js"></script>
    
    <!-- Form C At A Glance Dashboard -->
    <script src="formc-dashboard.js"></script>
    
</body>
</html>
